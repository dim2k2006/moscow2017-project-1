var initApp=function(){if(!("modules"in app&&"main"in app.modules)){var e=function(){var e=this;e.html=document.querySelector("html"),e.body=document.querySelector("body"),e.modules=app.modules,e.library=new Library,e.initLibrary=function(){e.library.init()},e.initModules=function(){for(var t in e.modules)e.modules.hasOwnProperty(t)&&"undefined"!=typeof e.modules[t].init&&"main"!==t&&"library"!==t&&e.modules[t].init()},e.init=function(){e.initLibrary(),e.initModules()}};"modules"in app||(app.modules={}),app.modules.main=new e,app.modules.main.init()}};window.addEventListener("load",initApp),function(){if(!("modules"in app&&"formSelectMultiple"in app.modules)){var e=function(){var e=this;e.body="",e.container=document.querySelector(".formSelectMultiple"),e.content=document.querySelector(".formSelectMultiple__content"),e.footer=document.querySelector(".formSelectMultiple__footer"),e.setupListener=function(){e.body.addEventListener("change",e.handleChange),e.body.addEventListener("click",e.handleClick)},e.handleChange=function(){var t=event.target;if(t.classList.contains("formSelectMultiple__select")){var n=t.closest(".formSelectMultiple"),l=n.querySelector(".formSelectMultiple__select"),a=l.value,o=n.dataset.list?JSON.parse(n.dataset.list):[],i=[].slice.call(l.querySelectorAll("option")),r=[],c=[];n.classList.contains("formSelectMultiple_state_inited")||([].slice.call(l.querySelectorAll("option")).forEach(function(e){var t=e.value,n=e.innerHTML;t&&n&&o.push({value:t,text:n})}),n.dataset.list=JSON.stringify(o),n.classList.add("formSelectMultiple_state_inited")),i.forEach(function(e){var t=e.value,n=e.innerHTML;t&&n&&r.push({value:t,text:n})}),r=r.filter(function(e){return e.value!==a}),r.forEach(function(e){o.forEach(function(t,n){t.value===e.value&&o.splice(n,1)})}),c=o,e.render(n,r,c)}},e.handleClick=function(t){var n=t.target;if(n.classList.contains("formSelectMultiple__link")){t.preventDefault();var l=n.closest(".formSelectMultiple"),a=n.getAttribute("href"),o=l.dataset.list?JSON.parse(l.dataset.list):[],i=[].slice.call(l.querySelectorAll("a")),r=[],c=[];c=i.map(function(e){var t=e.getAttribute("href"),n=e.innerHTML;return{value:t,text:n}}).filter(function(e){return e.value!==a}),c.forEach(function(e){o.forEach(function(t,n){t.value===e.value&&o.splice(n,1)})}),r=o,e.render(l,r,c)}},e.getValue=function(e){var t=[];if(e){var n=[].slice.call(e.querySelectorAll("a"));t=n.map(function(e){var t=e.getAttribute("href"),n=e.innerHTML;return{value:t,text:n}})}return t},e.render=function(e,t,n){var l=e.querySelector(".formSelectMultiple__select"),a=e.querySelector(".formSelectMultiple__list"),o='<option value=""></option>',i="";t.length>0&&t.forEach(function(e){o+='<option value="'+e.value+'">'+e.text+"</option>"}),n.length>0&&n.forEach(function(e){i+='<li class="formSelectMultiple__item"><a href="'+e.value+'" class="formSelectMultiple__link">'+e.text+"</a></li>"}),l&&(l.innerHTML=o),a&&(a.innerHTML=i),e.dispatchEvent(new Event("change"))},e.importDefaults=function(){e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.formSelectMultiple=new e}}(),function(){if(!("modules"in app&&"modal"in app.modules)){var e=function(){var e=this;e.html="",e.body="",e.container=document.querySelector(".modal"),e.openButton=document.querySelector(".modal_trigger"),e.closeButton=document.querySelector(".modal_close"),e.setupListener=function(){e.body.addEventListener("click",e.router)},e.router=function(t){var n=t.target;n.classList.contains("modal_trigger")?(t.preventDefault(),e.open(t.target)):n.classList.contains("modal_close")&&(t.preventDefault(),e.close(t.target))},e.open=function(t){var n=t.getAttribute("href"),l=document.querySelector(n),a=t.dataset.photo,o=t.dataset.title,i=t.dataset.description;l.querySelector(".authorInfo__preview img").src=a,l.querySelector(".authorInfo__title").innerHTML=o,l.querySelector(".authorInfo__text p").innerHTML=i,e.html.classList.add("modal_state_open"),l.classList.add("modal_state_open")},e.close=function(t){var n=t.closest(".modal");n.classList.remove("modal_state_open"),e.html.classList.remove("modal_state_open")},e.importDefaults=function(){e.html=app.modules.main.html,e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.modal=new e}}(),function(){if(!("modules"in app&&"schedule"in app.modules)){var e=function(){var e=this;e.body="",e.getSchedule="",e.getPlace="",e.getSchool="",e.getAuthor="",e.expand="",e.container=document.querySelector(".schedule"),e.content=document.querySelector(".scheduleList__content"),e.template=document.querySelector("#scheduleItem-template").innerHTML,e.monthNames=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],e.dataList="",e.setupListener=function(){},e.getData=function(){var t="",n="",l="";e.getSchedule(t,n,l).then(function(t){e.render(t)})},e.render=function(t){var n=document.createElement("ul");n.classList.add("scheduleList__list"),t.lectures.forEach(function(l){var a=document.createElement("li");a.classList.add("scheduleList__item"),a.innerHTML=e.template;var o=new Date(l.date),i=o.getDate(),r=e.monthNames[o.getMonth()],c=[],u=[];l.school.forEach(function(n){var l=e.expand([n],{title:"schools",data:t.schools},"title"),a=e.expand([n],{title:"schools",data:t.schools},"id");c.push('<span class="scheduleItem__school__item scheduleItem__school__item_'+a+'">'+l+"</span>")}),l.author.forEach(function(n){var l=e.expand([n],{title:"authors",data:t.authors},"title"),a=e.expand([n],{title:"authors",data:t.authors},"photo"),o=e.expand([n],{title:"authors",data:t.authors},"description");u.push('<a class="scheduleItem__author__link modal_trigger" href="#author" title="Посмотреть дополнительную информацию" data-photo="'+a+'" data-title="'+l+'" data-description="'+o+'">'+l+"</a>")}),l.isOver&&a.querySelector(".scheduleItem").classList.add("scheduleItem_state_inactive"),a.querySelector(".scheduleItem__day").innerHTML=i,a.querySelector(".scheduleItem__month").innerHTML=r,a.querySelector(".scheduleItem__time").innerHTML=l.time,a.querySelector(".scheduleItem__title").innerHTML=l.title,a.querySelector(".scheduleItem__school").innerHTML=c.join(""),a.querySelector(".scheduleItem__author").innerHTML+=u.join(", "),a.querySelector(".scheduleItem__audience").innerHTML+=e.expand([l.place],{title:"places",data:t.places},"title"),a.querySelector(".scheduleItem__place__link").innerHTML=e.expand([l.place],{title:"places",data:t.places},"address"),a.querySelector(".scheduleItem__place__link").href=e.expand([l.place],{title:"places",data:t.places},"link"),n.appendChild(a)}),e.content.innerHTML="",e.content.appendChild(n)},e.importDefaults=function(){e.body=app.modules.main.body,e.getSchedule=app.modules.main.library.getSchedule,e.expand=app.modules.main.library.expand},e.init=function(){e.container&&(e.importDefaults(),e.getData(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.schedule=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vbWFpbi5qcyIsImZvcm1TZWxlY3RNdWx0aXBsZS9mb3JtU2VsZWN0TXVsdGlwbGUuanMiLCJtb2RhbC9tb2RhbC5qcyIsInNjaGVkdWxlL3NjaGVkdWxlLmpzIl0sIm5hbWVzIjpbImluaXRBcHAiLCJhcHAiLCJtb2R1bGVzIiwiTWFpbiIsInNlbGYiLCJ0aGlzIiwiaHRtbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJvZHkiLCJsaWJyYXJ5IiwiTGlicmFyeSIsImluaXRMaWJyYXJ5IiwiaW5pdCIsImluaXRNb2R1bGVzIiwibW9kdWxlIiwiaGFzT3duUHJvcGVydHkiLCJtYWluIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsIkZvcm1TZWxlY3RNdWx0aXBsZSIsImNvbnRhaW5lciIsImNvbnRlbnQiLCJmb290ZXIiLCJzZXR1cExpc3RlbmVyIiwiaGFuZGxlQ2hhbmdlIiwiaGFuZGxlQ2xpY2siLCJ0YXJnZXQiLCJldmVudCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiY2xvc2VzdCIsInNlbGVjdCIsInNlbGVjdGVkVmFsdWUiLCJ2YWx1ZSIsImluaXRpYWxMaXN0IiwiZGF0YXNldCIsImxpc3QiLCJKU09OIiwicGFyc2UiLCJvcHRpb25zIiwic2xpY2UiLCJjYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsInNlbGVjdExpc3QiLCJyZXN1bHRMaXN0IiwiZm9yRWFjaCIsIml0ZW0iLCJ0ZXh0IiwiaW5uZXJIVE1MIiwicHVzaCIsInN0cmluZ2lmeSIsImFkZCIsImZpbHRlciIsInNlbGVjdEl0ZW0iLCJpbml0aWFsSXRlbSIsImluZGV4Iiwic3BsaWNlIiwicmVuZGVyIiwicHJldmVudERlZmF1bHQiLCJnZXRBdHRyaWJ1dGUiLCJsaW5rcyIsIm1hcCIsInJlc3VsdEl0ZW0iLCJnZXRWYWx1ZSIsInNlbGVjdERhdGEiLCJyZXN1bHREYXRhIiwic2VsZWN0Q29udGFpbmVyIiwicmVzdWx0Q29udGFpbmVyIiwic2VsZWN0SHRtbCIsInJlc3VsdEh0bWwiLCJsZW5ndGgiLCJkaXNwYXRjaEV2ZW50IiwiRXZlbnQiLCJpbXBvcnREZWZhdWx0cyIsImZvcm1TZWxlY3RNdWx0aXBsZSIsIk1vZGFsIiwib3BlbkJ1dHRvbiIsImNsb3NlQnV0dG9uIiwicm91dGVyIiwib3BlbiIsImNsb3NlIiwic3JjIiwicGhvdG8iLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwicmVtb3ZlIiwibW9kYWwiLCJTY2hlZHVsZSIsImdldFNjaGVkdWxlIiwiZ2V0UGxhY2UiLCJnZXRTY2hvb2wiLCJnZXRBdXRob3IiLCJleHBhbmQiLCJ0ZW1wbGF0ZSIsIm1vbnRoTmFtZXMiLCJkYXRhTGlzdCIsImdldERhdGEiLCJkYXRlRnJvbSIsImRhdGVUbyIsInBsYWNlIiwidGhlbiIsInJlc3BvbnNlIiwiY29udGVudExpc3QiLCJjcmVhdGVFbGVtZW50IiwibGVjdHVyZXMiLCJlbGVtZW50IiwiZGF0ZSIsIkRhdGUiLCJkYXkiLCJnZXREYXRlIiwibW9udGgiLCJnZXRNb250aCIsInNjaG9vbCIsImF1dGhvciIsIml0ZW1UaXRsZSIsImRhdGEiLCJzY2hvb2xzIiwiaXRlbUlkIiwiYXV0aG9ycyIsIml0ZW1QaG90byIsIml0ZW1EZXNjcmlwdGlvbiIsImlzT3ZlciIsInRpbWUiLCJqb2luIiwicGxhY2VzIiwiaHJlZiIsImFwcGVuZENoaWxkIiwic2NoZWR1bGUiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLFNBQUEsV0FDQSxLQUFBLFdBQUFDLE1BQUEsUUFBQUEsS0FBQUMsU0FBQSxDQVFBLEdBQUFDLEdBQUEsV0FDQSxHQUFBQyxHQUFBQyxJQUVBRCxHQUFBRSxLQUFBQyxTQUFBQyxjQUFBLFFBQ0FKLEVBQUFLLEtBQUFGLFNBQUFDLGNBQUEsUUFDQUosRUFBQUYsUUFBQUQsSUFBQUMsUUFDQUUsRUFBQU0sUUFBQSxHQUFBQyxTQUtBUCxFQUFBUSxZQUFBLFdBQ0FSLEVBQUFNLFFBQUFHLFFBTUFULEVBQUFVLFlBQUEsV0FDQSxJQUFBLEdBQUFDLEtBQUFYLEdBQUFG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QWhCLE1BQUEsU0FBQWdDLEtBQUFkLEVBQUF1QixRQUFBLFNBRUFuQixFQUFBbEcsY0FBQSw4QkFBQXlDLFVBQUE3QyxFQUFBeUYsUUFBQTlDLEVBQUFxRCxRQUFBaEIsTUFBQSxTQUFBZ0MsS0FBQWQsRUFBQXVCLFFBQUEsV0FFQW5CLEVBQUFsRyxjQUFBLDhCQUFBc0gsS0FBQTFILEVBQUF5RixRQUFBOUMsRUFBQXFELFFBQUFoQixNQUFBLFNBQUFnQyxLQUFBZCxFQUFBdUIsUUFBQSxRQUVBdEIsRUFBQXdCLFlBQUFyQixLQUdBdEcsRUFBQWtCLFFBQUEyQixVQUFBLEdBRUE3QyxFQUFBa0IsUUFBQXlHLFlBQUF4QixJQU1BbkcsRUFBQXNFLGVBQUEsV0FDQXRFLEVBQUFLLEtBQUFSLElBQUFDLFFBQUFlLEtBQUFSLEtBQ0FMLEVBQUFxRixZQUFBeEYsSUFBQUMsUUFBQWUsS0FBQVAsUUFBQStFLFlBSUFyRixFQUFBeUYsT0FBQTVGLElBQUFDLFFBQUFlLEtBQUFQLFFBQUFtRixRQU1BekYsRUFBQVMsS0FBQSxXQUNBVCxFQUFBaUIsWUFFQWpCLEVBQUFzRSxpQkFFQXRFLEVBQUE2RixVQUNBN0YsRUFBQW9CLGtCQU1BLFlBQUF2QixPQUNBQSxJQUFBQyxZQUdBRCxJQUFBQyxRQUFBOEgsU0FBQSxHQUFBeEMiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaW5pdEFwcCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gYXBwICYmICdtYWluJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNYWluIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBNYWluID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmh0bWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJyk7XG4gICAgICAgIHNlbGYuYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcbiAgICAgICAgc2VsZi5tb2R1bGVzID0gYXBwLm1vZHVsZXM7XG4gICAgICAgIHNlbGYubGlicmFyeSA9IG5ldyBMaWJyYXJ5KCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbGlicmFyeSBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdExpYnJhcnkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYubGlicmFyeS5pbml0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgYWxsIG1vZHVsZXMgaW4gJC5tb2R1bGVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRNb2R1bGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBtb2R1bGUgaW4gc2VsZi5tb2R1bGVzKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5tb2R1bGVzLmhhc093blByb3BlcnR5KG1vZHVsZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNlbGYubW9kdWxlc1ttb2R1bGVdLmluaXQgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZSAhPT0gJ21haW4nICYmIG1vZHVsZSAhPT0gJ2xpYnJhcnknKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubW9kdWxlc1ttb2R1bGVdLmluaXQoKTtcblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5pbml0TGlicmFyeSgpO1xuICAgICAgICAgICAgc2VsZi5pbml0TW9kdWxlcygpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLm1haW4gPSBuZXcgTWFpbigpO1xuXG4gICAgYXBwLm1vZHVsZXMubWFpbi5pbml0KCk7XG59O1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGluaXRBcHApO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnZm9ybVNlbGVjdE11bHRpcGxlJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBGb3JtU2VsZWN0TXVsdGlwbGUgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIEZvcm1TZWxlY3RNdWx0aXBsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuYm9keSA9ICcnO1xuICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKTtcbiAgICAgICAgc2VsZi5jb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fY29udGVudCcpO1xuICAgICAgICBzZWxmLmZvb3RlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX2Zvb3RlcicpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmhhbmRsZUNoYW5nZSk7XG4gICAgICAgICAgICBzZWxmLmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLmhhbmRsZUNsaWNrKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlIGNoYW5nZSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5oYW5kbGVDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdmb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdCcpKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGFyZ2V0LmNsb3Nlc3QoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdCcpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlID0gc2VsZWN0LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdCA9IGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QgPyBKU09OLnBhcnNlKGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QpIDogW10sXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBbXS5zbGljZS5jYWxsKHNlbGVjdC5xdWVyeVNlbGVjdG9yQWxsKCdvcHRpb24nKSksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IFtdO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFjb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdmb3JtU2VsZWN0TXVsdGlwbGVfc3RhdGVfaW5pdGVkJykpIHtcblxuICAgICAgICAgICAgICAgICAgICBbXS5zbGljZS5jYWxsKHNlbGVjdC5xdWVyeVNlbGVjdG9yQWxsKCdvcHRpb24nKSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBpdGVtLmlubmVySFRNTDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHRleHQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuZGF0YXNldC5saXN0ID0gSlNPTi5zdHJpbmdpZnkoaW5pdGlhbExpc3QpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdmb3JtU2VsZWN0TXVsdGlwbGVfc3RhdGVfaW5pdGVkJyk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBvcHRpb25zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB0ZXh0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBzZWxlY3RMaXN0LmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnZhbHVlICE9PSBzZWxlY3RlZFZhbHVlO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uKHNlbGVjdEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QuZm9yRWFjaChmdW5jdGlvbihpbml0aWFsSXRlbSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbml0aWFsSXRlbS52YWx1ZSA9PT0gc2VsZWN0SXRlbS52YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3Quc3BsaWNlKGluZGV4LCAxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBpbml0aWFsTGlzdDtcblxuICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKGNvbnRhaW5lciwgc2VsZWN0TGlzdCwgcmVzdWx0TGlzdCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlIGNsaWNrIGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5oYW5kbGVDbGljayA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZm9ybVNlbGVjdE11bHRpcGxlX19saW5rJykpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGFyZ2V0LmNsb3Nlc3QoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRWYWx1ZSA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QgPSBjb250YWluZXIuZGF0YXNldC5saXN0ID8gSlNPTi5wYXJzZShjb250YWluZXIuZGF0YXNldC5saXN0KSA6IFtdLFxuICAgICAgICAgICAgICAgICAgICBsaW5rcyA9IFtdLnNsaWNlLmNhbGwoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKSksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IFtdO1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IGxpbmtzLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnZhbHVlICE9PSBzZWxlY3RlZFZhbHVlO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uKHJlc3VsdEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QuZm9yRWFjaChmdW5jdGlvbihpbml0aWFsSXRlbSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbml0aWFsSXRlbS52YWx1ZSA9PT0gcmVzdWx0SXRlbS52YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3Quc3BsaWNlKGluZGV4LCAxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBpbml0aWFsTGlzdDtcblxuICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKGNvbnRhaW5lciwgc2VsZWN0TGlzdCwgcmVzdWx0TGlzdCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0dXJuIGNvbnRhaW5lciBzZWxlY3RlZCB2YWx1ZVxuICAgICAgICAgKiBAcGFyYW0gY29udGFpbmVyXG4gICAgICAgICAqIEByZXR1cm5zIHtBcnJheX1cbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ2V0VmFsdWUgPSBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHRMaXN0ID0gW107XG5cbiAgICAgICAgICAgIGlmIChjb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHZhciBsaW5rcyA9IFtdLnNsaWNlLmNhbGwoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKSk7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gbGlua3MubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBpdGVtLmlubmVySFRNTDtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdExpc3Q7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbmRlciBkYXRhIGZvciBjb250YWluZXJcbiAgICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBjb250YWluZXJcbiAgICAgICAgICogQHBhcmFtIHtBcnJheX0gc2VsZWN0RGF0YVxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSByZXN1bHREYXRhXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlbmRlciA9IGZ1bmN0aW9uKGNvbnRhaW5lciwgc2VsZWN0RGF0YSwgcmVzdWx0RGF0YSkge1xuICAgICAgICAgICAgdmFyIHNlbGVjdENvbnRhaW5lciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3QnKSxcbiAgICAgICAgICAgICAgICByZXN1bHRDb250YWluZXIgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fbGlzdCcpLFxuICAgICAgICAgICAgICAgIHNlbGVjdEh0bWwgPSAnPG9wdGlvbiB2YWx1ZT1cIlwiPjwvb3B0aW9uPicsXG4gICAgICAgICAgICAgICAgcmVzdWx0SHRtbCA9ICcnO1xuXG4gICAgICAgICAgICBpZiAoc2VsZWN0RGF0YS5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3REYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RIdG1sICs9ICc8b3B0aW9uIHZhbHVlPVwiJysgaXRlbS52YWx1ZSArJ1wiPicrIGl0ZW0udGV4dCArJzwvb3B0aW9uPic7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJlc3VsdERhdGEubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0RGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SHRtbCArPSAnPGxpIGNsYXNzPVwiZm9ybVNlbGVjdE11bHRpcGxlX19pdGVtXCI+PGEgaHJlZj1cIicrIGl0ZW0udmFsdWUgKydcIiBjbGFzcz1cImZvcm1TZWxlY3RNdWx0aXBsZV9fbGlua1wiPicrIGl0ZW0udGV4dCArJzwvYT48L2xpPic7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNlbGVjdENvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0Q29udGFpbmVyLmlubmVySFRNTCA9IHNlbGVjdEh0bWw7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJlc3VsdENvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCA9IHJlc3VsdEh0bWw7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29udGFpbmVyLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdjaGFuZ2UnKSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEltcG9ydCBwcm9wZXJ0aWVzIGZyb20gTWFpbiBjbGFzc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5ib2R5ID0gYXBwLm1vZHVsZXMubWFpbi5ib2R5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5jb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLmZvcm1TZWxlY3RNdWx0aXBsZSA9IG5ldyBGb3JtU2VsZWN0TXVsdGlwbGUoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gYXBwICYmICdtb2RhbCcgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgTW9kYWwgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIE1vZGFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5odG1sID0gJyc7XG4gICAgICAgIHNlbGYuYm9keSA9ICcnO1xuICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpO1xuICAgICAgICBzZWxmLm9wZW5CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHJpZ2dlcicpO1xuICAgICAgICBzZWxmLmNsb3NlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX2Nsb3NlJyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5yb3V0ZXIpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSb3V0ZSBjbGljayBldmVudFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucm91dGVyID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF90cmlnZ2VyJykpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLm9wZW4oZXZlbnQudGFyZ2V0KTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9jbG9zZScpKSB7XG5cbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgc2VsZi5jbG9zZShldmVudC50YXJnZXQpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5vcGVuID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgICAgICB2YXIgc3JjID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc3JjKSxcbiAgICAgICAgICAgICAgICBwaG90byA9IHRhcmdldC5kYXRhc2V0LnBob3RvLFxuICAgICAgICAgICAgICAgIHRpdGxlID0gdGFyZ2V0LmRhdGFzZXQudGl0bGUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSB0YXJnZXQuZGF0YXNldC5kZXNjcmlwdGlvbjtcblxuICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5hdXRob3JJbmZvX19wcmV2aWV3IGltZycpLnNyYyA9IHBob3RvO1xuXG4gICAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmF1dGhvckluZm9fX3RpdGxlJykuaW5uZXJIVE1MID0gdGl0bGU7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYXV0aG9ySW5mb19fdGV4dCBwJykuaW5uZXJIVE1MID0gZGVzY3JpcHRpb247XG5cbiAgICAgICAgICAgIHNlbGYuaHRtbC5jbGFzc0xpc3QuYWRkKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnbW9kYWxfc3RhdGVfb3BlbicpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuY2xvc2UgPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0YXJnZXQuY2xvc2VzdCgnLm1vZGFsJyk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgICAgICBzZWxmLmh0bWwuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWxfc3RhdGVfb3BlbicpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbXBvcnQgcHJvcGVydGllcyBmcm9tIE1haW4gY2xhc3NcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuaHRtbCA9IGFwcC5tb2R1bGVzLm1haW4uaHRtbDtcbiAgICAgICAgICAgIHNlbGYuYm9keSA9IGFwcC5tb2R1bGVzLm1haW4uYm9keTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5tb2RhbCA9IG5ldyBNb2RhbCgpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnc2NoZWR1bGUnIGluIGFwcC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IFNjaGVkdWxlIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBTY2hlZHVsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuYm9keSA9ICcnO1xuICAgICAgICBzZWxmLmdldFNjaGVkdWxlID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0UGxhY2UgPSAnJztcbiAgICAgICAgc2VsZi5nZXRTY2hvb2wgPSAnJztcbiAgICAgICAgc2VsZi5nZXRBdXRob3IgPSAnJztcbiAgICAgICAgc2VsZi5leHBhbmQgPSAnJztcbiAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGUnKTtcbiAgICAgICAgc2VsZi5jb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlTGlzdF9fY29udGVudCcpO1xuICAgICAgICBzZWxmLnRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NjaGVkdWxlSXRlbS10ZW1wbGF0ZScpLmlubmVySFRNTDtcbiAgICAgICAgc2VsZi5tb250aE5hbWVzID0gW1xuICAgICAgICAgICAgJ9GP0L3QstCw0YDRjCcsXG4gICAgICAgICAgICAn0YTQtdCy0YDQsNC70YwnLFxuICAgICAgICAgICAgJ9C80LDRgNGCJyxcbiAgICAgICAgICAgICfQsNC/0YDQtdC70YwnLFxuICAgICAgICAgICAgJ9C80LDQuScsXG4gICAgICAgICAgICAn0LjRjtC90YwnLFxuICAgICAgICAgICAgJ9C40Y7Qu9GMJyxcbiAgICAgICAgICAgICfQsNCy0LPRg9GB0YInLFxuICAgICAgICAgICAgJ9GB0LXQvdGC0Y/QsdGA0YwnLFxuICAgICAgICAgICAgJ9C+0LrRgtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQvdC+0Y/QsdGA0YwnLFxuICAgICAgICAgICAgJ9C00LXQutCw0LHRgNGMJ1xuICAgICAgICBdO1xuICAgICAgICBzZWxmLmRhdGFMaXN0ID0gJyc7XG5cblxuICAgICAgICAvLyBzZWxmLmRhdGVGcm9tSW5wdXQgPSBzZWxmLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybUlucHV0X19pbnB1dFtuYW1lPVwiZnJvbVwiXScpO1xuICAgICAgICAvLyBzZWxmLmRhdGVUb0lucHV0ID0gc2VsZi5jb250YWluZXIucXVlcnlTZWxlY3RvcignLmZvcm1JbnB1dF9faW5wdXRbbmFtZT1cInRvXCJdJyk7XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyBzZWxmLmRhdGVGcm9tSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgc2VsZi5nZXREYXRhKTtcbiAgICAgICAgICAgIC8vIHNlbGYuZGF0ZVRvSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgc2VsZi5nZXREYXRhKTtcbiAgICAgICAgICAgIC8vIHNlbGYucGxhY2VTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgc2VsZi5nZXREYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0dXAgcGxhY2UgZmlsdGVyIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgLy8gc2VsZi5zZXR1cFBsYWNlRmlsdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vICAgICBzZWxmLmdldFBsYWNlKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAvLyAgICAgICAgIHZhciBodG1sID0gJzxvcHRpb24gdmFsdWU9XCJcIj48L29wdGlvbj4nO1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgIHJlc3BvbnNlLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAvLyAgICAgICAgICAgICBodG1sICs9ICc8b3B0aW9uIHZhbHVlPVwiJysgaXRlbS5pZCArJ1wiPicrIGl0ZW0udGl0bGUgKyc8L29wdGlvbj4nO1xuICAgICAgICAvLyAgICAgICAgIH0pO1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgIHNlbGYucGxhY2VTZWxlY3QuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAvLyB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgZGF0YSBmcm9tIGxpYnJhcnkgYWNjb3JkaW5nIHRvIGZpbHRlciB2YWx1ZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ2V0RGF0YSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGRhdGVGcm9tID0gJycsLy9zZWxmLmRhdGVGcm9tSW5wdXQudmFsdWUucmVwbGFjZSgvLS9nLCAnLycpLFxuICAgICAgICAgICAgICAgIGRhdGVUbyA9ICcnLC8vc2VsZi5kYXRlVG9JbnB1dC52YWx1ZS5yZXBsYWNlKC8tL2csICcvJyksXG4gICAgICAgICAgICAgICAgcGxhY2UgPSAnJzsvL3NlbGYucGxhY2VTZWxlY3QudmFsdWUgPyBwYXJzZUludChzZWxmLnBsYWNlU2VsZWN0LnZhbHVlKSA6ICcnO1xuXG4gICAgICAgICAgICBzZWxmLmdldFNjaGVkdWxlKGRhdGVGcm9tLCBkYXRlVG8sIHBsYWNlKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIocmVzcG9uc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbmRlciBzY2hlZHVsZSBsaXN0XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yZW5kZXIgPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGNvbnRlbnRMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTtcblxuICAgICAgICAgICAgY29udGVudExpc3QuY2xhc3NMaXN0LmFkZCgnc2NoZWR1bGVMaXN0X19saXN0Jyk7XG5cbiAgICAgICAgICAgIHJlc3BvbnNlLmxlY3R1cmVzLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2NoZWR1bGVMaXN0X19pdGVtJyk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBzZWxmLnRlbXBsYXRlO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShpdGVtLmRhdGUpLFxuICAgICAgICAgICAgICAgICAgICBkYXkgPSBkYXRlLmdldERhdGUoKSxcbiAgICAgICAgICAgICAgICAgICAgbW9udGggPSBzZWxmLm1vbnRoTmFtZXNbZGF0ZS5nZXRNb250aCgpXSxcbiAgICAgICAgICAgICAgICAgICAgc2Nob29sID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvciA9IFtdO1xuXG4gICAgICAgICAgICAgICAgaXRlbS5zY2hvb2wuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtVGl0bGUgPSBzZWxmLmV4cGFuZChbaXRlbV0sIHt0aXRsZTogJ3NjaG9vbHMnLCBkYXRhOiByZXNwb25zZS5zY2hvb2xzfSwgJ3RpdGxlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtSWQgPSBzZWxmLmV4cGFuZChbaXRlbV0sIHt0aXRsZTogJ3NjaG9vbHMnLCBkYXRhOiByZXNwb25zZS5zY2hvb2xzfSwgJ2lkJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2Nob29sLnB1c2goJzxzcGFuIGNsYXNzPVwic2NoZWR1bGVJdGVtX19zY2hvb2xfX2l0ZW0gc2NoZWR1bGVJdGVtX19zY2hvb2xfX2l0ZW1fJysgaXRlbUlkICsnXCI+JysgaXRlbVRpdGxlICsnPC9zcGFuPicpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaXRlbS5hdXRob3IuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtVGl0bGUgPSBzZWxmLmV4cGFuZChbaXRlbV0sIHt0aXRsZTogJ2F1dGhvcnMnLCBkYXRhOiByZXNwb25zZS5hdXRob3JzfSwgJ3RpdGxlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtUGhvdG8gPSBzZWxmLmV4cGFuZChbaXRlbV0sIHt0aXRsZTogJ2F1dGhvcnMnLCBkYXRhOiByZXNwb25zZS5hdXRob3JzfSwgJ3Bob3RvJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtRGVzY3JpcHRpb24gPSBzZWxmLmV4cGFuZChbaXRlbV0sIHt0aXRsZTogJ2F1dGhvcnMnLCBkYXRhOiByZXNwb25zZS5hdXRob3JzfSwgJ2Rlc2NyaXB0aW9uJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yLnB1c2goJzxhIGNsYXNzPVwic2NoZWR1bGVJdGVtX19hdXRob3JfX2xpbmsgbW9kYWxfdHJpZ2dlclwiIGhyZWY9XCIjYXV0aG9yXCIgdGl0bGU9XCLQn9C+0YHQvNC+0YLRgNC10YLRjCDQtNC+0L/QvtC70L3QuNGC0LXQu9GM0L3Rg9GOINC40L3RhNC+0YDQvNCw0YbQuNGOXCIgZGF0YS1waG90bz1cIicrIGl0ZW1QaG90byArJ1wiIGRhdGEtdGl0bGU9XCInKyBpdGVtVGl0bGUgKydcIiBkYXRhLWRlc2NyaXB0aW9uPVwiJysgaXRlbURlc2NyaXB0aW9uICsnXCI+JysgaXRlbVRpdGxlICsnPC9hPicpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaXNPdmVyKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtJykuY2xhc3NMaXN0LmFkZCgnc2NoZWR1bGVJdGVtX3N0YXRlX2luYWN0aXZlJyk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX2RheScpLmlubmVySFRNTCA9IGRheTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fbW9udGgnKS5pbm5lckhUTUwgPSBtb250aDtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fdGltZScpLmlubmVySFRNTCA9IGl0ZW0udGltZTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fdGl0bGUnKS5pbm5lckhUTUwgPSBpdGVtLnRpdGxlO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19zY2hvb2wnKS5pbm5lckhUTUwgPSBzY2hvb2wuam9pbignJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX2F1dGhvcicpLmlubmVySFRNTCArPSBhdXRob3Iuam9pbignLCAnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fYXVkaWVuY2UnKS5pbm5lckhUTUwgKz0gc2VsZi5leHBhbmQoW2l0ZW0ucGxhY2VdLCB7dGl0bGU6ICdwbGFjZXMnLCBkYXRhOiByZXNwb25zZS5wbGFjZXN9LCAndGl0bGUnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fcGxhY2VfX2xpbmsnKS5pbm5lckhUTUwgPSBzZWxmLmV4cGFuZChbaXRlbS5wbGFjZV0sIHt0aXRsZTogJ3BsYWNlcycsIGRhdGE6IHJlc3BvbnNlLnBsYWNlc30sICdhZGRyZXNzJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3BsYWNlX19saW5rJykuaHJlZiA9IHNlbGYuZXhwYW5kKFtpdGVtLnBsYWNlXSwge3RpdGxlOiAncGxhY2VzJywgZGF0YTogcmVzcG9uc2UucGxhY2VzfSwgJ2xpbmsnKTtcblxuICAgICAgICAgICAgICAgIGNvbnRlbnRMaXN0LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNlbGYuY29udGVudC5pbm5lckhUTUwgPSAnJztcblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmFwcGVuZENoaWxkKGNvbnRlbnRMaXN0KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW1wb3J0IHByb3BlcnRpZXMgZnJvbSBNYWluIGNsYXNzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkgPSBhcHAubW9kdWxlcy5tYWluLmJvZHk7XG4gICAgICAgICAgICBzZWxmLmdldFNjaGVkdWxlID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmdldFNjaGVkdWxlO1xuICAgICAgICAgICAgLy8gc2VsZi5nZXRQbGFjZSA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5nZXRQbGFjZTtcbiAgICAgICAgICAgIC8vIHNlbGYuZ2V0U2Nob29sID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmdldFNjaG9vbDtcbiAgICAgICAgICAgIC8vIHNlbGYuZ2V0QXV0aG9yID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmdldEF1dGhvcjtcbiAgICAgICAgICAgIHNlbGYuZXhwYW5kID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmV4cGFuZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzKCk7XG4gICAgICAgICAgICAgICAgLy8gc2VsZi5zZXR1cFBsYWNlRmlsdGVyKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5nZXREYXRhKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5zY2hlZHVsZSA9IG5ldyBTY2hlZHVsZSgpO1xufSkoKTtcbiJdfQ==

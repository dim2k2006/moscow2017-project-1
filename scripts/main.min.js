!function(){if(!("modules"in app&&"formSelectMultiple"in app.modules)){var e=function(){var e=this;e.body="",e.container=document.querySelector(".formSelectMultiple"),e.setupListener=function(){e.body.addEventListener("change",e.handleChange),e.body.addEventListener("click",e.handleClick)},e.handleChange=function(t){var l=t.target;if(l.classList.contains("formSelectMultiple__select")){var n=l.closest(".formSelectMultiple"),o=n.querySelector(".formSelectMultiple__select"),a=o.value,r=n.dataset.list?JSON.parse(n.dataset.list):[],i=[].slice.call(o.querySelectorAll("option")),c=[],u=[];n.classList.contains("formSelectMultiple_state_inited")||([].slice.call(o.querySelectorAll("option")).forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&r.push({value:t,text:l})}),n.dataset.list=JSON.stringify(r),n.classList.add("formSelectMultiple_state_inited")),i.forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&c.push({value:t,text:l})}),c=c.filter(function(e){return e.value!==a}),c.forEach(function(e){r.forEach(function(t,l){t.value===e.value&&r.splice(l,1)})}),u=r,e.render(n,c,u)}},e.handleClick=function(t){var l=t.target;if(l.classList.contains("formSelectMultiple__link")){t.preventDefault();var n=l.closest(".formSelectMultiple"),o=l.getAttribute("href"),a=n.dataset.list?JSON.parse(n.dataset.list):[],r=[].slice.call(n.querySelectorAll("a")),i=[],c=[];c=r.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}}).filter(function(e){return e.value!==o}),c.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),i=a,e.render(n,i,c)}},e.getValue=function(e){var t=[];if(e){var l=[].slice.call(e.querySelectorAll("a"));t=l.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}})}return t},e.render=function(e,t,l){var n=e.querySelector(".formSelectMultiple__select"),o=e.querySelector(".formSelectMultiple__list"),a='<option value=""></option>',r="";t.length>0&&t.forEach(function(e){a+='<option value="'+e.value+'">'+e.text+"</option>"}),l.length>0&&l.forEach(function(e){r+='<li class="formSelectMultiple__item"><a href="'+e.value+'" class="formSelectMultiple__link">'+e.text+"</a></li>"}),n&&(n.innerHTML=a),o&&(o.innerHTML=r),e.dispatchEvent(new Event("render"))},e.importDefaults=function(){e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.formSelectMultiple=new e}}(),function(){if(!("modules"in app&&"modal"in app.modules)){var e=function(){var e=this;e.html="",e.body="",e.container=document.querySelector(".modal"),e.openButton=document.querySelector(".modal_trigger"),e.closeButton=document.querySelector(".modal_close"),e.setupListener=function(){e.body.addEventListener("click",e.router)},e.router=function(t){var l=t.target;l.classList.contains("modal_trigger")?(t.preventDefault(),e.open(t.target)):l.classList.contains("modal_close")&&(t.preventDefault(),e.close(t.target))},e.open=function(t){var l=t.getAttribute("href"),n=document.querySelector(l),o=t.dataset.photo,a=t.dataset.title,r=t.dataset.description;n.querySelector(".authorInfo__preview img").src=o,n.querySelector(".authorInfo__title").innerHTML=a,n.querySelector(".authorInfo__text p").innerHTML=r,e.html.classList.add("modal_state_open"),n.classList.add("modal_state_open")},e.close=function(t){var l=t.closest(".modal");l.classList.remove("modal_state_open"),e.html.classList.remove("modal_state_open")},e.importDefaults=function(){e.html=app.modules.main.html,e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.modal=new e}}();var initApp=function(){if(!("modules"in app&&"main"in app.modules)){var e=function(){var e=this;e.html=document.querySelector("html"),e.body=document.querySelector("body"),e.modules=app.modules,e.library=new Library,e.initLibrary=function(){e.library.init()},e.initPolyfills=function(){Element.prototype.closest||(Element.prototype.closest=function(e){for(var t=this;t;){if(t.matches(e))return t;t=t.parentElement}return null}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector)},e.initModules=function(){for(var t in e.modules)e.modules.hasOwnProperty(t)&&"undefined"!=typeof e.modules[t].init&&"main"!==t&&"library"!==t&&e.modules[t].init()},e.init=function(){e.initLibrary(),e.initPolyfills(),e.initModules()}};"modules"in app||(app.modules={}),app.modules.main=new e,app.modules.main.init()}};window.addEventListener("load",initApp),function(){if(!("modules"in app&&"schedule"in app.modules)){var e=function(){var e=this;e.body="",e.getSchedule="",e.getPlace="",e.getSchool="",e.getAuthor="",e.expand="",e.getValue="",e.container=document.querySelector(".schedule"),e.resultNumber=document.querySelector(".schedule__arrow__text span"),e.content=document.querySelector(".scheduleList__content"),e.trigger=[].slice.call(document.querySelectorAll(".schedule__trigger")),e.schoolSelect=document.querySelector('.formSelectMultiple__select[name="school"]'),e.authorSelect=document.querySelector('.formSelectMultiple__select[name="author"]'),e.dateFromInput=document.querySelector('.formInput__input[name="from"]'),e.dateToInput=document.querySelector('.formInput__input[name="to"]'),e.schoolSelectMultiple=document.querySelector(".formSelectMultiple.formSelectMultiple_type_school"),e.authorSelectMultiple=document.querySelector(".formSelectMultiple.formSelectMultiple_type_author"),e.selectMultiple=[].slice.call(document.querySelectorAll(".formSelectMultiple")),e.template=document.querySelector("#scheduleItem-template").innerHTML,e.monthNames=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],e.dataList="",e.setupListener=function(){e.dateFromInput.addEventListener("change",e.getData),e.dateToInput.addEventListener("change",e.getData),e.selectMultiple.forEach(function(t){t.addEventListener("render",e.getData)}),e.trigger.forEach(function(t){t.addEventListener("click",e.showFilter)})},e.showFilter=function(t){t.preventDefault(),e.container.classList.contains("schedule_state_filter")?e.container.classList.remove("schedule_state_filter"):e.container.classList.add("schedule_state_filter")},e.setupSchoolFilter=function(){e.getSchool().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.schoolSelect.innerHTML=l})},e.setupAuthorFilter=function(){e.getAuthor().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.authorSelect.innerHTML=l})},e.getData=function(){var t=e.dateFromInput.value.replace(/-/g,"/"),l=e.dateToInput.value.replace(/-/g,"/"),n=e.getValue(e.schoolSelectMultiple),o=e.getValue(e.authorSelectMultiple);e.getSchedule(t,l,"").then(function(t){n.length>0&&(t.lectures=t.lectures.filter(function(e){var t=!1;return n.forEach(function(l){e.school.indexOf(parseInt(l.value))!==-1&&(t=!0)}),t})),o.length>0&&(t.lectures=t.lectures.filter(function(e){var t=!1;return o.forEach(function(l){e.author.indexOf(parseInt(l.value))!==-1&&(t=!0)}),t})),e.render(t)})},e.render=function(t){var l=document.createElement("ul");if(l.classList.add("scheduleList__list"),t.lectures.forEach(function(n){var o=document.createElement("li");o.classList.add("scheduleList__item"),o.innerHTML=e.template;var a=new Date(n.date),r=a.getDate(),i=e.monthNames[a.getMonth()],c=[],u=[];n.school.forEach(function(l){var n=e.expand([l],{title:"schools",data:t.schools},"title"),o=e.expand([l],{title:"schools",data:t.schools},"id");c.push('<span class="scheduleItem__school__item scheduleItem__school__item_'+o+'">'+n+"</span>")}),n.author.forEach(function(l){var n=e.expand([l],{title:"authors",data:t.authors},"title"),o=e.expand([l],{title:"authors",data:t.authors},"photo"),a=e.expand([l],{title:"authors",data:t.authors},"description");u.push('<a class="scheduleItem__author__link modal_trigger" href="#author-modal" title="Посмотреть дополнительную информацию" data-photo="'+o+'" data-title="'+n+'" data-description="'+a+'">'+n+"</a>")}),n.isOver&&o.querySelector(".scheduleItem").classList.add("scheduleItem_state_inactive"),o.querySelector(".scheduleItem__day").innerHTML=r,o.querySelector(".scheduleItem__month").innerHTML=i,o.querySelector(".scheduleItem__time").innerHTML=n.time,o.querySelector(".scheduleItem__title").innerHTML=n.title,o.querySelector(".scheduleItem__school").innerHTML=c.join(""),o.querySelector(".scheduleItem__author").innerHTML+=u.join(", "),o.querySelector(".scheduleItem__audience").innerHTML+=e.expand([n.place],{title:"places",data:t.places},"title"),o.querySelector(".scheduleItem__place__link").innerHTML=e.expand([n.place],{title:"places",data:t.places},"address"),o.querySelector(".scheduleItem__place__link").href=e.expand([n.place],{title:"places",data:t.places},"link"),l.appendChild(o)}),0===t.lectures.length){var n=document.createElement("li");n.classList.add("scheduleList__item"),n.classList.add("scheduleList__item_state_empty"),n.innerHTML="По вашему запросу ничего не найдено.",l.appendChild(n)}e.content.innerHTML="",e.content.appendChild(l),e.resultNumber.innerHTML=t.lectures.length},e.importDefaults=function(){e.body=app.modules.main.body,e.getSchedule=app.modules.main.library.getSchedule,e.getSchool=app.modules.main.library.getSchool,e.getAuthor=app.modules.main.library.getAuthor,e.expand=app.modules.main.library.expand,e.getValue=app.modules.formSelectMultiple.getValue},e.init=function(){e.container&&(e.importDefaults(),e.setupSchoolFilter(),e.setupAuthorFilter(),e.getData(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.schedule=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvcm1TZWxlY3RNdWx0aXBsZS9mb3JtU2VsZWN0TXVsdGlwbGUuanMiLCJtb2RhbC9tb2RhbC5qcyIsIm1haW4vbWFpbi5qcyIsInNjaGVkdWxlL3NjaGVkdWxlLmpzIl0sIm5hbWVzIjpbImFwcCIsIm1vZHVsZXMiLCJGb3JtU2VsZWN0TXVsdGlwbGUiLCJzZWxmIiwidGhpcyIsImJvZHkiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzZXR1cExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZUNoYW5nZSIsImhhbmRsZUNsaWNrIiwiZXZlbnQiLCJ0YXJnZXQiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImNsb3Nlc3QiLCJzZWxlY3QiLCJzZWxlY3RlZFZhbHVlIiwidmFsdWUiLCJpbml0aWFsTGlzdCIsImRhdGFzZXQiLCJsaXN0IiwiSlNPTiIsInBhcnNlIiwib3B0aW9ucyIsInNsaWNlIiwiY2FsbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJzZWxlY3RMaXN0IiwicmVzdWx0TGlzdCIsImZvckVhY2giLCJpdGVtIiwidGV4dCIsImlubmVySFRNTCIsInB1c2giLCJzdHJpbmdpZnkiLCJhZGQiLCJmaWx0ZXIiLCJzZWxlY3RJdGVtIiwiaW5pdGlhbEl0ZW0iLCJpbmRleCIsInNwbGljZSIsInJlbmRlciIsInByZXZlbnREZWZhdWx0IiwiZ2V0QXR0cmlidXRlIiwibGlua3MiLCJtYXAiLCJyZXN1bHRJdGVtIiwiZ2V0VmFsdWUiLCJzZWxlY3REYXRhIiwicmVzdWx0RGF0YSIsInNlbGVjdENvbnRhaW5lciIsInJlc3VsdENvbnRhaW5lciIsInNlbGVjdEh0bWwiLCJyZXN1bHRIdG1sIiwibGVuZ3RoIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwiaW1wb3J0RGVmYXVsdHMiLCJtYWluIiwiaW5pdCIsImZvcm1TZWxlY3RNdWx0aXBsZSIsIk1vZGFsIiwiaHRtbCIsIm9wZW5CdXR0b24iLCJjbG9zZUJ1dHRvbiIsInJvdXRlciIsIm9wZW4iLCJjbG9zZSIsInNyYyIsInBob3RvIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInJlbW92ZSIsIm1vZGFsIiwiaW5pdEFwcCIsIk1haW4iLCJsaWJyYXJ5IiwiTGlicmFyeSIsImluaXRMaWJyYXJ5IiwiaW5pdFBvbHlmaWxscyIsIkVsZW1lbnQiLCJwcm90b3R5cGUiLCJjc3MiLCJub2RlIiwibWF0Y2hlcyIsInBhcmVudEVsZW1lbnQiLCJtYXRjaGVzU2VsZWN0b3IiLCJ3ZWJraXRNYXRjaGVzU2VsZWN0b3IiLCJtb3pNYXRjaGVzU2VsZWN0b3IiLCJtc01hdGNoZXNTZWxlY3RvciIsImluaXRNb2R1bGVzIiwibW9kdWxlIiwiaGFzT3duUHJvcGVydHkiLCJ3aW5kb3ciLCJTY2hlZHVsZSIsImdldFNjaGVkdWxlIiwiZ2V0UGxhY2UiLCJnZXRTY2hvb2wiLCJnZXRBdXRob3IiLCJleHBhbmQiLCJyZXN1bHROdW1iZXIiLCJjb250ZW50IiwidHJpZ2dlciIsInNjaG9vbFNlbGVjdCIsImF1dGhvclNlbGVjdCIsImRhdGVGcm9tSW5wdXQiLCJkYXRlVG9JbnB1dCIsInNjaG9vbFNlbGVjdE11bHRpcGxlIiwiYXV0aG9yU2VsZWN0TXVsdGlwbGUiLCJzZWxlY3RNdWx0aXBsZSIsInRlbXBsYXRlIiwibW9udGhOYW1lcyIsImRhdGFMaXN0IiwiZ2V0RGF0YSIsInNob3dGaWx0ZXIiLCJzZXR1cFNjaG9vbEZpbHRlciIsInRoZW4iLCJyZXNwb25zZSIsImlkIiwic2V0dXBBdXRob3JGaWx0ZXIiLCJkYXRlRnJvbSIsInJlcGxhY2UiLCJkYXRlVG8iLCJzY2hvb2wiLCJhdXRob3IiLCJsZWN0dXJlcyIsInJlc3VsdCIsInNjaG9vbEl0ZW0iLCJpbmRleE9mIiwicGFyc2VJbnQiLCJhdXRob3JJdGVtIiwiY29udGVudExpc3QiLCJjcmVhdGVFbGVtZW50IiwiZWxlbWVudCIsImRhdGUiLCJEYXRlIiwiZGF5IiwiZ2V0RGF0ZSIsIm1vbnRoIiwiZ2V0TW9udGgiLCJpdGVtVGl0bGUiLCJkYXRhIiwic2Nob29scyIsIml0ZW1JZCIsImF1dGhvcnMiLCJpdGVtUGhvdG8iLCJpdGVtRGVzY3JpcHRpb24iLCJpc092ZXIiLCJ0aW1lIiwiam9pbiIsInBsYWNlIiwicGxhY2VzIiwiaHJlZiIsImFwcGVuZENoaWxkIiwic2NoZWR1bGUiXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsS0FBQSxXQUFBQSxNQUFBLHNCQUFBQSxLQUFBQyxTQUFBLENBUUEsR0FBQUMsR0FBQSxXQUNBLEdBQUFDLEdBQUFDLElBRUFELEdBQUFFLEtBQUEsR0FDQUYsRUFBQUcsVUFBQUMsU0FBQUMsY0FBQSx1QkFLQUwsRUFBQU0sY0FBQSxXQUNBTixFQUFBRSxLQUFBSyxpQkFBQSxTQUFBUCxFQUFBUSxjQUNBUixFQUFBRSxLQUFBSyxpQkFBQSxRQUFBUCxFQUFBUyxjQU9BVCxFQUFBUSxhQUFBLFNBQUFFLEdBQ0EsR0FBQUMsR0FBQUQsRUFBQUMsTUFFQSxJQUFBQSxFQUFBQyxVQUFBQyxTQUFBLDhCQUFBLENBRUEsR0FBQVYsR0FBQVEsRUFBQUcsUUFBQSx1QkFDQUMsRUFBQVosRUFBQUUsY0FBQSwrQkFDQVcsRUFBQUQsRUFBQUUsTUFDQUMsRUFBQWYsRUFBQWdCLFFBQUFDLEtBQUFDLEtBQUFDLE1BQUFuQixFQUFBZ0IsUUFBQUMsU0FDQUcsS0FBQUMsTUFBQUMsS0FBQVYsRUFBQVcsaUJBQUEsV0FDQUMsS0FDQUMsSUFFQXpCLEdBQUFTLFVBQUFDLFNBQUEsd0NBRUFXLE1BQUFDLEtBQUFWLEVBQUFXLGlCQUFBLFdBQUFHLFFBQUEsU0FBQUMsR0FDQSxHQUFBYixHQUFBYSxFQUFBYixNQUNBYyxFQUFBRCxFQUFBRSxTQUVBZixJQUFBYyxHQUVBYixFQUFBZSxNQUNBaEIsTUFBQUEsRUFDQWMsS0FBQUEsTUFNQTVCLEVBQUFnQixRQUFBQyxLQUFBQyxLQUFBYSxVQUFBaEIsR0FFQWYsRUFBQVMsVUFBQXVCLElBQUEsb0NBSUFaLEVBQUFNLFFBQUEsU0FBQUMsR0FDQSxHQUFBYixHQUFBYSxFQUFBYixNQUNBYyxF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ZUFBQSxXQUNBekQsRUFBQUUsS0FBQUwsSUFBQUMsUUFBQTRELEtBQUF4RCxLQUNBRixFQUFBK0YsWUFBQWxHLElBQUFDLFFBQUE0RCxLQUFBa0IsUUFBQW1CLFlBQ0EvRixFQUFBaUcsVUFBQXBHLElBQUFDLFFBQUE0RCxLQUFBa0IsUUFBQXFCLFVBQ0FqRyxFQUFBa0csVUFBQXJHLElBQUFDLFFBQUE0RCxLQUFBa0IsUUFBQXNCLFVBQ0FsRyxFQUFBbUcsT0FBQXRHLElBQUFDLFFBQUE0RCxLQUFBa0IsUUFBQXVCLE9BQ0FuRyxFQUFBK0MsU0FBQWxELElBQUFDLFFBQUE4RCxtQkFBQWIsVUFNQS9DLEVBQUEyRCxLQUFBLFdBQ0EzRCxFQUFBRyxZQUVBSCxFQUFBeUQsaUJBQ0F6RCxFQUFBbUgsb0JBQ0FuSCxFQUFBdUgsb0JBQ0F2SCxFQUFBaUgsVUFDQWpILEVBQUFNLGtCQU1BLFlBQUFULE9BQ0FBLElBQUFDLFlBR0FELElBQUFDLFFBQUE0SixTQUFBLEdBQUE1RCIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ2Zvcm1TZWxlY3RNdWx0aXBsZScgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgRm9ybVNlbGVjdE11bHRpcGxlIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBGb3JtU2VsZWN0TXVsdGlwbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmJvZHkgPSAnJztcbiAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlJyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNlbGYuaGFuZGxlQ2hhbmdlKTtcbiAgICAgICAgICAgIHNlbGYuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYuaGFuZGxlQ2xpY2spO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgY2hhbmdlIGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5oYW5kbGVDaGFuZ2UgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0JykpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0YXJnZXQuY2xvc2VzdCgnLmZvcm1TZWxlY3RNdWx0aXBsZScpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3QgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0JyksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkVmFsdWUgPSBzZWxlY3QudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0ID0gY29udGFpbmVyLmRhdGFzZXQubGlzdCA/IEpTT04ucGFyc2UoY29udGFpbmVyLmRhdGFzZXQubGlzdCkgOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IFtdLnNsaWNlLmNhbGwoc2VsZWN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ29wdGlvbicpKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IFtdLFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gW107XG5cbiAgICAgICAgICAgICAgICBpZiAoIWNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9zdGF0ZV9pbml0ZWQnKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIFtdLnNsaWNlLmNhbGwoc2VsZWN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ29wdGlvbicpKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdGV4dCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QgPSBKU09OLnN0cmluZ2lmeShpbml0aWFsTGlzdCk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9zdGF0ZV9pbml0ZWQnKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHRleHQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0TGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IHNlbGVjdExpc3QuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgIT09IHNlbGVjdGVkVmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RMaXN0LmZvckVhY2goZnVuY3Rpb24oc2VsZWN0SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGluaXRpYWxJdGVtLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxJdGVtLnZhbHVlID09PSBzZWxlY3RJdGVtLnZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IGluaXRpYWxMaXN0O1xuXG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoY29udGFpbmVyLCBzZWxlY3RMaXN0LCByZXN1bHRMaXN0KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgY2xpY2sgZXZlbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmhhbmRsZUNsaWNrID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdmb3JtU2VsZWN0TXVsdGlwbGVfX2xpbmsnKSkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0YXJnZXQuY2xvc2VzdCgnLmZvcm1TZWxlY3RNdWx0aXBsZScpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdCA9IGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QgPyBKU09OLnBhcnNlKGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QpIDogW10sXG4gICAgICAgICAgICAgICAgICAgIGxpbmtzID0gW10uc2xpY2UuY2FsbChjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYScpKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IFtdLFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gW107XG5cbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gbGlua3MubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBpdGVtLmlubmVySFRNTDtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgIT09IHNlbGVjdGVkVmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0LmZvckVhY2goZnVuY3Rpb24ocmVzdWx0SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGluaXRpYWxJdGVtLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxJdGVtLnZhbHVlID09PSByZXN1bHRJdGVtLnZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IGluaXRpYWxMaXN0O1xuXG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoY29udGFpbmVyLCBzZWxlY3RMaXN0LCByZXN1bHRMaXN0KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXR1cm4gY29udGFpbmVyIHNlbGVjdGVkIHZhbHVlXG4gICAgICAgICAqIEBwYXJhbSBjb250YWluZXJcbiAgICAgICAgICogQHJldHVybnMge0FycmF5fVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5nZXRWYWx1ZSA9IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgdmFyIHJlc3VsdExpc3QgPSBbXTtcblxuICAgICAgICAgICAgaWYgKGNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgdmFyIGxpbmtzID0gW10uc2xpY2UuY2FsbChjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYScpKTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBsaW5rcy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0TGlzdDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIGRhdGEgZm9yIGNvbnRhaW5lclxuICAgICAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGNvbnRhaW5lclxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBzZWxlY3REYXRhXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHJlc3VsdERhdGFcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVuZGVyID0gZnVuY3Rpb24oY29udGFpbmVyLCBzZWxlY3REYXRhLCByZXN1bHREYXRhKSB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0Q29udGFpbmVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdCcpLFxuICAgICAgICAgICAgICAgIHJlc3VsdENvbnRhaW5lciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19saXN0JyksXG4gICAgICAgICAgICAgICAgc2VsZWN0SHRtbCA9ICc8b3B0aW9uIHZhbHVlPVwiXCI+PC9vcHRpb24+JyxcbiAgICAgICAgICAgICAgICByZXN1bHRIdG1sID0gJyc7XG5cbiAgICAgICAgICAgIGlmIChzZWxlY3REYXRhLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgIHNlbGVjdERhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdEh0bWwgKz0gJzxvcHRpb24gdmFsdWU9XCInKyBpdGVtLnZhbHVlICsnXCI+JysgaXRlbS50ZXh0ICsnPC9vcHRpb24+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzdWx0RGF0YS5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICByZXN1bHREYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRIdG1sICs9ICc8bGkgY2xhc3M9XCJmb3JtU2VsZWN0TXVsdGlwbGVfX2l0ZW1cIj48YSBocmVmPVwiJysgaXRlbS52YWx1ZSArJ1wiIGNsYXNzPVwiZm9ybVNlbGVjdE11bHRpcGxlX19saW5rXCI+JysgaXRlbS50ZXh0ICsnPC9hPjwvbGk+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2VsZWN0Q29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RDb250YWluZXIuaW5uZXJIVE1MID0gc2VsZWN0SHRtbDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzdWx0Q29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MID0gcmVzdWx0SHRtbDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb250YWluZXIuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ3JlbmRlcicpKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW1wb3J0IHByb3BlcnRpZXMgZnJvbSBNYWluIGNsYXNzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkgPSBhcHAubW9kdWxlcy5tYWluLmJvZHk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cygpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiBhcHApKSB7XG4gICAgICAgIGFwcC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgYXBwLm1vZHVsZXMuZm9ybVNlbGVjdE11bHRpcGxlID0gbmV3IEZvcm1TZWxlY3RNdWx0aXBsZSgpO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ21vZGFsJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNb2RhbCBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgTW9kYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmh0bWwgPSAnJztcbiAgICAgICAgc2VsZi5ib2R5ID0gJyc7XG4gICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsJyk7XG4gICAgICAgIHNlbGYub3BlbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF90cmlnZ2VyJyk7XG4gICAgICAgIHNlbGYuY2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfY2xvc2UnKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLnJvdXRlcik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJvdXRlIGNsaWNrIGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yb3V0ZXIgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX3RyaWdnZXInKSkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHNlbGYub3BlbihldmVudC50YXJnZXQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX2Nsb3NlJykpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmNsb3NlKGV2ZW50LnRhcmdldCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLm9wZW4gPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgICAgIHZhciBzcmMgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzcmMpLFxuICAgICAgICAgICAgICAgIHBob3RvID0gdGFyZ2V0LmRhdGFzZXQucGhvdG8sXG4gICAgICAgICAgICAgICAgdGl0bGUgPSB0YXJnZXQuZGF0YXNldC50aXRsZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHRhcmdldC5kYXRhc2V0LmRlc2NyaXB0aW9uO1xuXG4gICAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmF1dGhvckluZm9fX3ByZXZpZXcgaW1nJykuc3JjID0gcGhvdG87XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYXV0aG9ySW5mb19fdGl0bGUnKS5pbm5lckhUTUwgPSB0aXRsZTtcblxuICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5hdXRob3JJbmZvX190ZXh0IHAnKS5pbm5lckhUTUwgPSBkZXNjcmlwdGlvbjtcblxuICAgICAgICAgICAgc2VsZi5odG1sLmNsYXNzTGlzdC5hZGQoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5jbG9zZSA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRhcmdldC5jbG9zZXN0KCcubW9kYWwnKTtcblxuICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgICAgIHNlbGYuaHRtbC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEltcG9ydCBwcm9wZXJ0aWVzIGZyb20gTWFpbiBjbGFzc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5odG1sID0gYXBwLm1vZHVsZXMubWFpbi5odG1sO1xuICAgICAgICAgICAgc2VsZi5ib2R5ID0gYXBwLm1vZHVsZXMubWFpbi5ib2R5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5jb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLm1vZGFsID0gbmV3IE1vZGFsKCk7XG59KSgpO1xuIiwidmFyIGluaXRBcHAgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnbWFpbicgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgTWFpbiBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgTWFpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5odG1sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaHRtbCcpO1xuICAgICAgICBzZWxmLmJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG4gICAgICAgIHNlbGYubW9kdWxlcyA9IGFwcC5tb2R1bGVzO1xuICAgICAgICBzZWxmLmxpYnJhcnkgPSBuZXcgTGlicmFyeSgpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IGxpYnJhcnkgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRMaWJyYXJ5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmxpYnJhcnkuaW5pdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IHBvbHlGaWxsc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0UG9seWZpbGxzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIUVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QpIHtcblxuICAgICAgICAgICAgICAgIEVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QgPSBmdW5jdGlvbihjc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGUgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5tYXRjaGVzKGNzcykpIHJldHVybiBub2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBub2RlID0gbm9kZS5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFFbGVtZW50LnByb3RvdHlwZS5tYXRjaGVzKSB7XG5cbiAgICAgICAgICAgICAgICBFbGVtZW50LnByb3RvdHlwZS5tYXRjaGVzID0gRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlc1NlbGVjdG9yIHx8XG4gICAgICAgICAgICAgICAgICAgIEVsZW1lbnQucHJvdG90eXBlLndlYmtpdE1hdGNoZXNTZWxlY3RvciB8fFxuICAgICAgICAgICAgICAgICAgICBFbGVtZW50LnByb3RvdHlwZS5tb3pNYXRjaGVzU2VsZWN0b3IgfHxcbiAgICAgICAgICAgICAgICAgICAgRWxlbWVudC5wcm90b3R5cGUubXNNYXRjaGVzU2VsZWN0b3I7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBhbGwgbW9kdWxlcyBpbiAkLm1vZHVsZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdE1vZHVsZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGZvciAodmFyIG1vZHVsZSBpbiBzZWxmLm1vZHVsZXMpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzZWxmLm1vZHVsZXMuaGFzT3duUHJvcGVydHkobW9kdWxlKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VsZi5tb2R1bGVzW21vZHVsZV0uaW5pdCAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlICE9PSAnbWFpbicgJiYgbW9kdWxlICE9PSAnbGlicmFyeScpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2R1bGVzW21vZHVsZV0uaW5pdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmluaXRMaWJyYXJ5KCk7XG4gICAgICAgICAgICBzZWxmLmluaXRQb2x5ZmlsbHMoKTtcbiAgICAgICAgICAgIHNlbGYuaW5pdE1vZHVsZXMoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5tYWluID0gbmV3IE1haW4oKTtcblxuICAgIGFwcC5tb2R1bGVzLm1haW4uaW5pdCgpO1xufTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBpbml0QXBwKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnc2NoZWR1bGUnIGluIGFwcC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IFNjaGVkdWxlIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBTY2hlZHVsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuYm9keSA9ICcnO1xuICAgICAgICBzZWxmLmdldFNjaGVkdWxlID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0UGxhY2UgPSAnJztcbiAgICAgICAgc2VsZi5nZXRTY2hvb2wgPSAnJztcbiAgICAgICAgc2VsZi5nZXRBdXRob3IgPSAnJztcbiAgICAgICAgc2VsZi5leHBhbmQgPSAnJztcbiAgICAgICAgc2VsZi5nZXRWYWx1ZSA9ICcnO1xuICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZScpO1xuICAgICAgICBzZWxmLnJlc3VsdE51bWJlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZV9fYXJyb3dfX3RleHQgc3BhbicpO1xuICAgICAgICBzZWxmLmNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVMaXN0X19jb250ZW50Jyk7XG4gICAgICAgIHNlbGYudHJpZ2dlciA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNjaGVkdWxlX190cmlnZ2VyJykpO1xuICAgICAgICBzZWxmLnNjaG9vbFNlbGVjdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdFtuYW1lPVwic2Nob29sXCJdJyk7XG4gICAgICAgIHNlbGYuYXV0aG9yU2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0W25hbWU9XCJhdXRob3JcIl0nKTtcbiAgICAgICAgc2VsZi5kYXRlRnJvbUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1JbnB1dF9faW5wdXRbbmFtZT1cImZyb21cIl0nKTtcbiAgICAgICAgc2VsZi5kYXRlVG9JbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtSW5wdXRfX2lucHV0W25hbWU9XCJ0b1wiXScpO1xuICAgICAgICBzZWxmLnNjaG9vbFNlbGVjdE11bHRpcGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZS5mb3JtU2VsZWN0TXVsdGlwbGVfdHlwZV9zY2hvb2wnKTtcbiAgICAgICAgc2VsZi5hdXRob3JTZWxlY3RNdWx0aXBsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGUuZm9ybVNlbGVjdE11bHRpcGxlX3R5cGVfYXV0aG9yJyk7XG4gICAgICAgIHNlbGYuc2VsZWN0TXVsdGlwbGUgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKSk7XG4gICAgICAgIHNlbGYudGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2NoZWR1bGVJdGVtLXRlbXBsYXRlJykuaW5uZXJIVE1MO1xuICAgICAgICBzZWxmLm1vbnRoTmFtZXMgPSBbXG4gICAgICAgICAgICAn0Y/QvdCy0LDRgNGMJyxcbiAgICAgICAgICAgICfRhNC10LLRgNCw0LvRjCcsXG4gICAgICAgICAgICAn0LzQsNGA0YInLFxuICAgICAgICAgICAgJ9Cw0L/RgNC10LvRjCcsXG4gICAgICAgICAgICAn0LzQsNC5JyxcbiAgICAgICAgICAgICfQuNGO0L3RjCcsXG4gICAgICAgICAgICAn0LjRjtC70YwnLFxuICAgICAgICAgICAgJ9Cw0LLQs9GD0YHRgicsXG4gICAgICAgICAgICAn0YHQtdC90YLRj9Cx0YDRjCcsXG4gICAgICAgICAgICAn0L7QutGC0Y/QsdGA0YwnLFxuICAgICAgICAgICAgJ9C90L7Rj9Cx0YDRjCcsXG4gICAgICAgICAgICAn0LTQtdC60LDQsdGA0YwnXG4gICAgICAgIF07XG4gICAgICAgIHNlbGYuZGF0YUxpc3QgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmRhdGVGcm9tSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgc2VsZi5nZXREYXRhKTtcbiAgICAgICAgICAgIHNlbGYuZGF0ZVRvSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgc2VsZi5nZXREYXRhKTtcbiAgICAgICAgICAgIHNlbGYuc2VsZWN0TXVsdGlwbGUuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7aXRlbS5hZGRFdmVudExpc3RlbmVyKCdyZW5kZXInLCBzZWxmLmdldERhdGEpO30pO1xuICAgICAgICAgICAgc2VsZi50cmlnZ2VyLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge2l0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLnNob3dGaWx0ZXIpfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgZmlsdGVyIGNvbnRhaW5lclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2hvd0ZpbHRlciA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBpZiAoc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzY2hlZHVsZV9zdGF0ZV9maWx0ZXInKSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2NoZWR1bGVfc3RhdGVfZmlsdGVyJyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZV9zdGF0ZV9maWx0ZXInKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXR1cCBzY2hvb2wgZmlsdGVyIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cFNjaG9vbEZpbHRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5nZXRTY2hvb2woKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPG9wdGlvbiB2YWx1ZT1cIlwiPjwvb3B0aW9uPic7XG5cbiAgICAgICAgICAgICAgICByZXNwb25zZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPG9wdGlvbiB2YWx1ZT1cIicrIGl0ZW0uaWQgKydcIj4nKyBpdGVtLnRpdGxlICsnPC9vcHRpb24+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGYuc2Nob29sU2VsZWN0LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0dXAgYXV0aG9yIGZpbHRlciB2YWx1ZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBBdXRob3JGaWx0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuZ2V0QXV0aG9yKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBodG1sID0gJzxvcHRpb24gdmFsdWU9XCJcIj48L29wdGlvbj4nO1xuXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxvcHRpb24gdmFsdWU9XCInKyBpdGVtLmlkICsnXCI+JysgaXRlbS50aXRsZSArJzwvb3B0aW9uPic7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmF1dGhvclNlbGVjdC5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBkYXRhIGZyb20gbGlicmFyeSBhY2NvcmRpbmcgdG8gZmlsdGVyIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5nZXREYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZGF0ZUZyb20gPSBzZWxmLmRhdGVGcm9tSW5wdXQudmFsdWUucmVwbGFjZSgvLS9nLCAnLycpLFxuICAgICAgICAgICAgICAgIGRhdGVUbyA9IHNlbGYuZGF0ZVRvSW5wdXQudmFsdWUucmVwbGFjZSgvLS9nLCAnLycpLFxuICAgICAgICAgICAgICAgIHNjaG9vbCA9IHNlbGYuZ2V0VmFsdWUoc2VsZi5zY2hvb2xTZWxlY3RNdWx0aXBsZSksXG4gICAgICAgICAgICAgICAgYXV0aG9yID0gc2VsZi5nZXRWYWx1ZShzZWxmLmF1dGhvclNlbGVjdE11bHRpcGxlKTtcblxuICAgICAgICAgICAgc2VsZi5nZXRTY2hlZHVsZShkYXRlRnJvbSwgZGF0ZVRvLCAnJykudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChzY2hvb2wubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmxlY3R1cmVzID0gcmVzcG9uc2UubGVjdHVyZXMuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2Nob29sLmZvckVhY2goZnVuY3Rpb24oc2Nob29sSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNjaG9vbC5pbmRleE9mKHBhcnNlSW50KHNjaG9vbEl0ZW0udmFsdWUpKSAhPT0gLTEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGF1dGhvci5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubGVjdHVyZXMgPSByZXNwb25zZS5sZWN0dXJlcy5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRob3IuZm9yRWFjaChmdW5jdGlvbihhdXRob3JJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uYXV0aG9yLmluZGV4T2YocGFyc2VJbnQoYXV0aG9ySXRlbS52YWx1ZSkpICE9PSAtMSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcihyZXNwb25zZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIHNjaGVkdWxlIGxpc3RcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHJlc3BvbnNlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlbmRlciA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudExpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuXG4gICAgICAgICAgICBjb250ZW50TGlzdC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2xpc3QnKTtcblxuICAgICAgICAgICAgcmVzcG9uc2UubGVjdHVyZXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2l0ZW0nKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IHNlbGYudGVtcGxhdGU7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGl0ZW0uZGF0ZSksXG4gICAgICAgICAgICAgICAgICAgIGRheSA9IGRhdGUuZ2V0RGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgICBtb250aCA9IHNlbGYubW9udGhOYW1lc1tkYXRlLmdldE1vbnRoKCldLFxuICAgICAgICAgICAgICAgICAgICBzY2hvb2wgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yID0gW107XG5cbiAgICAgICAgICAgICAgICBpdGVtLnNjaG9vbC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1UaXRsZSA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnc2Nob29scycsIGRhdGE6IHJlc3BvbnNlLnNjaG9vbHN9LCAndGl0bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1JZCA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnc2Nob29scycsIGRhdGE6IHJlc3BvbnNlLnNjaG9vbHN9LCAnaWQnKTtcblxuICAgICAgICAgICAgICAgICAgICBzY2hvb2wucHVzaCgnPHNwYW4gY2xhc3M9XCJzY2hlZHVsZUl0ZW1fX3NjaG9vbF9faXRlbSBzY2hlZHVsZUl0ZW1fX3NjaG9vbF9faXRlbV8nKyBpdGVtSWQgKydcIj4nKyBpdGVtVGl0bGUgKyc8L3NwYW4+Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdGVtLmF1dGhvci5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1UaXRsZSA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAndGl0bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1QaG90byA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAncGhvdG8nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1EZXNjcmlwdGlvbiA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAnZGVzY3JpcHRpb24nKTtcblxuICAgICAgICAgICAgICAgICAgICBhdXRob3IucHVzaCgnPGEgY2xhc3M9XCJzY2hlZHVsZUl0ZW1fX2F1dGhvcl9fbGluayBtb2RhbF90cmlnZ2VyXCIgaHJlZj1cIiNhdXRob3ItbW9kYWxcIiB0aXRsZT1cItCf0L7RgdC80L7RgtGA0LXRgtGMINC00L7Qv9C+0LvQvdC40YLQtdC70YzQvdGD0Y4g0LjQvdGE0L7RgNC80LDRhtC40Y5cIiBkYXRhLXBob3RvPVwiJysgaXRlbVBob3RvICsnXCIgZGF0YS10aXRsZT1cIicrIGl0ZW1UaXRsZSArJ1wiIGRhdGEtZGVzY3JpcHRpb249XCInKyBpdGVtRGVzY3JpcHRpb24gKydcIj4nKyBpdGVtVGl0bGUgKyc8L2E+Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pc092ZXIpIHtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW0nKS5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUl0ZW1fc3RhdGVfaW5hY3RpdmUnKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fZGF5JykuaW5uZXJIVE1MID0gZGF5O1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19tb250aCcpLmlubmVySFRNTCA9IG1vbnRoO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX190aW1lJykuaW5uZXJIVE1MID0gaXRlbS50aW1lO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX190aXRsZScpLmlubmVySFRNTCA9IGl0ZW0udGl0bGU7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3NjaG9vbCcpLmlubmVySFRNTCA9IHNjaG9vbC5qb2luKCcnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fYXV0aG9yJykuaW5uZXJIVE1MICs9IGF1dGhvci5qb2luKCcsICcpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19hdWRpZW5jZScpLmlubmVySFRNTCArPSBzZWxmLmV4cGFuZChbaXRlbS5wbGFjZV0sIHt0aXRsZTogJ3BsYWNlcycsIGRhdGE6IHJlc3BvbnNlLnBsYWNlc30sICd0aXRsZScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19wbGFjZV9fbGluaycpLmlubmVySFRNTCA9IHNlbGYuZXhwYW5kKFtpdGVtLnBsYWNlXSwge3RpdGxlOiAncGxhY2VzJywgZGF0YTogcmVzcG9uc2UucGxhY2VzfSwgJ2FkZHJlc3MnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fcGxhY2VfX2xpbmsnKS5ocmVmID0gc2VsZi5leHBhbmQoW2l0ZW0ucGxhY2VdLCB7dGl0bGU6ICdwbGFjZXMnLCBkYXRhOiByZXNwb25zZS5wbGFjZXN9LCAnbGluaycpO1xuXG4gICAgICAgICAgICAgICAgY29udGVudExpc3QuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxlY3R1cmVzLmxlbmd0aCA9PT0gMCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2l0ZW0nKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2NoZWR1bGVMaXN0X19pdGVtX3N0YXRlX2VtcHR5Jyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9ICfQn9C+INCy0LDRiNC10LzRgyDQt9Cw0L/RgNC+0YHRgyDQvdC40YfQtdCz0L4g0L3QtSDQvdCw0LnQtNC10L3Qvi4nO1xuXG4gICAgICAgICAgICAgICAgY29udGVudExpc3QuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlbGYuY29udGVudC5pbm5lckhUTUwgPSAnJztcblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmFwcGVuZENoaWxkKGNvbnRlbnRMaXN0KTtcblxuICAgICAgICAgICAgc2VsZi5yZXN1bHROdW1iZXIuaW5uZXJIVE1MID0gcmVzcG9uc2UubGVjdHVyZXMubGVuZ3RoO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbXBvcnQgcHJvcGVydGllcyBmcm9tIE1haW4gY2xhc3NcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keSA9IGFwcC5tb2R1bGVzLm1haW4uYm9keTtcbiAgICAgICAgICAgIHNlbGYuZ2V0U2NoZWR1bGUgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZ2V0U2NoZWR1bGU7XG4gICAgICAgICAgICBzZWxmLmdldFNjaG9vbCA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5nZXRTY2hvb2w7XG4gICAgICAgICAgICBzZWxmLmdldEF1dGhvciA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5nZXRBdXRob3I7XG4gICAgICAgICAgICBzZWxmLmV4cGFuZCA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5leHBhbmQ7XG4gICAgICAgICAgICBzZWxmLmdldFZhbHVlID0gYXBwLm1vZHVsZXMuZm9ybVNlbGVjdE11bHRpcGxlLmdldFZhbHVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5jb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwU2Nob29sRmlsdGVyKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cEF1dGhvckZpbHRlcigpO1xuICAgICAgICAgICAgICAgIHNlbGYuZ2V0RGF0YSgpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiBhcHApKSB7XG4gICAgICAgIGFwcC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgYXBwLm1vZHVsZXMuc2NoZWR1bGUgPSBuZXcgU2NoZWR1bGUoKTtcbn0pKCk7XG4iXX0=

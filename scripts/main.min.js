var initApp=function(){if(!("modules"in app&&"main"in app.modules)){var e=function(){var e=this;e.html=document.querySelector("html"),e.body=document.querySelector("body"),e.modules=app.modules,e.library=new Library,e.initLibrary=function(){e.library.init()},e.initModules=function(){for(var t in e.modules)e.modules.hasOwnProperty(t)&&"undefined"!=typeof e.modules[t].init&&"main"!==t&&"library"!==t&&e.modules[t].init()},e.init=function(){e.initLibrary(),e.initModules()}};"modules"in app||(app.modules={}),app.modules.main=new e,app.modules.main.init()}};window.addEventListener("load",initApp),function(){if(!("modules"in app&&"modal"in app.modules)){var e=function(){var e=this;e.html="",e.body="",e.container=document.querySelector(".modal"),e.openButton=document.querySelector(".modal_trigger"),e.closeButton=document.querySelector(".modal_close"),e.setupListener=function(){e.body.addEventListener("click",e.router)},e.router=function(t){var l=t.target;l.classList.contains("modal_trigger")?(t.preventDefault(),e.open(t.target)):l.classList.contains("modal_close")&&(t.preventDefault(),e.close(t.target))},e.open=function(t){var l=t.getAttribute("href"),n=document.querySelector(l),o=t.dataset.photo,a=t.dataset.title,i=t.dataset.description;n.querySelector(".authorInfo__preview img").src=o,n.querySelector(".authorInfo__title").innerHTML=a,n.querySelector(".authorInfo__text p").innerHTML=i,e.html.classList.add("modal_state_open"),n.classList.add("modal_state_open")},e.close=function(t){var l=t.closest(".modal");l.classList.remove("modal_state_open"),e.html.classList.remove("modal_state_open")},e.importDefaults=function(){e.html=app.modules.main.html,e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.modal=new e}}(),function(){if(!("modules"in app&&"schedule"in app.modules)){var e=function(){var e=this;e.body="",e.getSchedule="",e.getPlace="",e.getSchool="",e.getAuthor="",e.expand="",e.getValue="",e.container=document.querySelector(".schedule"),e.content=document.querySelector(".scheduleList__content"),e.trigger=document.querySelectorAll(".schedule__trigger"),e.schoolSelect=document.querySelector('.formSelectMultiple__select[name="school"]'),e.authorSelect=document.querySelector('.formSelectMultiple__select[name="author"]'),e.dateFromInput=document.querySelector('.formInput__input[name="from"]'),e.dateToInput=document.querySelector('.formInput__input[name="to"]'),e.schoolSelectMultiple=document.querySelector(".formSelectMultiple.formSelectMultiple_type_school"),e.authorSelectMultiple=document.querySelector(".formSelectMultiple.formSelectMultiple_type_author"),e.selectMultiple=document.querySelectorAll(".formSelectMultiple"),e.template=document.querySelector("#scheduleItem-template").innerHTML,e.monthNames=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],e.dataList="",e.setupListener=function(){e.dateFromInput.addEventListener("change",e.getData),e.dateToInput.addEventListener("change",e.getData),e.selectMultiple.forEach(function(t){t.addEventListener("render",e.getData)}),e.trigger.forEach(function(t){t.addEventListener("click",e.showFilter)})},e.showFilter=function(t){t.preventDefault(),e.container.classList.contains("schedule_state_filter")?e.container.classList.remove("schedule_state_filter"):e.container.classList.add("schedule_state_filter")},e.setupSchoolFilter=function(){e.getSchool().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.schoolSelect.innerHTML=l})},e.setupAuthorFilter=function(){e.getAuthor().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.authorSelect.innerHTML=l})},e.getData=function(){var t=e.dateFromInput.value.replace(/-/g,"/"),l=e.dateToInput.value.replace(/-/g,"/"),n=e.getValue(e.schoolSelectMultiple),o=e.getValue(e.authorSelectMultiple);e.getSchedule(t,l,"").then(function(t){n.length>0&&(t.lectures=t.lectures.filter(function(e){var t=!1;return n.forEach(function(l){e.school.indexOf(parseInt(l.value))!==-1&&(t=!0)}),t})),o.length>0&&(t.lectures=t.lectures.filter(function(e){var t=!1;return o.forEach(function(l){e.author.indexOf(parseInt(l.value))!==-1&&(t=!0)}),t})),e.render(t)})},e.render=function(t){var l=document.createElement("ul");if(l.classList.add("scheduleList__list"),t.lectures.forEach(function(n){var o=document.createElement("li");o.classList.add("scheduleList__item"),o.innerHTML=e.template;var a=new Date(n.date),i=a.getDate(),r=e.monthNames[a.getMonth()],u=[],c=[];n.school.forEach(function(l){var n=e.expand([l],{title:"schools",data:t.schools},"title"),o=e.expand([l],{title:"schools",data:t.schools},"id");u.push('<span class="scheduleItem__school__item scheduleItem__school__item_'+o+'">'+n+"</span>")}),n.author.forEach(function(l){var n=e.expand([l],{title:"authors",data:t.authors},"title"),o=e.expand([l],{title:"authors",data:t.authors},"photo"),a=e.expand([l],{title:"authors",data:t.authors},"description");c.push('<a class="scheduleItem__author__link modal_trigger" href="#author-modal" title="Посмотреть дополнительную информацию" data-photo="'+o+'" data-title="'+n+'" data-description="'+a+'">'+n+"</a>")}),n.isOver&&o.querySelector(".scheduleItem").classList.add("scheduleItem_state_inactive"),o.querySelector(".scheduleItem__day").innerHTML=i,o.querySelector(".scheduleItem__month").innerHTML=r,o.querySelector(".scheduleItem__time").innerHTML=n.time,o.querySelector(".scheduleItem__title").innerHTML=n.title,o.querySelector(".scheduleItem__school").innerHTML=u.join(""),o.querySelector(".scheduleItem__author").innerHTML+=c.join(", "),o.querySelector(".scheduleItem__audience").innerHTML+=e.expand([n.place],{title:"places",data:t.places},"title"),o.querySelector(".scheduleItem__place__link").innerHTML=e.expand([n.place],{title:"places",data:t.places},"address"),o.querySelector(".scheduleItem__place__link").href=e.expand([n.place],{title:"places",data:t.places},"link"),l.appendChild(o)}),0===t.lectures.length){var n=document.createElement("li");n.classList.add("scheduleList__item"),n.classList.add("scheduleList__item_state_empty"),n.innerHTML="По вашему запросу ничего не найдено.",l.appendChild(n)}e.content.innerHTML="",e.content.appendChild(l)},e.importDefaults=function(){e.body=app.modules.main.body,e.getSchedule=app.modules.main.library.getSchedule,e.getSchool=app.modules.main.library.getSchool,e.getAuthor=app.modules.main.library.getAuthor,e.expand=app.modules.main.library.expand,e.getValue=app.modules.formSelectMultiple.getValue},e.init=function(){e.container&&(e.importDefaults(),e.setupSchoolFilter(),e.setupAuthorFilter(),e.getData(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.schedule=new e}}(),function(){if(!("modules"in app&&"formSelectMultiple"in app.modules)){var e=function(){var e=this;e.body="",e.container=document.querySelector(".formSelectMultiple"),e.setupListener=function(){e.body.addEventListener("change",e.handleChange),e.body.addEventListener("click",e.handleClick)},e.handleChange=function(){var t=event.target;if(t.classList.contains("formSelectMultiple__select")){var l=t.closest(".formSelectMultiple"),n=l.querySelector(".formSelectMultiple__select"),o=n.value,a=l.dataset.list?JSON.parse(l.dataset.list):[],i=[].slice.call(n.querySelectorAll("option")),r=[],u=[];l.classList.contains("formSelectMultiple_state_inited")||([].slice.call(n.querySelectorAll("option")).forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&a.push({value:t,text:l})}),l.dataset.list=JSON.stringify(a),l.classList.add("formSelectMultiple_state_inited")),i.forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&r.push({value:t,text:l})}),r=r.filter(function(e){return e.value!==o}),r.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),u=a,e.render(l,r,u)}},e.handleClick=function(t){var l=t.target;if(l.classList.contains("formSelectMultiple__link")){t.preventDefault();var n=l.closest(".formSelectMultiple"),o=l.getAttribute("href"),a=n.dataset.list?JSON.parse(n.dataset.list):[],i=[].slice.call(n.querySelectorAll("a")),r=[],u=[];u=i.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}}).filter(function(e){return e.value!==o}),u.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),r=a,e.render(n,r,u)}},e.getValue=function(e){var t=[];if(e){var l=[].slice.call(e.querySelectorAll("a"));t=l.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}})}return t},e.render=function(e,t,l){var n=e.querySelector(".formSelectMultiple__select"),o=e.querySelector(".formSelectMultiple__list"),a='<option value=""></option>',i="";t.length>0&&t.forEach(function(e){a+='<option value="'+e.value+'">'+e.text+"</option>"}),l.length>0&&l.forEach(function(e){i+='<li class="formSelectMultiple__item"><a href="'+e.value+'" class="formSelectMultiple__link">'+e.text+"</a></li>"}),n&&(n.innerHTML=a),o&&(o.innerHTML=i),e.dispatchEvent(new Event("render"))},e.importDefaults=function(){e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.formSelectMultiple=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vbWFpbi5qcyIsIm1vZGFsL21vZGFsLmpzIiwic2NoZWR1bGUvc2NoZWR1bGUuanMiLCJmb3JtU2VsZWN0TXVsdGlwbGUvZm9ybVNlbGVjdE11bHRpcGxlLmpzIl0sIm5hbWVzIjpbImluaXRBcHAiLCJhcHAiLCJtb2R1bGVzIiwiTWFpbiIsInNlbGYiLCJ0aGlzIiwiaHRtbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJvZHkiLCJsaWJyYXJ5IiwiTGlicmFyeSIsImluaXRMaWJyYXJ5IiwiaW5pdCIsImluaXRNb2R1bGVzIiwibW9kdWxlIiwiaGFzT3duUHJvcGVydHkiLCJtYWluIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsIk1vZGFsIiwiY29udGFpbmVyIiwib3BlbkJ1dHRvbiIsImNsb3NlQnV0dG9uIiwic2V0dXBMaXN0ZW5lciIsInJvdXRlciIsImV2ZW50IiwidGFyZ2V0IiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJwcmV2ZW50RGVmYXVsdCIsIm9wZW4iLCJjbG9zZSIsInNyYyIsImdldEF0dHJpYnV0ZSIsInBob3RvIiwiZGF0YXNldCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJpbm5lckhUTUwiLCJhZGQiLCJjbG9zZXN0IiwicmVtb3ZlIiwiaW1wb3J0RGVmYXVsdHMiLCJtb2RhbCIsIlNjaGVkdWxlIiwiZ2V0U2NoZWR1bGUiLCJnZXRQbGFjZSIsImdldFNjaG9vbCIsImdldEF1dGhvciIsImV4cGFuZCIsImdldFZhbHVlIiwiY29udGVudCIsInRyaWdnZXIiLCJxdWVyeVNlbGVjdG9yQWxsIiwic2Nob29sU2VsZWN0IiwiYXV0aG9yU2VsZWN0IiwiZGF0ZUZyb21JbnB1dCIsImRhdGVUb0lucHV0Iiwic2Nob29sU2VsZWN0TXVsdGlwbGUiLCJhdXRob3JTZWxlY3RNdWx0aXBsZSIsInNlbGVjdE11bHRpcGxlIiwidGVtcGxhdGUiLCJtb250aE5hbWVzIiwiZGF0YUxpc3QiLCJnZXREYXRhIiwiZm9yRWFjaCIsIml0ZW0iLCJzaG93RmlsdGVyIiwic2V0dXBTY2hvb2xGaWx0ZXIiLCJ0aGVuIiwicmVzcG9uc2UiLCJpZCIsInNldHVwQXV0aG9yRmlsdGVyIiwiZGF0ZUZyb20iLCJ2YWx1ZSIsInJlcGxhY2UiLCJkYXRlVG8iLCJzY2hvb2wiLCJhdXRob3IiLCJsZW5ndGgiLCJsZWN0dXJlcyIsImZpbHRlciIsInJlc3VsdCIsInNjaG9vbEl0ZW0iLCJpbmRleE9mIiwicGFyc2VJbnQiLCJhdXRob3JJdGVtIiwicmVuZGVyIiwiY29udGVudExpc3QiLCJjcmVhdGVFbGVtZW50IiwiZWxlbWVudCIsImRhdGUiLCJEYXRlIiwiZGF5IiwiZ2V0RGF0ZSIsIm1vbnRoIiwiZ2V0TW9udGgiLCJpdGVtVGl0bGUiLCJkYXRhIiwic2Nob29scyIsIml0ZW1JZCIsInB1c2giLCJhdXRob3JzIiwiaXRlbVBob3RvIiwiaXRlbURlc2NyaXB0aW9uIiwiaXNPdmVyIiwidGltZSIsImpvaW4iLCJwbGFjZSIsInBsYWNlcyIsImhyZWYiLCJhcHBlbmRDaGlsZCIsImZvcm1TZWxlY3RNdWx0aXBsZSIsInNjaGVkdWxlIiwiRm9ybVNlbGVjdE11bHRpcGxlIiwiaGFuZGxlQ2hhbmdlIiwiaGFuZGxlQ2xpY2siLCJzZWxlY3QiLCJzZWxlY3RlZFZhbHVlIiwiaW5pdGlhbExpc3QiLCJsaXN0IiwiSlNPTiIsInBhcnNlIiwib3B0aW9ucyIsInNsaWNlIiwiY2FsbCIsInNlbGVjdExpc3QiLCJyZXN1bHRMaXN0IiwidGV4dCIsInN0cmluZ2lmeSIsInNlbGVjdEl0ZW0iLCJpbml0aWFsSXRlbSIsImluZGV4Iiwic3BsaWNlIiwibGlua3MiLCJtYXAiLCJyZXN1bHRJdGVtIiwic2VsZWN0RGF0YSIsInJlc3VsdERhdGEiLCJzZWxlY3RDb250YWluZXIiLCJyZXN1bHRDb250YWluZXIiLCJzZWxlY3RIdG1sIiwicmVzdWx0SHRtbCIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsU0FBQSxXQUNBLEtB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LEdBQUFrSCxNQUFBVixNQUFBQyxLQUFBekcsRUFBQWlDLGlCQUFBLEtBRUEwRSxHQUFBTyxFQUFBQyxJQUFBLFNBQUFyRSxHQUNBLEdBQUFRLEdBQUFSLEVBQUFqQyxhQUFBLFFBQ0ErRixFQUFBOUQsRUFBQTVCLFNBRUEsUUFDQW9DLE1BQUFBLEVBQ0FzRCxLQUFBQSxLQU1BLE1BQUFELElBU0E1SCxFQUFBb0YsT0FBQSxTQUFBbkUsRUFBQXFILEVBQUFDLEdBQ0EsR0FBQUMsR0FBQXZILEVBQUFiLGNBQUEsK0JBQ0FxSSxFQUFBeEgsRUFBQWIsY0FBQSw2QkFDQXNJLEVBQUEsNkJBQ0FDLEVBQUEsRUFFQUwsR0FBQTFELE9BQUEsR0FFQTBELEVBQUF4RSxRQUFBLFNBQUFDLEdBQ0EyRSxHQUFBLGtCQUFBM0UsRUFBQVEsTUFBQSxLQUFBUixFQUFBOEQsS0FBQSxjQUtBVSxFQUFBM0QsT0FBQSxHQUVBMkQsRUFBQXpFLFFBQUEsU0FBQUMsR0FDQTRFLEdBQUEsaURBQUE1RSxFQUFBUSxNQUFBLHNDQUFBUixFQUFBOEQsS0FBQSxjQUtBVyxJQUVBQSxFQUFBckcsVUFBQXVHLEdBSUFELElBRUFBLEVBQUF0RyxVQUFBd0csR0FJQTFILEVBQUEySCxjQUFBLEdBQUFDLE9BQUEsWUFNQTdJLEVBQUF1QyxlQUFBLFdBQ0F2QyxFQUFBSyxLQUFBUixJQUFBQyxRQUFBZSxLQUFBUixNQU1BTCxFQUFBUyxLQUFBLFdBQ0FULEVBQUFpQixZQUVBakIsRUFBQXVDLGlCQUNBdkMsRUFBQW9CLGtCQU1BLFlBQUF2QixPQUNBQSxJQUFBQyxZQUdBRCxJQUFBQyxRQUFBK0csbUJBQUEsR0FBQUUiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaW5pdEFwcCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gYXBwICYmICdtYWluJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNYWluIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBNYWluID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmh0bWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJyk7XG4gICAgICAgIHNlbGYuYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcbiAgICAgICAgc2VsZi5tb2R1bGVzID0gYXBwLm1vZHVsZXM7XG4gICAgICAgIHNlbGYubGlicmFyeSA9IG5ldyBMaWJyYXJ5KCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbGlicmFyeSBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdExpYnJhcnkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYubGlicmFyeS5pbml0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgYWxsIG1vZHVsZXMgaW4gJC5tb2R1bGVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRNb2R1bGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBtb2R1bGUgaW4gc2VsZi5tb2R1bGVzKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5tb2R1bGVzLmhhc093blByb3BlcnR5KG1vZHVsZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNlbGYubW9kdWxlc1ttb2R1bGVdLmluaXQgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZSAhPT0gJ21haW4nICYmIG1vZHVsZSAhPT0gJ2xpYnJhcnknKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubW9kdWxlc1ttb2R1bGVdLmluaXQoKTtcblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5pbml0TGlicmFyeSgpO1xuICAgICAgICAgICAgc2VsZi5pbml0TW9kdWxlcygpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLm1haW4gPSBuZXcgTWFpbigpO1xuXG4gICAgYXBwLm1vZHVsZXMubWFpbi5pbml0KCk7XG59O1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGluaXRBcHApO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnbW9kYWwnIGluIGFwcC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE1vZGFsIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBNb2RhbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuaHRtbCA9ICcnO1xuICAgICAgICBzZWxmLmJvZHkgPSAnJztcbiAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwnKTtcbiAgICAgICAgc2VsZi5vcGVuQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX3RyaWdnZXInKTtcbiAgICAgICAgc2VsZi5jbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9jbG9zZScpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYucm91dGVyKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUm91dGUgY2xpY2sgZXZlbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJvdXRlciA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfdHJpZ2dlcicpKSB7XG5cbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgc2VsZi5vcGVuKGV2ZW50LnRhcmdldCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfY2xvc2UnKSkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UoZXZlbnQudGFyZ2V0KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYub3BlbiA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAgICAgdmFyIHNyYyA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNyYyksXG4gICAgICAgICAgICAgICAgcGhvdG8gPSB0YXJnZXQuZGF0YXNldC5waG90byxcbiAgICAgICAgICAgICAgICB0aXRsZSA9IHRhcmdldC5kYXRhc2V0LnRpdGxlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gdGFyZ2V0LmRhdGFzZXQuZGVzY3JpcHRpb247XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYXV0aG9ySW5mb19fcHJldmlldyBpbWcnKS5zcmMgPSBwaG90bztcblxuICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5hdXRob3JJbmZvX190aXRsZScpLmlubmVySFRNTCA9IHRpdGxlO1xuXG4gICAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmF1dGhvckluZm9fX3RleHQgcCcpLmlubmVySFRNTCA9IGRlc2NyaXB0aW9uO1xuXG4gICAgICAgICAgICBzZWxmLmh0bWwuY2xhc3NMaXN0LmFkZCgnbW9kYWxfc3RhdGVfb3BlbicpO1xuICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmNsb3NlID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGFyZ2V0LmNsb3Nlc3QoJy5tb2RhbCcpO1xuXG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWxfc3RhdGVfb3BlbicpO1xuICAgICAgICAgICAgc2VsZi5odG1sLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW1wb3J0IHByb3BlcnRpZXMgZnJvbSBNYWluIGNsYXNzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmh0bWwgPSBhcHAubW9kdWxlcy5tYWluLmh0bWw7XG4gICAgICAgICAgICBzZWxmLmJvZHkgPSBhcHAubW9kdWxlcy5tYWluLmJvZHk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cygpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiBhcHApKSB7XG4gICAgICAgIGFwcC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgYXBwLm1vZHVsZXMubW9kYWwgPSBuZXcgTW9kYWwoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ3NjaGVkdWxlJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBTY2hlZHVsZSBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgU2NoZWR1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmJvZHkgPSAnJztcbiAgICAgICAgc2VsZi5nZXRTY2hlZHVsZSA9ICcnO1xuICAgICAgICBzZWxmLmdldFBsYWNlID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0U2Nob29sID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0QXV0aG9yID0gJyc7XG4gICAgICAgIHNlbGYuZXhwYW5kID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0VmFsdWUgPSAnJztcbiAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGUnKTtcbiAgICAgICAgc2VsZi5jb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlTGlzdF9fY29udGVudCcpO1xuICAgICAgICBzZWxmLnRyaWdnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2NoZWR1bGVfX3RyaWdnZXInKTtcbiAgICAgICAgc2VsZi5zY2hvb2xTZWxlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3RbbmFtZT1cInNjaG9vbFwiXScpO1xuICAgICAgICBzZWxmLmF1dGhvclNlbGVjdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdFtuYW1lPVwiYXV0aG9yXCJdJyk7XG4gICAgICAgIHNlbGYuZGF0ZUZyb21JbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtSW5wdXRfX2lucHV0W25hbWU9XCJmcm9tXCJdJyk7XG4gICAgICAgIHNlbGYuZGF0ZVRvSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybUlucHV0X19pbnB1dFtuYW1lPVwidG9cIl0nKTtcbiAgICAgICAgc2VsZi5zY2hvb2xTZWxlY3RNdWx0aXBsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGUuZm9ybVNlbGVjdE11bHRpcGxlX3R5cGVfc2Nob29sJyk7XG4gICAgICAgIHNlbGYuYXV0aG9yU2VsZWN0TXVsdGlwbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlLmZvcm1TZWxlY3RNdWx0aXBsZV90eXBlX2F1dGhvcicpO1xuICAgICAgICBzZWxmLnNlbGVjdE11bHRpcGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZvcm1TZWxlY3RNdWx0aXBsZScpO1xuICAgICAgICBzZWxmLnRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NjaGVkdWxlSXRlbS10ZW1wbGF0ZScpLmlubmVySFRNTDtcbiAgICAgICAgc2VsZi5tb250aE5hbWVzID0gW1xuICAgICAgICAgICAgJ9GP0L3QstCw0YDRjCcsXG4gICAgICAgICAgICAn0YTQtdCy0YDQsNC70YwnLFxuICAgICAgICAgICAgJ9C80LDRgNGCJyxcbiAgICAgICAgICAgICfQsNC/0YDQtdC70YwnLFxuICAgICAgICAgICAgJ9C80LDQuScsXG4gICAgICAgICAgICAn0LjRjtC90YwnLFxuICAgICAgICAgICAgJ9C40Y7Qu9GMJyxcbiAgICAgICAgICAgICfQsNCy0LPRg9GB0YInLFxuICAgICAgICAgICAgJ9GB0LXQvdGC0Y/QsdGA0YwnLFxuICAgICAgICAgICAgJ9C+0LrRgtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQvdC+0Y/QsdGA0YwnLFxuICAgICAgICAgICAgJ9C00LXQutCw0LHRgNGMJ1xuICAgICAgICBdO1xuICAgICAgICBzZWxmLmRhdGFMaXN0ID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5kYXRlRnJvbUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNlbGYuZ2V0RGF0YSk7XG4gICAgICAgICAgICBzZWxmLmRhdGVUb0lucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNlbGYuZ2V0RGF0YSk7XG4gICAgICAgICAgICBzZWxmLnNlbGVjdE11bHRpcGxlLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge2l0ZW0uYWRkRXZlbnRMaXN0ZW5lcigncmVuZGVyJywgc2VsZi5nZXREYXRhKX0pO1xuICAgICAgICAgICAgc2VsZi50cmlnZ2VyLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge2l0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLnNob3dGaWx0ZXIpfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgZmlsdGVyIGNvbnRhaW5lclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2hvd0ZpbHRlciA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBpZiAoc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzY2hlZHVsZV9zdGF0ZV9maWx0ZXInKSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2NoZWR1bGVfc3RhdGVfZmlsdGVyJyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZV9zdGF0ZV9maWx0ZXInKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXR1cCBzY2hvb2wgZmlsdGVyIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cFNjaG9vbEZpbHRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5nZXRTY2hvb2woKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPG9wdGlvbiB2YWx1ZT1cIlwiPjwvb3B0aW9uPic7XG5cbiAgICAgICAgICAgICAgICByZXNwb25zZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPG9wdGlvbiB2YWx1ZT1cIicrIGl0ZW0uaWQgKydcIj4nKyBpdGVtLnRpdGxlICsnPC9vcHRpb24+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGYuc2Nob29sU2VsZWN0LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0dXAgYXV0aG9yIGZpbHRlciB2YWx1ZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBBdXRob3JGaWx0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuZ2V0QXV0aG9yKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBodG1sID0gJzxvcHRpb24gdmFsdWU9XCJcIj48L29wdGlvbj4nO1xuXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxvcHRpb24gdmFsdWU9XCInKyBpdGVtLmlkICsnXCI+JysgaXRlbS50aXRsZSArJzwvb3B0aW9uPic7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmF1dGhvclNlbGVjdC5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBkYXRhIGZyb20gbGlicmFyeSBhY2NvcmRpbmcgdG8gZmlsdGVyIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5nZXREYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZGF0ZUZyb20gPSBzZWxmLmRhdGVGcm9tSW5wdXQudmFsdWUucmVwbGFjZSgvLS9nLCAnLycpLFxuICAgICAgICAgICAgICAgIGRhdGVUbyA9IHNlbGYuZGF0ZVRvSW5wdXQudmFsdWUucmVwbGFjZSgvLS9nLCAnLycpLFxuICAgICAgICAgICAgICAgIHNjaG9vbCA9IHNlbGYuZ2V0VmFsdWUoc2VsZi5zY2hvb2xTZWxlY3RNdWx0aXBsZSksXG4gICAgICAgICAgICAgICAgYXV0aG9yID0gc2VsZi5nZXRWYWx1ZShzZWxmLmF1dGhvclNlbGVjdE11bHRpcGxlKTtcblxuICAgICAgICAgICAgc2VsZi5nZXRTY2hlZHVsZShkYXRlRnJvbSwgZGF0ZVRvLCAnJykudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChzY2hvb2wubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmxlY3R1cmVzID0gcmVzcG9uc2UubGVjdHVyZXMuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2Nob29sLmZvckVhY2goZnVuY3Rpb24oc2Nob29sSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNjaG9vbC5pbmRleE9mKHBhcnNlSW50KHNjaG9vbEl0ZW0udmFsdWUpKSAhPT0gLTEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGF1dGhvci5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubGVjdHVyZXMgPSByZXNwb25zZS5sZWN0dXJlcy5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRob3IuZm9yRWFjaChmdW5jdGlvbihhdXRob3JJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uYXV0aG9yLmluZGV4T2YocGFyc2VJbnQoYXV0aG9ySXRlbS52YWx1ZSkpICE9PSAtMSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcihyZXNwb25zZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIHNjaGVkdWxlIGxpc3RcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHJlc3BvbnNlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlbmRlciA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudExpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuXG4gICAgICAgICAgICBjb250ZW50TGlzdC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2xpc3QnKTtcblxuICAgICAgICAgICAgcmVzcG9uc2UubGVjdHVyZXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2l0ZW0nKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IHNlbGYudGVtcGxhdGU7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGl0ZW0uZGF0ZSksXG4gICAgICAgICAgICAgICAgICAgIGRheSA9IGRhdGUuZ2V0RGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgICBtb250aCA9IHNlbGYubW9udGhOYW1lc1tkYXRlLmdldE1vbnRoKCldLFxuICAgICAgICAgICAgICAgICAgICBzY2hvb2wgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yID0gW107XG5cbiAgICAgICAgICAgICAgICBpdGVtLnNjaG9vbC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1UaXRsZSA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnc2Nob29scycsIGRhdGE6IHJlc3BvbnNlLnNjaG9vbHN9LCAndGl0bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1JZCA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnc2Nob29scycsIGRhdGE6IHJlc3BvbnNlLnNjaG9vbHN9LCAnaWQnKTtcblxuICAgICAgICAgICAgICAgICAgICBzY2hvb2wucHVzaCgnPHNwYW4gY2xhc3M9XCJzY2hlZHVsZUl0ZW1fX3NjaG9vbF9faXRlbSBzY2hlZHVsZUl0ZW1fX3NjaG9vbF9faXRlbV8nKyBpdGVtSWQgKydcIj4nKyBpdGVtVGl0bGUgKyc8L3NwYW4+Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdGVtLmF1dGhvci5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1UaXRsZSA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAndGl0bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1QaG90byA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAncGhvdG8nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1EZXNjcmlwdGlvbiA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAnZGVzY3JpcHRpb24nKTtcblxuICAgICAgICAgICAgICAgICAgICBhdXRob3IucHVzaCgnPGEgY2xhc3M9XCJzY2hlZHVsZUl0ZW1fX2F1dGhvcl9fbGluayBtb2RhbF90cmlnZ2VyXCIgaHJlZj1cIiNhdXRob3ItbW9kYWxcIiB0aXRsZT1cItCf0L7RgdC80L7RgtGA0LXRgtGMINC00L7Qv9C+0LvQvdC40YLQtdC70YzQvdGD0Y4g0LjQvdGE0L7RgNC80LDRhtC40Y5cIiBkYXRhLXBob3RvPVwiJysgaXRlbVBob3RvICsnXCIgZGF0YS10aXRsZT1cIicrIGl0ZW1UaXRsZSArJ1wiIGRhdGEtZGVzY3JpcHRpb249XCInKyBpdGVtRGVzY3JpcHRpb24gKydcIj4nKyBpdGVtVGl0bGUgKyc8L2E+Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pc092ZXIpIHtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW0nKS5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUl0ZW1fc3RhdGVfaW5hY3RpdmUnKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fZGF5JykuaW5uZXJIVE1MID0gZGF5O1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19tb250aCcpLmlubmVySFRNTCA9IG1vbnRoO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX190aW1lJykuaW5uZXJIVE1MID0gaXRlbS50aW1lO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX190aXRsZScpLmlubmVySFRNTCA9IGl0ZW0udGl0bGU7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3NjaG9vbCcpLmlubmVySFRNTCA9IHNjaG9vbC5qb2luKCcnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fYXV0aG9yJykuaW5uZXJIVE1MICs9IGF1dGhvci5qb2luKCcsICcpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19hdWRpZW5jZScpLmlubmVySFRNTCArPSBzZWxmLmV4cGFuZChbaXRlbS5wbGFjZV0sIHt0aXRsZTogJ3BsYWNlcycsIGRhdGE6IHJlc3BvbnNlLnBsYWNlc30sICd0aXRsZScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19wbGFjZV9fbGluaycpLmlubmVySFRNTCA9IHNlbGYuZXhwYW5kKFtpdGVtLnBsYWNlXSwge3RpdGxlOiAncGxhY2VzJywgZGF0YTogcmVzcG9uc2UucGxhY2VzfSwgJ2FkZHJlc3MnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fcGxhY2VfX2xpbmsnKS5ocmVmID0gc2VsZi5leHBhbmQoW2l0ZW0ucGxhY2VdLCB7dGl0bGU6ICdwbGFjZXMnLCBkYXRhOiByZXNwb25zZS5wbGFjZXN9LCAnbGluaycpO1xuXG4gICAgICAgICAgICAgICAgY29udGVudExpc3QuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxlY3R1cmVzLmxlbmd0aCA9PT0gMCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2l0ZW0nKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2NoZWR1bGVMaXN0X19pdGVtX3N0YXRlX2VtcHR5Jyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9ICfQn9C+INCy0LDRiNC10LzRgyDQt9Cw0L/RgNC+0YHRgyDQvdC40YfQtdCz0L4g0L3QtSDQvdCw0LnQtNC10L3Qvi4nO1xuXG4gICAgICAgICAgICAgICAgY29udGVudExpc3QuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlbGYuY29udGVudC5pbm5lckhUTUwgPSAnJztcblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmFwcGVuZENoaWxkKGNvbnRlbnRMaXN0KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW1wb3J0IHByb3BlcnRpZXMgZnJvbSBNYWluIGNsYXNzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkgPSBhcHAubW9kdWxlcy5tYWluLmJvZHk7XG4gICAgICAgICAgICBzZWxmLmdldFNjaGVkdWxlID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmdldFNjaGVkdWxlO1xuICAgICAgICAgICAgc2VsZi5nZXRTY2hvb2wgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZ2V0U2Nob29sO1xuICAgICAgICAgICAgc2VsZi5nZXRBdXRob3IgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZ2V0QXV0aG9yO1xuICAgICAgICAgICAgc2VsZi5leHBhbmQgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZXhwYW5kO1xuICAgICAgICAgICAgc2VsZi5nZXRWYWx1ZSA9IGFwcC5tb2R1bGVzLmZvcm1TZWxlY3RNdWx0aXBsZS5nZXRWYWx1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cFNjaG9vbEZpbHRlcigpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBBdXRob3JGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICBzZWxmLmdldERhdGEoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLnNjaGVkdWxlID0gbmV3IFNjaGVkdWxlKCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnZm9ybVNlbGVjdE11bHRpcGxlJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBGb3JtU2VsZWN0TXVsdGlwbGUgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIEZvcm1TZWxlY3RNdWx0aXBsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuYm9keSA9ICcnO1xuICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgc2VsZi5oYW5kbGVDaGFuZ2UpO1xuICAgICAgICAgICAgc2VsZi5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5oYW5kbGVDbGljayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaGFuZGxlQ2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3QnKSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRhcmdldC5jbG9zZXN0KCcuZm9ybVNlbGVjdE11bHRpcGxlJyksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3QnKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRWYWx1ZSA9IHNlbGVjdC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QgPSBjb250YWluZXIuZGF0YXNldC5saXN0ID8gSlNPTi5wYXJzZShjb250YWluZXIuZGF0YXNldC5saXN0KSA6IFtdLFxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gW10uc2xpY2UuY2FsbChzZWxlY3QucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uJykpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RMaXN0ID0gW10sXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBbXTtcblxuICAgICAgICAgICAgICAgIGlmICghY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnZm9ybVNlbGVjdE11bHRpcGxlX3N0YXRlX2luaXRlZCcpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgW10uc2xpY2UuY2FsbChzZWxlY3QucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uJykpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB0ZXh0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmRhdGFzZXQubGlzdCA9IEpTT04uc3RyaW5naWZ5KGluaXRpYWxMaXN0KTtcblxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnZm9ybVNlbGVjdE11bHRpcGxlX3N0YXRlX2luaXRlZCcpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBpdGVtLmlubmVySFRNTDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdGV4dCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RMaXN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RMaXN0ID0gc2VsZWN0TGlzdC5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS52YWx1ZSAhPT0gc2VsZWN0ZWRWYWx1ZTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGVjdExpc3QuZm9yRWFjaChmdW5jdGlvbihzZWxlY3RJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LmZvckVhY2goZnVuY3Rpb24oaW5pdGlhbEl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdGlhbEl0ZW0udmFsdWUgPT09IHNlbGVjdEl0ZW0udmFsdWUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gaW5pdGlhbExpc3Q7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcihjb250YWluZXIsIHNlbGVjdExpc3QsIHJlc3VsdExpc3QpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZSBjbGljayBldmVudFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaGFuZGxlQ2xpY2sgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9fbGluaycpKSB7XG5cbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRhcmdldC5jbG9zZXN0KCcuZm9ybVNlbGVjdE11bHRpcGxlJyksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkVmFsdWUgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0ID0gY29udGFpbmVyLmRhdGFzZXQubGlzdCA/IEpTT04ucGFyc2UoY29udGFpbmVyLmRhdGFzZXQubGlzdCkgOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgbGlua3MgPSBbXS5zbGljZS5jYWxsKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdhJykpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RMaXN0ID0gW10sXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBbXTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBsaW5rcy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KS5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS52YWx1ZSAhPT0gc2VsZWN0ZWRWYWx1ZTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QuZm9yRWFjaChmdW5jdGlvbihyZXN1bHRJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LmZvckVhY2goZnVuY3Rpb24oaW5pdGlhbEl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdGlhbEl0ZW0udmFsdWUgPT09IHJlc3VsdEl0ZW0udmFsdWUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RMaXN0ID0gaW5pdGlhbExpc3Q7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcihjb250YWluZXIsIHNlbGVjdExpc3QsIHJlc3VsdExpc3QpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHVybiBjb250YWluZXIgc2VsZWN0ZWQgdmFsdWVcbiAgICAgICAgICogQHBhcmFtIGNvbnRhaW5lclxuICAgICAgICAgKiBAcmV0dXJucyB7QXJyYXl9XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdldFZhbHVlID0gZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0TGlzdCA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgbGlua3MgPSBbXS5zbGljZS5jYWxsKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdhJykpO1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IGxpbmtzLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHRMaXN0O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW5kZXIgZGF0YSBmb3IgY29udGFpbmVyXG4gICAgICAgICAqIEBwYXJhbSB7RWxlbWVudH0gY29udGFpbmVyXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHNlbGVjdERhdGFcbiAgICAgICAgICogQHBhcmFtIHtBcnJheX0gcmVzdWx0RGF0YVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yZW5kZXIgPSBmdW5jdGlvbihjb250YWluZXIsIHNlbGVjdERhdGEsIHJlc3VsdERhdGEpIHtcbiAgICAgICAgICAgIHZhciBzZWxlY3RDb250YWluZXIgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0JyksXG4gICAgICAgICAgICAgICAgcmVzdWx0Q29udGFpbmVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX2xpc3QnKSxcbiAgICAgICAgICAgICAgICBzZWxlY3RIdG1sID0gJzxvcHRpb24gdmFsdWU9XCJcIj48L29wdGlvbj4nLFxuICAgICAgICAgICAgICAgIHJlc3VsdEh0bWwgPSAnJztcblxuICAgICAgICAgICAgaWYgKHNlbGVjdERhdGEubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0RGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0SHRtbCArPSAnPG9wdGlvbiB2YWx1ZT1cIicrIGl0ZW0udmFsdWUgKydcIj4nKyBpdGVtLnRleHQgKyc8L29wdGlvbj4nO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZXN1bHREYXRhLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgIHJlc3VsdERhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdEh0bWwgKz0gJzxsaSBjbGFzcz1cImZvcm1TZWxlY3RNdWx0aXBsZV9faXRlbVwiPjxhIGhyZWY9XCInKyBpdGVtLnZhbHVlICsnXCIgY2xhc3M9XCJmb3JtU2VsZWN0TXVsdGlwbGVfX2xpbmtcIj4nKyBpdGVtLnRleHQgKyc8L2E+PC9saT4nO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzZWxlY3RDb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHNlbGVjdENvbnRhaW5lci5pbm5lckhUTUwgPSBzZWxlY3RIdG1sO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZXN1bHRDb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgPSByZXN1bHRIdG1sO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgncmVuZGVyJykpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbXBvcnQgcHJvcGVydGllcyBmcm9tIE1haW4gY2xhc3NcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keSA9IGFwcC5tb2R1bGVzLm1haW4uYm9keTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5mb3JtU2VsZWN0TXVsdGlwbGUgPSBuZXcgRm9ybVNlbGVjdE11bHRpcGxlKCk7XG59KSgpO1xuIl19

var initApp=function(){if(!("modules"in app&&"main"in app.modules)){var e=function(){var e=this;e.html=document.querySelector("html"),e.body=document.querySelector("body"),e.modules=app.modules,e.library=new Library,e.initLibrary=function(){e.library.init()},e.initModules=function(){for(var t in e.modules)e.modules.hasOwnProperty(t)&&"undefined"!=typeof e.modules[t].init&&"main"!==t&&"library"!==t&&e.modules[t].init()},e.init=function(){e.initLibrary(),e.initModules()}};"modules"in app||(app.modules={}),app.modules.main=new e,app.modules.main.init()}};window.addEventListener("load",initApp),function(){if(!("modules"in app&&"formSelectMultiple"in app.modules)){var e=function(){var e=this;e.body="",e.container=document.querySelector(".formSelectMultiple"),e.content=document.querySelector(".formSelectMultiple__content"),e.footer=document.querySelector(".formSelectMultiple__footer"),e.setupListener=function(){e.content.addEventListener("change",e.handleChange),e.footer.addEventListener("click",e.handleClick)},e.handleChange=function(){var t=this.closest(".formSelectMultiple"),n=t.querySelector(".formSelectMultiple__select"),l=n.value,o=t.querySelector(".formSelectMultiple__list"),a=t.dataset.list?JSON.parse(t.dataset.list):[],i=[].slice.call(n.querySelectorAll("option")),r=[],c=[],s=[];t.classList.contains("formSelectMultiple_state_inited")||([].slice.call(n.querySelectorAll("option")).forEach(function(e){var t=e.value,n=e.innerHTML;t&&n&&a.push({value:t,text:n})}),t.dataset.list=JSON.stringify(a),t.classList.add("formSelectMultiple_state_inited")),i.forEach(function(e){var t=e.value,n=e.innerHTML;t&&n&&r.push({value:t,text:n})}),c=r.filter(function(e){return e.value!==l}),c.forEach(function(e){a.forEach(function(t,n){t.value===e.value&&a.splice(n,1)})}),s=a,e.renderSelect(n,c),e.renderResult(o,s)},e.handleClick=function(e){e.preventDefault();var t=this,n=e.target,l=(parseInt(n.getAttribute("href")),t.dataset.list?JSON.parse(t.dataset.list):[]),o=[].slice.call(t.querySelectorAll("a")),a=[];l.slice();o.forEach(function(e){console.log(e);var t=e.getAttribute("href"),n=e.innerHTML;t&&n&&a.push({value:t,text:n})})},e.renderSelect=function(e,t){var n='<option value=""></option>';t.forEach(function(e){n+='<option value="'+e.value+'">'+e.text+"</option>"}),e.innerHTML=n},e.renderResult=function(e,t){var n="";t.forEach(function(e){n+='<li class="formSelectMultiple__item"><a href="'+e.value+'" class="formSelectMultiple__link">'+e.text+"</a></li>"}),e.innerHTML=n},e.importDefaults=function(){e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.formSelectMultiple=new e}}(),function(){if(!("modules"in app&&"modal"in app.modules)){var e=function(){var e=this;e.html="",e.body="",e.container=document.querySelector(".modal"),e.openButton=document.querySelector(".modal_trigger"),e.closeButton=document.querySelector(".modal_close"),e.setupListener=function(){e.body.addEventListener("click",e.router)},e.router=function(t){var n=t.target;n.classList.contains("modal_trigger")?(t.preventDefault(),e.open(t.target)):n.classList.contains("modal_close")&&(t.preventDefault(),e.close(t.target))},e.open=function(t){var n=t.getAttribute("href"),l=document.querySelector(n),o=t.dataset.photo,a=t.dataset.title,i=t.dataset.description;l.querySelector(".authorInfo__preview img").src=o,l.querySelector(".authorInfo__title").innerHTML=a,l.querySelector(".authorInfo__text p").innerHTML=i,e.html.classList.add("modal_state_open"),l.classList.add("modal_state_open")},e.close=function(t){var n=t.closest(".modal");n.classList.remove("modal_state_open"),e.html.classList.remove("modal_state_open")},e.importDefaults=function(){e.html=app.modules.main.html,e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.modal=new e}}(),function(){if(!("modules"in app&&"schedule"in app.modules)){var e=function(){var e=this;e.body="",e.getSchedule="",e.getPlace="",e.getSchool="",e.getAuthor="",e.expand="",e.container=document.querySelector(".schedule"),e.content=document.querySelector(".scheduleList__content"),e.template=document.querySelector("#scheduleItem-template").innerHTML,e.monthNames=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],e.dataList="",e.setupListener=function(){},e.getData=function(){var t="",n="",l="";e.getSchedule(t,n,l).then(function(t){e.render(t)})},e.render=function(t){var n=document.createElement("ul");n.classList.add("scheduleList__list"),t.lectures.forEach(function(l){var o=document.createElement("li");o.classList.add("scheduleList__item"),o.innerHTML=e.template;var a=new Date(l.date),i=a.getDate(),r=e.monthNames[a.getMonth()],c=[],s=[];l.school.forEach(function(n){var l=e.expand([n],{title:"schools",data:t.schools},"title"),o=e.expand([n],{title:"schools",data:t.schools},"id");c.push('<span class="scheduleItem__school__item scheduleItem__school__item_'+o+'">'+l+"</span>")}),l.author.forEach(function(n){var l=e.expand([n],{title:"authors",data:t.authors},"title"),o=e.expand([n],{title:"authors",data:t.authors},"photo"),a=e.expand([n],{title:"authors",data:t.authors},"description");s.push('<a class="scheduleItem__author__link modal_trigger" href="#author" title="Посмотреть дополнительную информацию" data-photo="'+o+'" data-title="'+l+'" data-description="'+a+'">'+l+"</a>")}),l.isOver&&o.querySelector(".scheduleItem").classList.add("scheduleItem_state_inactive"),o.querySelector(".scheduleItem__day").innerHTML=i,o.querySelector(".scheduleItem__month").innerHTML=r,o.querySelector(".scheduleItem__time").innerHTML=l.time,o.querySelector(".scheduleItem__title").innerHTML=l.title,o.querySelector(".scheduleItem__school").innerHTML=c.join(""),o.querySelector(".scheduleItem__author").innerHTML+=s.join(", "),o.querySelector(".scheduleItem__audience").innerHTML+=e.expand([l.place],{title:"places",data:t.places},"title"),o.querySelector(".scheduleItem__place__link").innerHTML=e.expand([l.place],{title:"places",data:t.places},"address"),o.querySelector(".scheduleItem__place__link").href=e.expand([l.place],{title:"places",data:t.places},"link"),n.appendChild(o)}),e.content.innerHTML="",e.content.appendChild(n)},e.importDefaults=function(){e.body=app.modules.main.body,e.getSchedule=app.modules.main.library.getSchedule,e.expand=app.modules.main.library.expand},e.init=function(){e.container&&(e.importDefaults(),e.getData(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.schedule=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vbWFpbi5qcyIsImZvcm1TZWxlY3RNdWx0aXBsZS9mb3JtU2VsZWN0TXVsdGlwbGUuanMiLCJtb2RhbC9tb2RhbC5qcyIsInNjaGVkdWxlL3NjaGVkdWxlLmpzIl0sIm5hbWVzIjpbImluaXRBcHAiLCJhcHAiLCJtb2R1bGVzIiwiTWFpbiIsInNlbGYiLCJ0aGlzIiwiaHRtbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJvZHkiLCJsaWJyYXJ5IiwiTGlicmFyeSIsImluaXRMaWJyYXJ5IiwiaW5pdCIsImluaXRNb2R1bGVzIiwibW9kdWxlIiwiaGFzT3duUHJvcGVydHkiLCJtYWluIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsIkZvcm1TZWxlY3RNdWx0aXBsZSIsImNvbnRhaW5lciIsImNvbnRlbnQiLCJmb290ZXIiLCJzZXR1cExpc3RlbmVyIiwiaGFuZGxlQ2hhbmdlIiwiaGFuZGxlQ2xpY2siLCJjbG9zZXN0Iiwic2VsZWN0Iiwic2VsZWN0ZWRWYWx1ZSIsInZhbHVlIiwicmVzdWx0IiwiaW5pdGlhbExpc3QiLCJkYXRhc2V0IiwibGlzdCIsIkpTT04iLCJwYXJzZSIsIm9wdGlvbnMiLCJzbGljZSIsImNhbGwiLCJxdWVyeVNlbGVjdG9yQWxsIiwic2VsZWN0TGlzdCIsInJlc3VsdExpc3QiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImZvckVhY2giLCJpdGVtIiwidGV4dCIsImlubmVySFRNTCIsInB1c2giLCJzdHJpbmdpZnkiLCJhZGQiLCJmaWx0ZXIiLCJzZWxlY3RJdGVtIiwiaW5pdGlhbEl0ZW0iLCJpbmRleCIsInNwbGljZSIsInJlbmRlclNlbGVjdCIsInJlbmRlclJlc3VsdCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJsaW5rIiwidGFyZ2V0IiwicGFyc2VJbnQiLCJnZXRBdHRyaWJ1dGUiLCJsaW5rcyIsImNvbnNvbGUiLCJsb2ciLCJkYXRhIiwiaW1wb3J0RGVmYXVsdHMiLCJmb3JtU2VsZWN0TXVsdGlwbGUiLCJNb2RhbCIsIm9wZW5CdXR0b24iLCJjbG9zZUJ1dHRvbiIsInJvdXRlciIsIm9wZW4iLCJjbG9zZSIsInNyYyIsInBob3RvIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInJlbW92ZSIsIm1vZGFsIiwiU2NoZWR1bGUiLCJnZXRTY2hlZHVsZSIsImdldFBsYWNlIiwiZ2V0U2Nob29sIiwiZ2V0QXV0aG9yIiwiZXhwYW5kIiwidGVtcGxhdGUiLCJtb250aE5hbWVzIiwiZGF0YUxpc3QiLCJnZXREYXRhIiwiZGF0ZUZyb20iLCJkYXRlVG8iLCJwbGFjZSIsInRoZW4iLCJyZXNwb25zZSIsInJlbmRlciIsImNvbnRlbnRMaXN0IiwiY3JlYXRlRWxlbWVudCIsImxlY3R1cmVzIiwiZWxlbWVudCIsImRhdGUiLCJEYXRlIiwiZGF5IiwiZ2V0RGF0ZSIsIm1vbnRoIiwiZ2V0TW9udGgiLCJzY2hvb2wiLCJhdXRob3IiLCJpdGVtVGl0bGUiLCJzY2hvb2xzIiwiaXRlbUlkIiwiYXV0aG9ycyIsIml0ZW1QaG90byIsIml0ZW1EZXNjcmlwdGlvbiIsImlzT3ZlciIsInRpbWUiLCJqb2luIiwicGxhY2VzIiwiaHJlZiIsImFwcGVuZENoaWxkIiwic2NoZWR1bGUiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLFNBQUEsV0FDQSxLQUFBLFdBQUFDLE1BQUEsUUFBQUEsS0FBQUMsU0FBQSxDQVFBLEdBQUFDLEdBQUEsV0FDQSxHQUFBQyxHQUFBQyxJQUVBRCxHQUFBRSxLQUFBQyxTQUFBQyxjQUFBLFFBQ0FKLEVBQUFLLEtBQUFGLFNBQUFDLGNBQUEsUUFDQUosRUFBQUYsUUFBQUQsSUFBQUMsUUFDQUUsRUFBQU0sUUFBQSxHQUFBQyxTQUtBUCxFQUFBUSxZQUFBLFdBQ0FSLEVBQUFNLFFBQUFHLFFBTUFULEVBQUFVLFlBQUEsV0FDQSxJQUFBLEdBQUFDLEtBQUFYLEdBQUFGLFFBRUFFLEVBQUFGLFFBQUFjLGVBQUFELElBRUEsbUJBQUFYLEdBQUFGLFFBQUFhLEdBQUFGLE1BQUEsU0FBQUUsR0FBQSxZQUFBQSxH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eEMiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaW5pdEFwcCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gYXBwICYmICdtYWluJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNYWluIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBNYWluID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmh0bWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJyk7XG4gICAgICAgIHNlbGYuYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcbiAgICAgICAgc2VsZi5tb2R1bGVzID0gYXBwLm1vZHVsZXM7XG4gICAgICAgIHNlbGYubGlicmFyeSA9IG5ldyBMaWJyYXJ5KCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbGlicmFyeSBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdExpYnJhcnkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYubGlicmFyeS5pbml0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgYWxsIG1vZHVsZXMgaW4gJC5tb2R1bGVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRNb2R1bGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBtb2R1bGUgaW4gc2VsZi5tb2R1bGVzKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5tb2R1bGVzLmhhc093blByb3BlcnR5KG1vZHVsZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNlbGYubW9kdWxlc1ttb2R1bGVdLmluaXQgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZSAhPT0gJ21haW4nICYmIG1vZHVsZSAhPT0gJ2xpYnJhcnknKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubW9kdWxlc1ttb2R1bGVdLmluaXQoKTtcblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5pbml0TGlicmFyeSgpO1xuICAgICAgICAgICAgc2VsZi5pbml0TW9kdWxlcygpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLm1haW4gPSBuZXcgTWFpbigpO1xuXG4gICAgYXBwLm1vZHVsZXMubWFpbi5pbml0KCk7XG59O1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGluaXRBcHApO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnZm9ybVNlbGVjdE11bHRpcGxlJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBGb3JtU2VsZWN0TXVsdGlwbGUgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIEZvcm1TZWxlY3RNdWx0aXBsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuYm9keSA9ICcnO1xuICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKTtcbiAgICAgICAgc2VsZi5jb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fY29udGVudCcpO1xuICAgICAgICBzZWxmLmZvb3RlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX2Zvb3RlcicpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuY29udGVudC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmhhbmRsZUNoYW5nZSk7XG4gICAgICAgICAgICBzZWxmLmZvb3Rlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYuaGFuZGxlQ2xpY2spO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgY2hhbmdlIGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmhhbmRsZUNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuY2xvc2VzdCgnLmZvcm1TZWxlY3RNdWx0aXBsZScpLFxuICAgICAgICAgICAgICAgIHNlbGVjdCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3QnKSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlID0gc2VsZWN0LnZhbHVlLFxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19saXN0JyksXG4gICAgICAgICAgICAgICAgaW5pdGlhbExpc3QgPSBjb250YWluZXIuZGF0YXNldC5saXN0ID8gSlNPTi5wYXJzZShjb250YWluZXIuZGF0YXNldC5saXN0KSA6IFtdLFxuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBbXS5zbGljZS5jYWxsKHNlbGVjdC5xdWVyeVNlbGVjdG9yQWxsKCdvcHRpb24nKSksXG4gICAgICAgICAgICAgICAgbGlzdCA9IFtdLFxuICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBbXSxcbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gW107XG5cbiAgICAgICAgICAgIGlmICghY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnZm9ybVNlbGVjdE11bHRpcGxlX3N0YXRlX2luaXRlZCcpKSB7XG5cbiAgICAgICAgICAgICAgICBbXS5zbGljZS5jYWxsKHNlbGVjdC5xdWVyeVNlbGVjdG9yQWxsKCdvcHRpb24nKSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHRleHQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QgPSBKU09OLnN0cmluZ2lmeShpbml0aWFsTGlzdCk7XG5cbiAgICAgICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnZm9ybVNlbGVjdE11bHRpcGxlX3N0YXRlX2luaXRlZCcpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHRleHQpIHtcblxuICAgICAgICAgICAgICAgICAgICBsaXN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNlbGVjdExpc3QgPSBsaXN0LmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgIT09IHNlbGVjdGVkVmFsdWVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzZWxlY3RMaXN0LmZvckVhY2goZnVuY3Rpb24oc2VsZWN0SXRlbSkge1xuICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LmZvckVhY2goZnVuY3Rpb24oaW5pdGlhbEl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbml0aWFsSXRlbS52YWx1ZSA9PT0gc2VsZWN0SXRlbS52YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXN1bHRMaXN0ID0gaW5pdGlhbExpc3Q7XG5cbiAgICAgICAgICAgIHNlbGYucmVuZGVyU2VsZWN0KHNlbGVjdCwgc2VsZWN0TGlzdCk7XG4gICAgICAgICAgICBzZWxmLnJlbmRlclJlc3VsdChyZXN1bHQsIHJlc3VsdExpc3QpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgY2xpY2sgZXZlbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmhhbmRsZUNsaWNrID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLFxuICAgICAgICAgICAgICAgIGxpbmsgPSBldmVudC50YXJnZXQsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRWYWx1ZSA9IHBhcnNlSW50KGxpbmsuZ2V0QXR0cmlidXRlKCdocmVmJykpLFxuICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0ID0gY29udGFpbmVyLmRhdGFzZXQubGlzdCA/IEpTT04ucGFyc2UoY29udGFpbmVyLmRhdGFzZXQubGlzdCkgOiBbXSxcbiAgICAgICAgICAgICAgICBsaW5rcyA9IFtdLnNsaWNlLmNhbGwoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKSksXG4gICAgICAgICAgICAgICAgbGlzdCA9IFtdLFxuICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBpbml0aWFsTGlzdC5zbGljZSgpLFxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBbXTtcblxuICAgICAgICAgICAgbGlua3MuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaXRlbSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdGV4dCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuXG5cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIHNlbGVjdCBjb250ZW50XG4gICAgICAgICAqIEBwYXJhbSB7RWxlbWVudH0gY29udGFpbmVyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlbmRlclNlbGVjdCA9IGZ1bmN0aW9uKGNvbnRhaW5lciwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIGh0bWwgPSAnPG9wdGlvbiB2YWx1ZT1cIlwiPjwvb3B0aW9uPic7XG5cbiAgICAgICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgaHRtbCArPSAnPG9wdGlvbiB2YWx1ZT1cIicrIGl0ZW0udmFsdWUgKydcIj4nKyBpdGVtLnRleHQgKyc8L29wdGlvbj4nO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW5kZXIgcmVzdWx0IGNvbnRlbnRcbiAgICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBjb250YWluZXJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVuZGVyUmVzdWx0ID0gZnVuY3Rpb24oY29udGFpbmVyLCBkYXRhKSB7XG4gICAgICAgICAgICB2YXIgaHRtbCA9ICcnO1xuXG4gICAgICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxsaSBjbGFzcz1cImZvcm1TZWxlY3RNdWx0aXBsZV9faXRlbVwiPjxhIGhyZWY9XCInKyBpdGVtLnZhbHVlICsnXCIgY2xhc3M9XCJmb3JtU2VsZWN0TXVsdGlwbGVfX2xpbmtcIj4nKyBpdGVtLnRleHQgKyc8L2E+PC9saT4nO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbXBvcnQgcHJvcGVydGllcyBmcm9tIE1haW4gY2xhc3NcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keSA9IGFwcC5tb2R1bGVzLm1haW4uYm9keTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5mb3JtU2VsZWN0TXVsdGlwbGUgPSBuZXcgRm9ybVNlbGVjdE11bHRpcGxlKCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnbW9kYWwnIGluIGFwcC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE1vZGFsIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBNb2RhbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuaHRtbCA9ICcnO1xuICAgICAgICBzZWxmLmJvZHkgPSAnJztcbiAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwnKTtcbiAgICAgICAgc2VsZi5vcGVuQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX3RyaWdnZXInKTtcbiAgICAgICAgc2VsZi5jbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9jbG9zZScpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYucm91dGVyKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUm91dGUgY2xpY2sgZXZlbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJvdXRlciA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfdHJpZ2dlcicpKSB7XG5cbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgc2VsZi5vcGVuKGV2ZW50LnRhcmdldCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfY2xvc2UnKSkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UoZXZlbnQudGFyZ2V0KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYub3BlbiA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAgICAgdmFyIHNyYyA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNyYyksXG4gICAgICAgICAgICAgICAgcGhvdG8gPSB0YXJnZXQuZGF0YXNldC5waG90byxcbiAgICAgICAgICAgICAgICB0aXRsZSA9IHRhcmdldC5kYXRhc2V0LnRpdGxlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gdGFyZ2V0LmRhdGFzZXQuZGVzY3JpcHRpb247XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYXV0aG9ySW5mb19fcHJldmlldyBpbWcnKS5zcmMgPSBwaG90bztcblxuICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5hdXRob3JJbmZvX190aXRsZScpLmlubmVySFRNTCA9IHRpdGxlO1xuXG4gICAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmF1dGhvckluZm9fX3RleHQgcCcpLmlubmVySFRNTCA9IGRlc2NyaXB0aW9uO1xuXG4gICAgICAgICAgICBzZWxmLmh0bWwuY2xhc3NMaXN0LmFkZCgnbW9kYWxfc3RhdGVfb3BlbicpO1xuICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmNsb3NlID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGFyZ2V0LmNsb3Nlc3QoJy5tb2RhbCcpO1xuXG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWxfc3RhdGVfb3BlbicpO1xuICAgICAgICAgICAgc2VsZi5odG1sLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW1wb3J0IHByb3BlcnRpZXMgZnJvbSBNYWluIGNsYXNzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmh0bWwgPSBhcHAubW9kdWxlcy5tYWluLmh0bWw7XG4gICAgICAgICAgICBzZWxmLmJvZHkgPSBhcHAubW9kdWxlcy5tYWluLmJvZHk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cygpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiBhcHApKSB7XG4gICAgICAgIGFwcC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgYXBwLm1vZHVsZXMubW9kYWwgPSBuZXcgTW9kYWwoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ3NjaGVkdWxlJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBTY2hlZHVsZSBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgU2NoZWR1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmJvZHkgPSAnJztcbiAgICAgICAgc2VsZi5nZXRTY2hlZHVsZSA9ICcnO1xuICAgICAgICBzZWxmLmdldFBsYWNlID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0U2Nob29sID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0QXV0aG9yID0gJyc7XG4gICAgICAgIHNlbGYuZXhwYW5kID0gJyc7XG4gICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlJyk7XG4gICAgICAgIHNlbGYuY29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUxpc3RfX2NvbnRlbnQnKTtcbiAgICAgICAgc2VsZi50ZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzY2hlZHVsZUl0ZW0tdGVtcGxhdGUnKS5pbm5lckhUTUw7XG4gICAgICAgIHNlbGYubW9udGhOYW1lcyA9IFtcbiAgICAgICAgICAgICfRj9C90LLQsNGA0YwnLFxuICAgICAgICAgICAgJ9GE0LXQstGA0LDQu9GMJyxcbiAgICAgICAgICAgICfQvNCw0YDRgicsXG4gICAgICAgICAgICAn0LDQv9GA0LXQu9GMJyxcbiAgICAgICAgICAgICfQvNCw0LknLFxuICAgICAgICAgICAgJ9C40Y7QvdGMJyxcbiAgICAgICAgICAgICfQuNGO0LvRjCcsXG4gICAgICAgICAgICAn0LDQstCz0YPRgdGCJyxcbiAgICAgICAgICAgICfRgdC10L3RgtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQvtC60YLRj9Cx0YDRjCcsXG4gICAgICAgICAgICAn0L3QvtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQtNC10LrQsNCx0YDRjCdcbiAgICAgICAgXTtcbiAgICAgICAgc2VsZi5kYXRhTGlzdCA9ICcnO1xuXG5cbiAgICAgICAgLy8gc2VsZi5kYXRlRnJvbUlucHV0ID0gc2VsZi5jb250YWluZXIucXVlcnlTZWxlY3RvcignLmZvcm1JbnB1dF9faW5wdXRbbmFtZT1cImZyb21cIl0nKTtcbiAgICAgICAgLy8gc2VsZi5kYXRlVG9JbnB1dCA9IHNlbGYuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtSW5wdXRfX2lucHV0W25hbWU9XCJ0b1wiXScpO1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gc2VsZi5kYXRlRnJvbUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNlbGYuZ2V0RGF0YSk7XG4gICAgICAgICAgICAvLyBzZWxmLmRhdGVUb0lucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNlbGYuZ2V0RGF0YSk7XG4gICAgICAgICAgICAvLyBzZWxmLnBsYWNlU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNlbGYuZ2V0RGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHVwIHBsYWNlIGZpbHRlciB2YWx1ZXNcbiAgICAgICAgICovXG4gICAgICAgIC8vIHNlbGYuc2V0dXBQbGFjZUZpbHRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyAgICAgc2VsZi5nZXRQbGFjZSgpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgLy8gICAgICAgICB2YXIgaHRtbCA9ICc8b3B0aW9uIHZhbHVlPVwiXCI+PC9vcHRpb24+JztcbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgICAgICByZXNwb25zZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgaHRtbCArPSAnPG9wdGlvbiB2YWx1ZT1cIicrIGl0ZW0uaWQgKydcIj4nKyBpdGVtLnRpdGxlICsnPC9vcHRpb24+JztcbiAgICAgICAgLy8gICAgICAgICB9KTtcbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgICAgICBzZWxmLnBsYWNlU2VsZWN0LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgLy8gfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IGRhdGEgZnJvbSBsaWJyYXJ5IGFjY29yZGluZyB0byBmaWx0ZXIgdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdldERhdGEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBkYXRlRnJvbSA9ICcnLC8vc2VsZi5kYXRlRnJvbUlucHV0LnZhbHVlLnJlcGxhY2UoLy0vZywgJy8nKSxcbiAgICAgICAgICAgICAgICBkYXRlVG8gPSAnJywvL3NlbGYuZGF0ZVRvSW5wdXQudmFsdWUucmVwbGFjZSgvLS9nLCAnLycpLFxuICAgICAgICAgICAgICAgIHBsYWNlID0gJyc7Ly9zZWxmLnBsYWNlU2VsZWN0LnZhbHVlID8gcGFyc2VJbnQoc2VsZi5wbGFjZVNlbGVjdC52YWx1ZSkgOiAnJztcblxuICAgICAgICAgICAgc2VsZi5nZXRTY2hlZHVsZShkYXRlRnJvbSwgZGF0ZVRvLCBwbGFjZSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW5kZXIgc2NoZWR1bGUgbGlzdFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2VcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVuZGVyID0gZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBjb250ZW50TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICAgICAgICAgIGNvbnRlbnRMaXN0LmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlTGlzdF9fbGlzdCcpO1xuXG4gICAgICAgICAgICByZXNwb25zZS5sZWN0dXJlcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlTGlzdF9faXRlbScpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gc2VsZi50ZW1wbGF0ZTtcblxuICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoaXRlbS5kYXRlKSxcbiAgICAgICAgICAgICAgICAgICAgZGF5ID0gZGF0ZS5nZXREYXRlKCksXG4gICAgICAgICAgICAgICAgICAgIG1vbnRoID0gc2VsZi5tb250aE5hbWVzW2RhdGUuZ2V0TW9udGgoKV0sXG4gICAgICAgICAgICAgICAgICAgIHNjaG9vbCA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBhdXRob3IgPSBbXTtcblxuICAgICAgICAgICAgICAgIGl0ZW0uc2Nob29sLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbVRpdGxlID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdzY2hvb2xzJywgZGF0YTogcmVzcG9uc2Uuc2Nob29sc30sICd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUlkID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdzY2hvb2xzJywgZGF0YTogcmVzcG9uc2Uuc2Nob29sc30sICdpZCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNjaG9vbC5wdXNoKCc8c3BhbiBjbGFzcz1cInNjaGVkdWxlSXRlbV9fc2Nob29sX19pdGVtIHNjaGVkdWxlSXRlbV9fc2Nob29sX19pdGVtXycrIGl0ZW1JZCArJ1wiPicrIGl0ZW1UaXRsZSArJzwvc3Bhbj4nKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0ZW0uYXV0aG9yLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbVRpdGxlID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdhdXRob3JzJywgZGF0YTogcmVzcG9uc2UuYXV0aG9yc30sICd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVBob3RvID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdhdXRob3JzJywgZGF0YTogcmVzcG9uc2UuYXV0aG9yc30sICdwaG90bycpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbURlc2NyaXB0aW9uID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdhdXRob3JzJywgZGF0YTogcmVzcG9uc2UuYXV0aG9yc30sICdkZXNjcmlwdGlvbicpO1xuXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvci5wdXNoKCc8YSBjbGFzcz1cInNjaGVkdWxlSXRlbV9fYXV0aG9yX19saW5rIG1vZGFsX3RyaWdnZXJcIiBocmVmPVwiI2F1dGhvclwiIHRpdGxlPVwi0J/QvtGB0LzQvtGC0YDQtdGC0Ywg0LTQvtC/0L7Qu9C90LjRgtC10LvRjNC90YPRjiDQuNC90YTQvtGA0LzQsNGG0LjRjlwiIGRhdGEtcGhvdG89XCInKyBpdGVtUGhvdG8gKydcIiBkYXRhLXRpdGxlPVwiJysgaXRlbVRpdGxlICsnXCIgZGF0YS1kZXNjcmlwdGlvbj1cIicrIGl0ZW1EZXNjcmlwdGlvbiArJ1wiPicrIGl0ZW1UaXRsZSArJzwvYT4nKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzT3Zlcikge1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbScpLmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlSXRlbV9zdGF0ZV9pbmFjdGl2ZScpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19kYXknKS5pbm5lckhUTUwgPSBkYXk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX21vbnRoJykuaW5uZXJIVE1MID0gbW9udGg7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3RpbWUnKS5pbm5lckhUTUwgPSBpdGVtLnRpbWU7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3RpdGxlJykuaW5uZXJIVE1MID0gaXRlbS50aXRsZTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fc2Nob29sJykuaW5uZXJIVE1MID0gc2Nob29sLmpvaW4oJycpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19hdXRob3InKS5pbm5lckhUTUwgKz0gYXV0aG9yLmpvaW4oJywgJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX2F1ZGllbmNlJykuaW5uZXJIVE1MICs9IHNlbGYuZXhwYW5kKFtpdGVtLnBsYWNlXSwge3RpdGxlOiAncGxhY2VzJywgZGF0YTogcmVzcG9uc2UucGxhY2VzfSwgJ3RpdGxlJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3BsYWNlX19saW5rJykuaW5uZXJIVE1MID0gc2VsZi5leHBhbmQoW2l0ZW0ucGxhY2VdLCB7dGl0bGU6ICdwbGFjZXMnLCBkYXRhOiByZXNwb25zZS5wbGFjZXN9LCAnYWRkcmVzcycpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19wbGFjZV9fbGluaycpLmhyZWYgPSBzZWxmLmV4cGFuZChbaXRlbS5wbGFjZV0sIHt0aXRsZTogJ3BsYWNlcycsIGRhdGE6IHJlc3BvbnNlLnBsYWNlc30sICdsaW5rJyk7XG5cbiAgICAgICAgICAgICAgICBjb250ZW50TGlzdC5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgICAgIHNlbGYuY29udGVudC5hcHBlbmRDaGlsZChjb250ZW50TGlzdCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEltcG9ydCBwcm9wZXJ0aWVzIGZyb20gTWFpbiBjbGFzc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5ib2R5ID0gYXBwLm1vZHVsZXMubWFpbi5ib2R5O1xuICAgICAgICAgICAgc2VsZi5nZXRTY2hlZHVsZSA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5nZXRTY2hlZHVsZTtcbiAgICAgICAgICAgIC8vIHNlbGYuZ2V0UGxhY2UgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZ2V0UGxhY2U7XG4gICAgICAgICAgICAvLyBzZWxmLmdldFNjaG9vbCA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5nZXRTY2hvb2w7XG4gICAgICAgICAgICAvLyBzZWxmLmdldEF1dGhvciA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5nZXRBdXRob3I7XG4gICAgICAgICAgICBzZWxmLmV4cGFuZCA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5leHBhbmQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cygpO1xuICAgICAgICAgICAgICAgIC8vIHNlbGYuc2V0dXBQbGFjZUZpbHRlcigpO1xuICAgICAgICAgICAgICAgIHNlbGYuZ2V0RGF0YSgpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiBhcHApKSB7XG4gICAgICAgIGFwcC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgYXBwLm1vZHVsZXMuc2NoZWR1bGUgPSBuZXcgU2NoZWR1bGUoKTtcbn0pKCk7XG4iXX0=

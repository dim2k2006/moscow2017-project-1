var initApp=function(){if(!("modules"in app&&"main"in app.modules)){var e=function(){var e=this;e.html=document.querySelector("html"),e.body=document.querySelector("body"),e.modules=app.modules,e.library=new Library,e.initLibrary=function(){e.library.init()},e.initModules=function(){for(var t in e.modules)e.modules.hasOwnProperty(t)&&"undefined"!=typeof e.modules[t].init&&"main"!==t&&"library"!==t&&e.modules[t].init()},e.init=function(){e.initLibrary(),e.initModules()}};"modules"in app||(app.modules={}),app.modules.main=new e,app.modules.main.init()}};window.addEventListener("load",initApp),function(){if(!("modules"in app&&"modal"in app.modules)){var e=function(){var e=this;e.html="",e.body="",e.container=document.querySelector(".modal"),e.openButton=document.querySelector(".modal_trigger"),e.closeButton=document.querySelector(".modal_close"),e.setupListener=function(){e.body.addEventListener("click",e.router)},e.router=function(t){var l=t.target;l.classList.contains("modal_trigger")?(t.preventDefault(),e.open(t.target)):l.classList.contains("modal_close")&&(t.preventDefault(),e.close(t.target))},e.open=function(t){var l=t.getAttribute("href"),n=document.querySelector(l),o=t.dataset.photo,a=t.dataset.title,r=t.dataset.description;n.querySelector(".authorInfo__preview img").src=o,n.querySelector(".authorInfo__title").innerHTML=a,n.querySelector(".authorInfo__text p").innerHTML=r,e.html.classList.add("modal_state_open"),n.classList.add("modal_state_open")},e.close=function(t){var l=t.closest(".modal");l.classList.remove("modal_state_open"),e.html.classList.remove("modal_state_open")},e.importDefaults=function(){e.html=app.modules.main.html,e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.modal=new e}}(),function(){if(!("modules"in app&&"schedule"in app.modules)){var e=function(){var e=this;e.body="",e.getSchedule="",e.getPlace="",e.getSchool="",e.getAuthor="",e.expand="",e.getValue="",e.container=document.querySelector(".schedule"),e.content=document.querySelector(".scheduleList__content"),e.burger=document.querySelector(".schedule__burger"),e.schoolSelect=document.querySelector('.formSelectMultiple__select[name="school"]'),e.authorSelect=document.querySelector('.formSelectMultiple__select[name="author"]'),e.dateFromInput=document.querySelector('.formInput__input[name="from"]'),e.dateToInput=document.querySelector('.formInput__input[name="to"]'),e.schoolSelectMultiple=document.querySelector(".formSelectMultiple.formSelectMultiple_type_school"),e.authorSelectMultiple=document.querySelector(".formSelectMultiple.formSelectMultiple_type_author"),e.selectMultiple=document.querySelectorAll(".formSelectMultiple"),e.template=document.querySelector("#scheduleItem-template").innerHTML,e.monthNames=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],e.dataList="",e.setupListener=function(){e.dateFromInput.addEventListener("change",e.getData),e.dateToInput.addEventListener("change",e.getData),e.selectMultiple.forEach(function(t){t.addEventListener("render",e.getData)}),e.burger.addEventListener("click",e.showFilter)},e.showFilter=function(t){t.preventDefault(),e.container.classList.contains("schedule_state_filter")?e.container.classList.remove("schedule_state_filter"):e.container.classList.add("schedule_state_filter")},e.setupSchoolFilter=function(){e.getSchool().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.schoolSelect.innerHTML=l})},e.setupAuthorFilter=function(){e.getAuthor().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.authorSelect.innerHTML=l})},e.getData=function(){var t=e.dateFromInput.value.replace(/-/g,"/"),l=e.dateToInput.value.replace(/-/g,"/"),n=e.getValue(e.schoolSelectMultiple),o=e.getValue(e.authorSelectMultiple);e.getSchedule(t,l,"").then(function(t){n.length>0&&(t.lectures=t.lectures.filter(function(e){var t=!1;return n.forEach(function(l){e.school.indexOf(parseInt(l.value))!==-1&&(t=!0)}),t})),o.length>0&&(t.lectures=t.lectures.filter(function(e){var t=!1;return o.forEach(function(l){e.author.indexOf(parseInt(l.value))!==-1&&(t=!0)}),t})),e.render(t)})},e.render=function(t){var l=document.createElement("ul");l.classList.add("scheduleList__list"),t.lectures.forEach(function(n){var o=document.createElement("li");o.classList.add("scheduleList__item"),o.innerHTML=e.template;var a=new Date(n.date),r=a.getDate(),i=e.monthNames[a.getMonth()],u=[],c=[];n.school.forEach(function(l){var n=e.expand([l],{title:"schools",data:t.schools},"title"),o=e.expand([l],{title:"schools",data:t.schools},"id");u.push('<span class="scheduleItem__school__item scheduleItem__school__item_'+o+'">'+n+"</span>")}),n.author.forEach(function(l){var n=e.expand([l],{title:"authors",data:t.authors},"title"),o=e.expand([l],{title:"authors",data:t.authors},"photo"),a=e.expand([l],{title:"authors",data:t.authors},"description");c.push('<a class="scheduleItem__author__link modal_trigger" href="#author-modal" title="Посмотреть дополнительную информацию" data-photo="'+o+'" data-title="'+n+'" data-description="'+a+'">'+n+"</a>")}),n.isOver&&o.querySelector(".scheduleItem").classList.add("scheduleItem_state_inactive"),o.querySelector(".scheduleItem__day").innerHTML=r,o.querySelector(".scheduleItem__month").innerHTML=i,o.querySelector(".scheduleItem__time").innerHTML=n.time,o.querySelector(".scheduleItem__title").innerHTML=n.title,o.querySelector(".scheduleItem__school").innerHTML=u.join(""),o.querySelector(".scheduleItem__author").innerHTML+=c.join(", "),o.querySelector(".scheduleItem__audience").innerHTML+=e.expand([n.place],{title:"places",data:t.places},"title"),o.querySelector(".scheduleItem__place__link").innerHTML=e.expand([n.place],{title:"places",data:t.places},"address"),o.querySelector(".scheduleItem__place__link").href=e.expand([n.place],{title:"places",data:t.places},"link"),l.appendChild(o)}),e.content.innerHTML="",e.content.appendChild(l)},e.importDefaults=function(){e.body=app.modules.main.body,e.getSchedule=app.modules.main.library.getSchedule,e.getSchool=app.modules.main.library.getSchool,e.getAuthor=app.modules.main.library.getAuthor,e.expand=app.modules.main.library.expand,e.getValue=app.modules.formSelectMultiple.getValue},e.init=function(){e.container&&(e.importDefaults(),e.setupSchoolFilter(),e.setupAuthorFilter(),e.getData(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.schedule=new e}}(),function(){if(!("modules"in app&&"formSelectMultiple"in app.modules)){var e=function(){var e=this;e.body="",e.container=document.querySelector(".formSelectMultiple"),e.setupListener=function(){e.body.addEventListener("change",e.handleChange),e.body.addEventListener("click",e.handleClick)},e.handleChange=function(){var t=event.target;if(t.classList.contains("formSelectMultiple__select")){var l=t.closest(".formSelectMultiple"),n=l.querySelector(".formSelectMultiple__select"),o=n.value,a=l.dataset.list?JSON.parse(l.dataset.list):[],r=[].slice.call(n.querySelectorAll("option")),i=[],u=[];l.classList.contains("formSelectMultiple_state_inited")||([].slice.call(n.querySelectorAll("option")).forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&a.push({value:t,text:l})}),l.dataset.list=JSON.stringify(a),l.classList.add("formSelectMultiple_state_inited")),r.forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&i.push({value:t,text:l})}),i=i.filter(function(e){return e.value!==o}),i.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),u=a,e.render(l,i,u)}},e.handleClick=function(t){var l=t.target;if(l.classList.contains("formSelectMultiple__link")){t.preventDefault();var n=l.closest(".formSelectMultiple"),o=l.getAttribute("href"),a=n.dataset.list?JSON.parse(n.dataset.list):[],r=[].slice.call(n.querySelectorAll("a")),i=[],u=[];u=r.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}}).filter(function(e){return e.value!==o}),u.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),i=a,e.render(n,i,u)}},e.getValue=function(e){var t=[];if(e){var l=[].slice.call(e.querySelectorAll("a"));t=l.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}})}return t},e.render=function(e,t,l){var n=e.querySelector(".formSelectMultiple__select"),o=e.querySelector(".formSelectMultiple__list"),a='<option value=""></option>',r="";t.length>0&&t.forEach(function(e){a+='<option value="'+e.value+'">'+e.text+"</option>"}),l.length>0&&l.forEach(function(e){r+='<li class="formSelectMultiple__item"><a href="'+e.value+'" class="formSelectMultiple__link">'+e.text+"</a></li>"}),n&&(n.innerHTML=a),o&&(o.innerHTML=r),e.dispatchEvent(new Event("render"))},e.importDefaults=function(){e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.formSelectMultiple=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vbWFpbi5qcyIsIm1vZGFsL21vZGFsLmpzIiwic2NoZWR1bGUvc2NoZWR1bGUuanMiLCJmb3JtU2VsZWN0TXVsdGlwbGUvZm9ybVNlbGVjdE11bHRpcGxlLmpzIl0sIm5hbWVzIjpbImluaXRBcHAiLCJhcHAiLCJtb2R1bGVzIiwiTWFpbiIsInNlbGYiLCJ0aGlzIiwiaHRtbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJvZHkiLCJsaWJyYXJ5IiwiTGlicmFyeSIsImluaXRMaWJyYXJ5IiwiaW5pdCIsImluaXRNb2R1bGVzIiwibW9kdWxlIiwiaGFzT3duUHJvcGVydHkiLCJtYWluIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsIk1vZGFsIiwiY29udGFpbmVyIiwib3BlbkJ1dHRvbiIsImNsb3NlQnV0dG9uIiwic2V0dXBMaXN0ZW5lciIsInJvdXRlciIsImV2ZW50IiwidGFyZ2V0IiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJwcmV2ZW50RGVmYXVsdCIsIm9wZW4iLCJjbG9zZSIsInNyYyIsImdldEF0dHJpYnV0ZSIsInBob3RvIiwiZGF0YXNldCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJpbm5lckhUTUwiLCJhZGQiLCJjbG9zZXN0IiwicmVtb3ZlIiwiaW1wb3J0RGVmYXVsdHMiLCJtb2RhbCIsIlNjaGVkdWxlIiwiZ2V0U2NoZWR1bGUiLCJnZXRQbGFjZSIsImdldFNjaG9vbCIsImdldEF1dGhvciIsImV4cGFuZCIsImdldFZhbHVlIiwiY29udGVudCIsImJ1cmdlciIsInNjaG9vbFNlbGVjdCIsImF1dGhvclNlbGVjdCIsImRhdGVGcm9tSW5wdXQiLCJkYXRlVG9JbnB1dCIsInNjaG9vbFNlbGVjdE11bHRpcGxlIiwiYXV0aG9yU2VsZWN0TXVsdGlwbGUiLCJzZWxlY3RNdWx0aXBsZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ0ZW1wbGF0ZSIsIm1vbnRoTmFtZXMiLCJkYXRhTGlzdCIsImdldERhdGEiLCJmb3JFYWNoIiwiaXRlbSIsInNob3dGaWx0ZXIiLCJzZXR1cFNjaG9vbEZpbHRlciIsInRoZW4iLCJyZXNwb25zZSIsImlkIiwic2V0dXBBdXRob3JGaWx0ZXIiLCJkYXRlRnJvbSIsInZhbHVlIiwicmVwbGFjZSIsImRhdGVUbyIsInNjaG9vbCIsImF1dGhvciIsImxlbmd0aCIsImxlY3R1cmVzIiwiZmlsdGVyIiwicmVzdWx0Iiwic2Nob29sSXRlbSIsImluZGV4T2YiLCJwYXJzZUludCIsImF1dGhvckl0ZW0iLCJyZW5kZXIiLCJjb250ZW50TGlzdCIsImNyZWF0ZUVsZW1lbnQiLCJlbGVtZW50IiwiZGF0ZSIsIkRhdGUiLCJkYXkiLCJnZXREYXRlIiwibW9udGgiLCJnZXRNb250aCIsIml0ZW1UaXRsZSIsImRhdGEiLCJzY2hvb2xzIiwiaXRlbUlkIiwicHVzaCIsImF1dGhvcnMiLCJpdGVtUGhvdG8iLCJpdGVtRGVzY3JpcHRpb24iLCJpc092ZXIiLCJ0aW1lIiwiam9pbiIsInBsYWNlIiwicGxhY2VzIiwiaHJlZiIsImFwcGVuZENoaWxkIiwiZm9ybVNlbGVjdE11bHRpcGxlIiwic2NoZWR1bGUiLCJGb3JtU2VsZWN0TXVsdGlwbGUiLCJoYW5kbGVDaGFuZ2UiLCJoYW5kbGVDbGljayIsInNlbGVjdCIsInNlbGVjdGVkVmFsdWUiLCJpbml0aWFsTGlzdCIsImxpc3QiLCJKU09OIiwicGFyc2UiLCJvcHRpb25zIiwic2xpY2UiLCJjYWxsIiwic2VsZWN0TGlzdCIsInJlc3VsdExpc3QiLCJ0ZXh0Iiwic3RyaW5naWZ5Iiwic2VsZWN0SXRlbSIsImluaXRpYWxJdGVtIiwiaW5kZXgiLCJzcGxpY2UiLCJsaW5rcyIsIm1hcCIsInJlc3VsdEl0ZW0iLCJzZWxlY3REYXRhIiwicmVzdWx0RGF0YSIsInNlbGVjdENvbnRhaW5lciIsInJlc3VsdENvbnRhaW5lciIsInNlbGVjdEh0bWwiLCJyZXN1bHRIdG1sIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxTQUFBLFdBQ0EsS0FB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bkUsRUFBQXFILEVBQUFDLEdBQ0EsR0FBQUMsR0FBQXZILEVBQUFiLGNBQUEsK0JBQ0FxSSxFQUFBeEgsRUFBQWIsY0FBQSw2QkFDQXNJLEVBQUEsNkJBQ0FDLEVBQUEsRUFFQUwsR0FBQTFELE9BQUEsR0FFQTBELEVBQUF4RSxRQUFBLFNBQUFDLEdBQ0EyRSxHQUFBLGtCQUFBM0UsRUFBQVEsTUFBQSxLQUFBUixFQUFBOEQsS0FBQSxjQUtBVSxFQUFBM0QsT0FBQSxHQUVBMkQsRUFBQXpFLFFBQUEsU0FBQUMsR0FDQTRFLEdBQUEsaURBQUE1RSxFQUFBUSxNQUFBLHNDQUFBUixFQUFBOEQsS0FBQSxjQUtBVyxJQUVBQSxFQUFBckcsVUFBQXVHLEdBSUFELElBRUFBLEVBQUF0RyxVQUFBd0csR0FJQTFILEVBQUEySCxjQUFBLEdBQUFDLE9BQUEsWUFNQTdJLEVBQUF1QyxlQUFBLFdBQ0F2QyxFQUFBSyxLQUFBUixJQUFBQyxRQUFBZSxLQUFBUixNQU1BTCxFQUFBUyxLQUFBLFdBQ0FULEVBQUFpQixZQUVBakIsRUFBQXVDLGlCQUNBdkMsRUFBQW9CLGtCQU1BLFlBQUF2QixPQUNBQSxJQUFBQyxZQUdBRCxJQUFBQyxRQUFBK0csbUJBQUEsR0FBQUUiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaW5pdEFwcCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gYXBwICYmICdtYWluJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNYWluIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBNYWluID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmh0bWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJyk7XG4gICAgICAgIHNlbGYuYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcbiAgICAgICAgc2VsZi5tb2R1bGVzID0gYXBwLm1vZHVsZXM7XG4gICAgICAgIHNlbGYubGlicmFyeSA9IG5ldyBMaWJyYXJ5KCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbGlicmFyeSBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdExpYnJhcnkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYubGlicmFyeS5pbml0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgYWxsIG1vZHVsZXMgaW4gJC5tb2R1bGVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRNb2R1bGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBtb2R1bGUgaW4gc2VsZi5tb2R1bGVzKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5tb2R1bGVzLmhhc093blByb3BlcnR5KG1vZHVsZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNlbGYubW9kdWxlc1ttb2R1bGVdLmluaXQgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZSAhPT0gJ21haW4nICYmIG1vZHVsZSAhPT0gJ2xpYnJhcnknKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubW9kdWxlc1ttb2R1bGVdLmluaXQoKTtcblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5pbml0TGlicmFyeSgpO1xuICAgICAgICAgICAgc2VsZi5pbml0TW9kdWxlcygpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLm1haW4gPSBuZXcgTWFpbigpO1xuXG4gICAgYXBwLm1vZHVsZXMubWFpbi5pbml0KCk7XG59O1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGluaXRBcHApO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnbW9kYWwnIGluIGFwcC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE1vZGFsIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBNb2RhbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuaHRtbCA9ICcnO1xuICAgICAgICBzZWxmLmJvZHkgPSAnJztcbiAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwnKTtcbiAgICAgICAgc2VsZi5vcGVuQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX3RyaWdnZXInKTtcbiAgICAgICAgc2VsZi5jbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9jbG9zZScpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYucm91dGVyKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUm91dGUgY2xpY2sgZXZlbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJvdXRlciA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfdHJpZ2dlcicpKSB7XG5cbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgc2VsZi5vcGVuKGV2ZW50LnRhcmdldCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfY2xvc2UnKSkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UoZXZlbnQudGFyZ2V0KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYub3BlbiA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAgICAgdmFyIHNyYyA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNyYyksXG4gICAgICAgICAgICAgICAgcGhvdG8gPSB0YXJnZXQuZGF0YXNldC5waG90byxcbiAgICAgICAgICAgICAgICB0aXRsZSA9IHRhcmdldC5kYXRhc2V0LnRpdGxlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gdGFyZ2V0LmRhdGFzZXQuZGVzY3JpcHRpb247XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYXV0aG9ySW5mb19fcHJldmlldyBpbWcnKS5zcmMgPSBwaG90bztcblxuICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5hdXRob3JJbmZvX190aXRsZScpLmlubmVySFRNTCA9IHRpdGxlO1xuXG4gICAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmF1dGhvckluZm9fX3RleHQgcCcpLmlubmVySFRNTCA9IGRlc2NyaXB0aW9uO1xuXG4gICAgICAgICAgICBzZWxmLmh0bWwuY2xhc3NMaXN0LmFkZCgnbW9kYWxfc3RhdGVfb3BlbicpO1xuICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmNsb3NlID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGFyZ2V0LmNsb3Nlc3QoJy5tb2RhbCcpO1xuXG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWxfc3RhdGVfb3BlbicpO1xuICAgICAgICAgICAgc2VsZi5odG1sLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW1wb3J0IHByb3BlcnRpZXMgZnJvbSBNYWluIGNsYXNzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmh0bWwgPSBhcHAubW9kdWxlcy5tYWluLmh0bWw7XG4gICAgICAgICAgICBzZWxmLmJvZHkgPSBhcHAubW9kdWxlcy5tYWluLmJvZHk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cygpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiBhcHApKSB7XG4gICAgICAgIGFwcC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgYXBwLm1vZHVsZXMubW9kYWwgPSBuZXcgTW9kYWwoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ3NjaGVkdWxlJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBTY2hlZHVsZSBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgU2NoZWR1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmJvZHkgPSAnJztcbiAgICAgICAgc2VsZi5nZXRTY2hlZHVsZSA9ICcnO1xuICAgICAgICBzZWxmLmdldFBsYWNlID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0U2Nob29sID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0QXV0aG9yID0gJyc7XG4gICAgICAgIHNlbGYuZXhwYW5kID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0VmFsdWUgPSAnJztcbiAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGUnKTtcbiAgICAgICAgc2VsZi5jb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlTGlzdF9fY29udGVudCcpO1xuICAgICAgICBzZWxmLmJ1cmdlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZV9fYnVyZ2VyJyk7XG4gICAgICAgIHNlbGYuc2Nob29sU2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0W25hbWU9XCJzY2hvb2xcIl0nKTtcbiAgICAgICAgc2VsZi5hdXRob3JTZWxlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3RbbmFtZT1cImF1dGhvclwiXScpO1xuICAgICAgICBzZWxmLmRhdGVGcm9tSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybUlucHV0X19pbnB1dFtuYW1lPVwiZnJvbVwiXScpO1xuICAgICAgICBzZWxmLmRhdGVUb0lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1JbnB1dF9faW5wdXRbbmFtZT1cInRvXCJdJyk7XG4gICAgICAgIHNlbGYuc2Nob29sU2VsZWN0TXVsdGlwbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlLmZvcm1TZWxlY3RNdWx0aXBsZV90eXBlX3NjaG9vbCcpO1xuICAgICAgICBzZWxmLmF1dGhvclNlbGVjdE11bHRpcGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZS5mb3JtU2VsZWN0TXVsdGlwbGVfdHlwZV9hdXRob3InKTtcbiAgICAgICAgc2VsZi5zZWxlY3RNdWx0aXBsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKTtcbiAgICAgICAgc2VsZi50ZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzY2hlZHVsZUl0ZW0tdGVtcGxhdGUnKS5pbm5lckhUTUw7XG4gICAgICAgIHNlbGYubW9udGhOYW1lcyA9IFtcbiAgICAgICAgICAgICfRj9C90LLQsNGA0YwnLFxuICAgICAgICAgICAgJ9GE0LXQstGA0LDQu9GMJyxcbiAgICAgICAgICAgICfQvNCw0YDRgicsXG4gICAgICAgICAgICAn0LDQv9GA0LXQu9GMJyxcbiAgICAgICAgICAgICfQvNCw0LknLFxuICAgICAgICAgICAgJ9C40Y7QvdGMJyxcbiAgICAgICAgICAgICfQuNGO0LvRjCcsXG4gICAgICAgICAgICAn0LDQstCz0YPRgdGCJyxcbiAgICAgICAgICAgICfRgdC10L3RgtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQvtC60YLRj9Cx0YDRjCcsXG4gICAgICAgICAgICAn0L3QvtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQtNC10LrQsNCx0YDRjCdcbiAgICAgICAgXTtcbiAgICAgICAgc2VsZi5kYXRhTGlzdCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuZGF0ZUZyb21JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICAgICAgc2VsZi5kYXRlVG9JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICAgICAgc2VsZi5zZWxlY3RNdWx0aXBsZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ3JlbmRlcicsIHNlbGYuZ2V0RGF0YSl9KTtcbiAgICAgICAgICAgIHNlbGYuYnVyZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5zaG93RmlsdGVyKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBmaWx0ZXIgY29udGFpbmVyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zaG93RmlsdGVyID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ3NjaGVkdWxlX3N0YXRlX2ZpbHRlcicpKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdzY2hlZHVsZV9zdGF0ZV9maWx0ZXInKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlX3N0YXRlX2ZpbHRlcicpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHVwIHNjaG9vbCBmaWx0ZXIgdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwU2Nob29sRmlsdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmdldFNjaG9vbCgpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgaHRtbCA9ICc8b3B0aW9uIHZhbHVlPVwiXCI+PC9vcHRpb24+JztcblxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8b3B0aW9uIHZhbHVlPVwiJysgaXRlbS5pZCArJ1wiPicrIGl0ZW0udGl0bGUgKyc8L29wdGlvbj4nO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZi5zY2hvb2xTZWxlY3QuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXR1cCBhdXRob3IgZmlsdGVyIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cEF1dGhvckZpbHRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5nZXRBdXRob3IoKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPG9wdGlvbiB2YWx1ZT1cIlwiPjwvb3B0aW9uPic7XG5cbiAgICAgICAgICAgICAgICByZXNwb25zZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPG9wdGlvbiB2YWx1ZT1cIicrIGl0ZW0uaWQgKydcIj4nKyBpdGVtLnRpdGxlICsnPC9vcHRpb24+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGYuYXV0aG9yU2VsZWN0LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IGRhdGEgZnJvbSBsaWJyYXJ5IGFjY29yZGluZyB0byBmaWx0ZXIgdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdldERhdGEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBkYXRlRnJvbSA9IHNlbGYuZGF0ZUZyb21JbnB1dC52YWx1ZS5yZXBsYWNlKC8tL2csICcvJyksXG4gICAgICAgICAgICAgICAgZGF0ZVRvID0gc2VsZi5kYXRlVG9JbnB1dC52YWx1ZS5yZXBsYWNlKC8tL2csICcvJyksXG4gICAgICAgICAgICAgICAgc2Nob29sID0gc2VsZi5nZXRWYWx1ZShzZWxmLnNjaG9vbFNlbGVjdE11bHRpcGxlKSxcbiAgICAgICAgICAgICAgICBhdXRob3IgPSBzZWxmLmdldFZhbHVlKHNlbGYuYXV0aG9yU2VsZWN0TXVsdGlwbGUpO1xuXG4gICAgICAgICAgICBzZWxmLmdldFNjaGVkdWxlKGRhdGVGcm9tLCBkYXRlVG8sICcnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjaG9vbC5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubGVjdHVyZXMgPSByZXNwb25zZS5sZWN0dXJlcy5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2hvb2wuZm9yRWFjaChmdW5jdGlvbihzY2hvb2xJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc2Nob29sLmluZGV4T2YocGFyc2VJbnQoc2Nob29sSXRlbS52YWx1ZSkpICE9PSAtMSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoYXV0aG9yLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5sZWN0dXJlcyA9IHJlc3BvbnNlLmxlY3R1cmVzLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvci5mb3JFYWNoKGZ1bmN0aW9uKGF1dGhvckl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5hdXRob3IuaW5kZXhPZihwYXJzZUludChhdXRob3JJdGVtLnZhbHVlKSkgIT09IC0xKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW5kZXIgc2NoZWR1bGUgbGlzdFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2VcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVuZGVyID0gZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBjb250ZW50TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICAgICAgICAgIGNvbnRlbnRMaXN0LmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlTGlzdF9fbGlzdCcpO1xuXG4gICAgICAgICAgICByZXNwb25zZS5sZWN0dXJlcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlTGlzdF9faXRlbScpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gc2VsZi50ZW1wbGF0ZTtcblxuICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoaXRlbS5kYXRlKSxcbiAgICAgICAgICAgICAgICAgICAgZGF5ID0gZGF0ZS5nZXREYXRlKCksXG4gICAgICAgICAgICAgICAgICAgIG1vbnRoID0gc2VsZi5tb250aE5hbWVzW2RhdGUuZ2V0TW9udGgoKV0sXG4gICAgICAgICAgICAgICAgICAgIHNjaG9vbCA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBhdXRob3IgPSBbXTtcblxuICAgICAgICAgICAgICAgIGl0ZW0uc2Nob29sLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbVRpdGxlID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdzY2hvb2xzJywgZGF0YTogcmVzcG9uc2Uuc2Nob29sc30sICd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUlkID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdzY2hvb2xzJywgZGF0YTogcmVzcG9uc2Uuc2Nob29sc30sICdpZCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNjaG9vbC5wdXNoKCc8c3BhbiBjbGFzcz1cInNjaGVkdWxlSXRlbV9fc2Nob29sX19pdGVtIHNjaGVkdWxlSXRlbV9fc2Nob29sX19pdGVtXycrIGl0ZW1JZCArJ1wiPicrIGl0ZW1UaXRsZSArJzwvc3Bhbj4nKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0ZW0uYXV0aG9yLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbVRpdGxlID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdhdXRob3JzJywgZGF0YTogcmVzcG9uc2UuYXV0aG9yc30sICd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVBob3RvID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdhdXRob3JzJywgZGF0YTogcmVzcG9uc2UuYXV0aG9yc30sICdwaG90bycpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbURlc2NyaXB0aW9uID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdhdXRob3JzJywgZGF0YTogcmVzcG9uc2UuYXV0aG9yc30sICdkZXNjcmlwdGlvbicpO1xuXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvci5wdXNoKCc8YSBjbGFzcz1cInNjaGVkdWxlSXRlbV9fYXV0aG9yX19saW5rIG1vZGFsX3RyaWdnZXJcIiBocmVmPVwiI2F1dGhvci1tb2RhbFwiIHRpdGxlPVwi0J/QvtGB0LzQvtGC0YDQtdGC0Ywg0LTQvtC/0L7Qu9C90LjRgtC10LvRjNC90YPRjiDQuNC90YTQvtGA0LzQsNGG0LjRjlwiIGRhdGEtcGhvdG89XCInKyBpdGVtUGhvdG8gKydcIiBkYXRhLXRpdGxlPVwiJysgaXRlbVRpdGxlICsnXCIgZGF0YS1kZXNjcmlwdGlvbj1cIicrIGl0ZW1EZXNjcmlwdGlvbiArJ1wiPicrIGl0ZW1UaXRsZSArJzwvYT4nKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzT3Zlcikge1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbScpLmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlSXRlbV9zdGF0ZV9pbmFjdGl2ZScpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19kYXknKS5pbm5lckhUTUwgPSBkYXk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX21vbnRoJykuaW5uZXJIVE1MID0gbW9udGg7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3RpbWUnKS5pbm5lckhUTUwgPSBpdGVtLnRpbWU7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3RpdGxlJykuaW5uZXJIVE1MID0gaXRlbS50aXRsZTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fc2Nob29sJykuaW5uZXJIVE1MID0gc2Nob29sLmpvaW4oJycpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19hdXRob3InKS5pbm5lckhUTUwgKz0gYXV0aG9yLmpvaW4oJywgJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX2F1ZGllbmNlJykuaW5uZXJIVE1MICs9IHNlbGYuZXhwYW5kKFtpdGVtLnBsYWNlXSwge3RpdGxlOiAncGxhY2VzJywgZGF0YTogcmVzcG9uc2UucGxhY2VzfSwgJ3RpdGxlJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3BsYWNlX19saW5rJykuaW5uZXJIVE1MID0gc2VsZi5leHBhbmQoW2l0ZW0ucGxhY2VdLCB7dGl0bGU6ICdwbGFjZXMnLCBkYXRhOiByZXNwb25zZS5wbGFjZXN9LCAnYWRkcmVzcycpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19wbGFjZV9fbGluaycpLmhyZWYgPSBzZWxmLmV4cGFuZChbaXRlbS5wbGFjZV0sIHt0aXRsZTogJ3BsYWNlcycsIGRhdGE6IHJlc3BvbnNlLnBsYWNlc30sICdsaW5rJyk7XG5cbiAgICAgICAgICAgICAgICBjb250ZW50TGlzdC5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgICAgIHNlbGYuY29udGVudC5hcHBlbmRDaGlsZChjb250ZW50TGlzdCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEltcG9ydCBwcm9wZXJ0aWVzIGZyb20gTWFpbiBjbGFzc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5ib2R5ID0gYXBwLm1vZHVsZXMubWFpbi5ib2R5O1xuICAgICAgICAgICAgc2VsZi5nZXRTY2hlZHVsZSA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5nZXRTY2hlZHVsZTtcbiAgICAgICAgICAgIHNlbGYuZ2V0U2Nob29sID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmdldFNjaG9vbDtcbiAgICAgICAgICAgIHNlbGYuZ2V0QXV0aG9yID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmdldEF1dGhvcjtcbiAgICAgICAgICAgIHNlbGYuZXhwYW5kID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmV4cGFuZDtcbiAgICAgICAgICAgIHNlbGYuZ2V0VmFsdWUgPSBhcHAubW9kdWxlcy5mb3JtU2VsZWN0TXVsdGlwbGUuZ2V0VmFsdWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cygpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBTY2hvb2xGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwQXV0aG9yRmlsdGVyKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5nZXREYXRhKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5zY2hlZHVsZSA9IG5ldyBTY2hlZHVsZSgpO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ2Zvcm1TZWxlY3RNdWx0aXBsZScgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgRm9ybVNlbGVjdE11bHRpcGxlIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBGb3JtU2VsZWN0TXVsdGlwbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmJvZHkgPSAnJztcbiAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlJyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNlbGYuaGFuZGxlQ2hhbmdlKTtcbiAgICAgICAgICAgIHNlbGYuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYuaGFuZGxlQ2xpY2spO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgY2hhbmdlIGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmhhbmRsZUNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0JykpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0YXJnZXQuY2xvc2VzdCgnLmZvcm1TZWxlY3RNdWx0aXBsZScpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3QgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0JyksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkVmFsdWUgPSBzZWxlY3QudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0ID0gY29udGFpbmVyLmRhdGFzZXQubGlzdCA/IEpTT04ucGFyc2UoY29udGFpbmVyLmRhdGFzZXQubGlzdCkgOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IFtdLnNsaWNlLmNhbGwoc2VsZWN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ29wdGlvbicpKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IFtdLFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gW107XG5cbiAgICAgICAgICAgICAgICBpZiAoIWNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9zdGF0ZV9pbml0ZWQnKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIFtdLnNsaWNlLmNhbGwoc2VsZWN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ29wdGlvbicpKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdGV4dCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QgPSBKU09OLnN0cmluZ2lmeShpbml0aWFsTGlzdCk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9zdGF0ZV9pbml0ZWQnKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHRleHQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0TGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IHNlbGVjdExpc3QuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgIT09IHNlbGVjdGVkVmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RMaXN0LmZvckVhY2goZnVuY3Rpb24oc2VsZWN0SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGluaXRpYWxJdGVtLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxJdGVtLnZhbHVlID09PSBzZWxlY3RJdGVtLnZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IGluaXRpYWxMaXN0O1xuXG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoY29udGFpbmVyLCBzZWxlY3RMaXN0LCByZXN1bHRMaXN0KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgY2xpY2sgZXZlbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmhhbmRsZUNsaWNrID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdmb3JtU2VsZWN0TXVsdGlwbGVfX2xpbmsnKSkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0YXJnZXQuY2xvc2VzdCgnLmZvcm1TZWxlY3RNdWx0aXBsZScpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdCA9IGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QgPyBKU09OLnBhcnNlKGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QpIDogW10sXG4gICAgICAgICAgICAgICAgICAgIGxpbmtzID0gW10uc2xpY2UuY2FsbChjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYScpKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IFtdLFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gW107XG5cbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gbGlua3MubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBpdGVtLmlubmVySFRNTDtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgIT09IHNlbGVjdGVkVmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0LmZvckVhY2goZnVuY3Rpb24ocmVzdWx0SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGluaXRpYWxJdGVtLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxJdGVtLnZhbHVlID09PSByZXN1bHRJdGVtLnZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IGluaXRpYWxMaXN0O1xuXG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoY29udGFpbmVyLCBzZWxlY3RMaXN0LCByZXN1bHRMaXN0KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXR1cm4gY29udGFpbmVyIHNlbGVjdGVkIHZhbHVlXG4gICAgICAgICAqIEBwYXJhbSBjb250YWluZXJcbiAgICAgICAgICogQHJldHVybnMge0FycmF5fVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5nZXRWYWx1ZSA9IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgdmFyIHJlc3VsdExpc3QgPSBbXTtcblxuICAgICAgICAgICAgaWYgKGNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgdmFyIGxpbmtzID0gW10uc2xpY2UuY2FsbChjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYScpKTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBsaW5rcy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0TGlzdDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIGRhdGEgZm9yIGNvbnRhaW5lclxuICAgICAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGNvbnRhaW5lclxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBzZWxlY3REYXRhXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHJlc3VsdERhdGFcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVuZGVyID0gZnVuY3Rpb24oY29udGFpbmVyLCBzZWxlY3REYXRhLCByZXN1bHREYXRhKSB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0Q29udGFpbmVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdCcpLFxuICAgICAgICAgICAgICAgIHJlc3VsdENvbnRhaW5lciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19saXN0JyksXG4gICAgICAgICAgICAgICAgc2VsZWN0SHRtbCA9ICc8b3B0aW9uIHZhbHVlPVwiXCI+PC9vcHRpb24+JyxcbiAgICAgICAgICAgICAgICByZXN1bHRIdG1sID0gJyc7XG5cbiAgICAgICAgICAgIGlmIChzZWxlY3REYXRhLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgIHNlbGVjdERhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdEh0bWwgKz0gJzxvcHRpb24gdmFsdWU9XCInKyBpdGVtLnZhbHVlICsnXCI+JysgaXRlbS50ZXh0ICsnPC9vcHRpb24+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzdWx0RGF0YS5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICByZXN1bHREYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRIdG1sICs9ICc8bGkgY2xhc3M9XCJmb3JtU2VsZWN0TXVsdGlwbGVfX2l0ZW1cIj48YSBocmVmPVwiJysgaXRlbS52YWx1ZSArJ1wiIGNsYXNzPVwiZm9ybVNlbGVjdE11bHRpcGxlX19saW5rXCI+JysgaXRlbS50ZXh0ICsnPC9hPjwvbGk+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2VsZWN0Q29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RDb250YWluZXIuaW5uZXJIVE1MID0gc2VsZWN0SHRtbDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzdWx0Q29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MID0gcmVzdWx0SHRtbDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb250YWluZXIuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ3JlbmRlcicpKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW1wb3J0IHByb3BlcnRpZXMgZnJvbSBNYWluIGNsYXNzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkgPSBhcHAubW9kdWxlcy5tYWluLmJvZHk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cygpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiBhcHApKSB7XG4gICAgICAgIGFwcC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgYXBwLm1vZHVsZXMuZm9ybVNlbGVjdE11bHRpcGxlID0gbmV3IEZvcm1TZWxlY3RNdWx0aXBsZSgpO1xufSkoKTtcbiJdfQ==

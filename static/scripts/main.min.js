var initApp=function(){if(!("modules"in app&&"main"in app.modules)){var e=function(){var e=this;e.html=document.querySelector("html"),e.body=document.querySelector("body"),e.modules=app.modules,e.library=new Library,e.initLibrary=function(){e.library.init()},e.initModules=function(){for(var t in e.modules)e.modules.hasOwnProperty(t)&&"undefined"!=typeof e.modules[t].init&&"main"!==t&&"library"!==t&&e.modules[t].init()},e.init=function(){e.initLibrary(),e.initModules()}};"modules"in app||(app.modules={}),app.modules.main=new e,app.modules.main.init()}};window.addEventListener("load",initApp),function(){if(!("modules"in app&&"formSelectMultiple"in app.modules)){var e=function(){var e=this;e.body="",e.container=document.querySelector(".formSelectMultiple"),e.setupListener=function(){e.body.addEventListener("change",e.handleChange),e.body.addEventListener("click",e.handleClick)},e.handleChange=function(){var t=event.target;if(t.classList.contains("formSelectMultiple__select")){var l=t.closest(".formSelectMultiple"),n=l.querySelector(".formSelectMultiple__select"),o=n.value,a=l.dataset.list?JSON.parse(l.dataset.list):[],r=[].slice.call(n.querySelectorAll("option")),i=[],u=[];l.classList.contains("formSelectMultiple_state_inited")||([].slice.call(n.querySelectorAll("option")).forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&a.push({value:t,text:l})}),l.dataset.list=JSON.stringify(a),l.classList.add("formSelectMultiple_state_inited")),r.forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&i.push({value:t,text:l})}),i=i.filter(function(e){return e.value!==o}),i.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),u=a,e.render(l,i,u)}},e.handleClick=function(t){var l=t.target;if(l.classList.contains("formSelectMultiple__link")){t.preventDefault();var n=l.closest(".formSelectMultiple"),o=l.getAttribute("href"),a=n.dataset.list?JSON.parse(n.dataset.list):[],r=[].slice.call(n.querySelectorAll("a")),i=[],u=[];u=r.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}}).filter(function(e){return e.value!==o}),u.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),i=a,e.render(n,i,u)}},e.getValue=function(e){var t=[];if(e){var l=[].slice.call(e.querySelectorAll("a"));t=l.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}})}return t},e.render=function(e,t,l){var n=e.querySelector(".formSelectMultiple__select"),o=e.querySelector(".formSelectMultiple__list"),a='<option value=""></option>',r="";t.length>0&&t.forEach(function(e){a+='<option value="'+e.value+'">'+e.text+"</option>"}),l.length>0&&l.forEach(function(e){r+='<li class="formSelectMultiple__item"><a href="'+e.value+'" class="formSelectMultiple__link">'+e.text+"</a></li>"}),n&&(n.innerHTML=a),o&&(o.innerHTML=r),e.dispatchEvent(new Event("render"))},e.importDefaults=function(){e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.formSelectMultiple=new e}}(),function(){if(!("modules"in app&&"modal"in app.modules)){var e=function(){var e=this;e.html="",e.body="",e.container=document.querySelector(".modal"),e.openButton=document.querySelector(".modal_trigger"),e.closeButton=document.querySelector(".modal_close"),e.setupListener=function(){e.body.addEventListener("click",e.router)},e.router=function(t){var l=t.target;l.classList.contains("modal_trigger")?(t.preventDefault(),e.open(t.target)):l.classList.contains("modal_close")&&(t.preventDefault(),e.close(t.target))},e.open=function(t){var l=t.getAttribute("href"),n=document.querySelector(l),o=t.dataset.photo,a=t.dataset.title,r=t.dataset.description;n.querySelector(".authorInfo__preview img").src=o,n.querySelector(".authorInfo__title").innerHTML=a,n.querySelector(".authorInfo__text p").innerHTML=r,e.html.classList.add("modal_state_open"),n.classList.add("modal_state_open")},e.close=function(t){var l=t.closest(".modal");l.classList.remove("modal_state_open"),e.html.classList.remove("modal_state_open")},e.importDefaults=function(){e.html=app.modules.main.html,e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.modal=new e}}(),function(){if(!("modules"in app&&"schedule"in app.modules)){var e=function(){var e=this;e.body="",e.getSchedule="",e.getPlace="",e.getSchool="",e.getAuthor="",e.expand="",e.getValue="",e.container=document.querySelector(".schedule"),e.resultNumber=document.querySelector(".schedule__arrow__text span"),e.content=document.querySelector(".scheduleList__content"),e.trigger=document.querySelectorAll(".schedule__trigger"),e.schoolSelect=document.querySelector('.formSelectMultiple__select[name="school"]'),e.authorSelect=document.querySelector('.formSelectMultiple__select[name="author"]'),e.dateFromInput=document.querySelector('.formInput__input[name="from"]'),e.dateToInput=document.querySelector('.formInput__input[name="to"]'),e.schoolSelectMultiple=document.querySelector(".formSelectMultiple.formSelectMultiple_type_school"),e.authorSelectMultiple=document.querySelector(".formSelectMultiple.formSelectMultiple_type_author"),e.selectMultiple=document.querySelectorAll(".formSelectMultiple"),e.template=document.querySelector("#scheduleItem-template").innerHTML,e.monthNames=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],e.dataList="",e.setupListener=function(){e.dateFromInput.addEventListener("change",e.getData),e.dateToInput.addEventListener("change",e.getData),e.selectMultiple.forEach(function(t){t.addEventListener("render",e.getData)}),e.trigger.forEach(function(t){t.addEventListener("click",e.showFilter)})},e.showFilter=function(t){t.preventDefault(),e.container.classList.contains("schedule_state_filter")?e.container.classList.remove("schedule_state_filter"):e.container.classList.add("schedule_state_filter")},e.setupSchoolFilter=function(){e.getSchool().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.schoolSelect.innerHTML=l})},e.setupAuthorFilter=function(){e.getAuthor().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.authorSelect.innerHTML=l})},e.getData=function(){var t=e.dateFromInput.value.replace(/-/g,"/"),l=e.dateToInput.value.replace(/-/g,"/"),n=e.getValue(e.schoolSelectMultiple),o=e.getValue(e.authorSelectMultiple);e.getSchedule(t,l,"").then(function(t){n.length>0&&(t.lectures=t.lectures.filter(function(e){var t=!1;return n.forEach(function(l){e.school.indexOf(parseInt(l.value))!==-1&&(t=!0)}),t})),o.length>0&&(t.lectures=t.lectures.filter(function(e){var t=!1;return o.forEach(function(l){e.author.indexOf(parseInt(l.value))!==-1&&(t=!0)}),t})),e.render(t)})},e.render=function(t){var l=document.createElement("ul");if(l.classList.add("scheduleList__list"),t.lectures.forEach(function(n){var o=document.createElement("li");o.classList.add("scheduleList__item"),o.innerHTML=e.template;var a=new Date(n.date),r=a.getDate(),i=e.monthNames[a.getMonth()],u=[],c=[];n.school.forEach(function(l){var n=e.expand([l],{title:"schools",data:t.schools},"title"),o=e.expand([l],{title:"schools",data:t.schools},"id");u.push('<span class="scheduleItem__school__item scheduleItem__school__item_'+o+'">'+n+"</span>")}),n.author.forEach(function(l){var n=e.expand([l],{title:"authors",data:t.authors},"title"),o=e.expand([l],{title:"authors",data:t.authors},"photo"),a=e.expand([l],{title:"authors",data:t.authors},"description");c.push('<a class="scheduleItem__author__link modal_trigger" href="#author-modal" title="Посмотреть дополнительную информацию" data-photo="'+o+'" data-title="'+n+'" data-description="'+a+'">'+n+"</a>")}),n.isOver&&o.querySelector(".scheduleItem").classList.add("scheduleItem_state_inactive"),o.querySelector(".scheduleItem__day").innerHTML=r,o.querySelector(".scheduleItem__month").innerHTML=i,o.querySelector(".scheduleItem__time").innerHTML=n.time,o.querySelector(".scheduleItem__title").innerHTML=n.title,o.querySelector(".scheduleItem__school").innerHTML=u.join(""),o.querySelector(".scheduleItem__author").innerHTML+=c.join(", "),o.querySelector(".scheduleItem__audience").innerHTML+=e.expand([n.place],{title:"places",data:t.places},"title"),o.querySelector(".scheduleItem__place__link").innerHTML=e.expand([n.place],{title:"places",data:t.places},"address"),o.querySelector(".scheduleItem__place__link").href=e.expand([n.place],{title:"places",data:t.places},"link"),l.appendChild(o)}),0===t.lectures.length){var n=document.createElement("li");n.classList.add("scheduleList__item"),n.classList.add("scheduleList__item_state_empty"),n.innerHTML="По вашему запросу ничего не найдено.",l.appendChild(n)}e.content.innerHTML="",e.content.appendChild(l),e.resultNumber.innerHTML=t.lectures.length},e.importDefaults=function(){e.body=app.modules.main.body,e.getSchedule=app.modules.main.library.getSchedule,e.getSchool=app.modules.main.library.getSchool,e.getAuthor=app.modules.main.library.getAuthor,e.expand=app.modules.main.library.expand,e.getValue=app.modules.formSelectMultiple.getValue},e.init=function(){e.container&&(e.importDefaults(),e.setupSchoolFilter(),e.setupAuthorFilter(),e.getData(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.schedule=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vbWFpbi5qcyIsImZvcm1TZWxlY3RNdWx0aXBsZS9mb3JtU2VsZWN0TXVsdGlwbGUuanMiLCJtb2RhbC9tb2RhbC5qcyIsInNjaGVkdWxlL3NjaGVkdWxlLmpzIl0sIm5hbWVzIjpbImluaXRBcHAiLCJhcHAiLCJtb2R1bGVzIiwiTWFpbiIsInNlbGYiLCJ0aGlzIiwiaHRtbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJvZHkiLCJsaWJyYXJ5IiwiTGlicmFyeSIsImluaXRMaWJyYXJ5IiwiaW5pdCIsImluaXRNb2R1bGVzIiwibW9kdWxlIiwiaGFzT3duUHJvcGVydHkiLCJtYWluIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsIkZvcm1TZWxlY3RNdWx0aXBsZSIsImNvbnRhaW5lciIsInNldHVwTGlzdGVuZXIiLCJoYW5kbGVDaGFuZ2UiLCJoYW5kbGVDbGljayIsInRhcmdldCIsImV2ZW50IiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJjbG9zZXN0Iiwic2VsZWN0Iiwic2VsZWN0ZWRWYWx1ZSIsInZhbHVlIiwiaW5pdGlhbExpc3QiLCJkYXRhc2V0IiwibGlzdCIsIkpTT04iLCJwYXJzZSIsIm9wdGlvbnMiLCJzbGljZSIsImNhbGwiLCJxdWVyeVNlbGVjdG9yQWxsIiwic2VsZWN0TGlzdCIsInJlc3VsdExpc3QiLCJmb3JFYWNoIiwiaXRlbSIsInRleHQiLCJpbm5lckhUTUwiLCJwdXNoIiwic3RyaW5naWZ5IiwiYWRkIiwiZmlsdGVyIiwic2VsZWN0SXRlbSIsImluaXRpYWxJdGVtIiwiaW5kZXgiLCJzcGxpY2UiLCJyZW5kZXIiLCJwcmV2ZW50RGVmYXVsdCIsImdldEF0dHJpYnV0ZSIsImxpbmtzIiwibWFwIiwicmVzdWx0SXRlbSIsImdldFZhbHVlIiwic2VsZWN0RGF0YSIsInJlc3VsdERhdGEiLCJzZWxlY3RDb250YWluZXIiLCJyZXN1bHRDb250YWluZXIiLCJzZWxlY3RIdG1sIiwicmVzdWx0SHRtbCIsImxlbmd0aCIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCIsImltcG9ydERlZmF1bHRzIiwiZm9ybVNlbGVjdE11bHRpcGxlIiwiTW9kYWwiLCJvcGVuQnV0dG9uIiwiY2xvc2VCdXR0b24iLCJyb3V0ZXIiLCJvcGVuIiwiY2xvc2UiLCJzcmMiLCJwaG90byIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJyZW1vdmUiLCJtb2RhbCIsIlNjaGVkdWxlIiwiZ2V0U2NoZWR1bGUiLCJnZXRQbGFjZSIsImdldFNjaG9vbCIsImdldEF1dGhvciIsImV4cGFuZCIsInJlc3VsdE51bWJlciIsImNvbnRlbnQiLCJ0cmlnZ2VyIiwic2Nob29sU2VsZWN0IiwiYXV0aG9yU2VsZWN0IiwiZGF0ZUZyb21JbnB1dCIsImRhdGVUb0lucHV0Iiwic2Nob29sU2VsZWN0TXVsdGlwbGUiLCJhdXRob3JTZWxlY3RNdWx0aXBsZSIsInNlbGVjdE11bHRpcGxlIiwidGVtcGxhdGUiLCJtb250aE5hbWVzIiwiZGF0YUxpc3QiLCJnZXREYXRhIiwic2hvd0ZpbHRlciIsInNldHVwU2Nob29sRmlsdGVyIiwidGhlbiIsInJlc3BvbnNlIiwiaWQiLCJzZXR1cEF1dGhvckZpbHRlciIsImRhdGVGcm9tIiwicmVwbGFjZSIsImRhdGVUbyIsInNjaG9vbCIsImF1dGhvciIsImxlY3R1cmVzIiwicmVzdWx0Iiwic2Nob29sSXRlbSIsImluZGV4T2YiLCJwYXJzZUludCIsImF1dGhvckl0ZW0iLCJjb250ZW50TGlzdCIsImNyZWF0ZUVsZW1lbnQiLCJlbGVtZW50IiwiZGF0ZSIsIkRhdGUiLCJkYXkiLCJnZXREYXRlIiwibW9udGgiLCJnZXRNb250aCIsIml0ZW1UaXRsZSIsImRhdGEiLCJzY2hvb2xzIiwiaXRlbUlkIiwiYXV0aG9ycyIsIml0ZW1QaG90byIsIml0ZW1EZXNjcmlwdGlvbiIsImlzT3ZlciIsInRpbWUiLCJqb2luIiwicGxhY2UiLCJwbGFjZXMiLCJocmVmIiwiYXBwZW5kQ2hpbGQiLCJzY2hlZHVsZSJdLCJtYXBwaW5ncyI6IkFBQUEsR0FB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QUFrQyxRQUFBLFdBRUFsQixFQUFBckgsY0FBQSw4QkFBQXdJLEtBQUE1SSxFQUFBdUYsUUFBQTlDLEVBQUFpRyxRQUFBNUQsTUFBQSxTQUFBbUQsS0FBQXhCLEVBQUFrQyxRQUFBLFFBRUFwQixFQUFBc0IsWUFBQXBCLEtBR0EsSUFBQWhCLEVBQUFRLFNBQUFoRCxPQUFBLENBRUEsR0FBQXdELEdBQUF0SCxTQUFBcUgsY0FBQSxLQUVBQyxHQUFBbEcsVUFBQXVCLElBQUEsc0JBRUEyRSxFQUFBbEcsVUFBQXVCLElBQUEsa0NBRUEyRSxFQUFBOUUsVUFBQSx1Q0FFQTRFLEVBQUFzQixZQUFBcEIsR0FHQXpILEVBQUF5RixRQUFBOUMsVUFBQSxHQUVBM0MsRUFBQXlGLFFBQUFvRCxZQUFBdEIsR0FFQXZILEVBQUF3RixhQUFBN0MsVUFBQThELEVBQUFRLFNBQUFoRCxRQU1BakUsRUFBQW9FLGVBQUEsV0FDQXBFLEVBQUFLLEtBQUFSLElBQUFDLFFBQUFlLEtBQUFSLEtBQ0FMLEVBQUFtRixZQUFBdEYsSUFBQUMsUUFBQWUsS0FBQVAsUUFBQTZFLFlBQ0FuRixFQUFBcUYsVUFBQXhGLElBQUFDLFFBQUFlLEtBQUFQLFFBQUErRSxVQUNBckYsRUFBQXNGLFVBQUF6RixJQUFBQyxRQUFBZSxLQUFBUCxRQUFBZ0YsVUFDQXRGLEVBQUF1RixPQUFBMUYsSUFBQUMsUUFBQWUsS0FBQVAsUUFBQWlGLE9BQ0F2RixFQUFBMEQsU0FBQTdELElBQUFDLFFBQUF1RSxtQkFBQVgsVUFNQTFELEVBQUFTLEtBQUEsV0FDQVQsRUFBQWlCLFlBRUFqQixFQUFBb0UsaUJBQ0FwRSxFQUFBdUcsb0JBQ0F2RyxFQUFBMkcsb0JBQ0EzRyxFQUFBcUcsVUFDQXJHLEVBQUFrQixrQkFNQSxZQUFBckIsT0FDQUEsSUFBQUMsWUFHQUQsSUFBQUMsUUFBQWdKLFNBQUEsR0FBQTVEIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGluaXRBcHAgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnbWFpbicgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgTWFpbiBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgTWFpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5odG1sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaHRtbCcpO1xuICAgICAgICBzZWxmLmJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG4gICAgICAgIHNlbGYubW9kdWxlcyA9IGFwcC5tb2R1bGVzO1xuICAgICAgICBzZWxmLmxpYnJhcnkgPSBuZXcgTGlicmFyeSgpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IGxpYnJhcnkgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRMaWJyYXJ5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmxpYnJhcnkuaW5pdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IGFsbCBtb2R1bGVzIGluICQubW9kdWxlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0TW9kdWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZm9yICh2YXIgbW9kdWxlIGluIHNlbGYubW9kdWxlcykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNlbGYubW9kdWxlcy5oYXNPd25Qcm9wZXJ0eShtb2R1bGUpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxmLm1vZHVsZXNbbW9kdWxlXS5pbml0ICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09ICdtYWluJyAmJiBtb2R1bGUgIT09ICdsaWJyYXJ5Jykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm1vZHVsZXNbbW9kdWxlXS5pbml0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuaW5pdExpYnJhcnkoKTtcbiAgICAgICAgICAgIHNlbGYuaW5pdE1vZHVsZXMoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5tYWluID0gbmV3IE1haW4oKTtcblxuICAgIGFwcC5tb2R1bGVzLm1haW4uaW5pdCgpO1xufTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBpbml0QXBwKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ2Zvcm1TZWxlY3RNdWx0aXBsZScgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgRm9ybVNlbGVjdE11bHRpcGxlIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBGb3JtU2VsZWN0TXVsdGlwbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmJvZHkgPSAnJztcbiAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlJyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNlbGYuaGFuZGxlQ2hhbmdlKTtcbiAgICAgICAgICAgIHNlbGYuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYuaGFuZGxlQ2xpY2spO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgY2hhbmdlIGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmhhbmRsZUNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0JykpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0YXJnZXQuY2xvc2VzdCgnLmZvcm1TZWxlY3RNdWx0aXBsZScpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3QgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0JyksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkVmFsdWUgPSBzZWxlY3QudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0ID0gY29udGFpbmVyLmRhdGFzZXQubGlzdCA/IEpTT04ucGFyc2UoY29udGFpbmVyLmRhdGFzZXQubGlzdCkgOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IFtdLnNsaWNlLmNhbGwoc2VsZWN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ29wdGlvbicpKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IFtdLFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gW107XG5cbiAgICAgICAgICAgICAgICBpZiAoIWNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9zdGF0ZV9pbml0ZWQnKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIFtdLnNsaWNlLmNhbGwoc2VsZWN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ29wdGlvbicpKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdGV4dCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QgPSBKU09OLnN0cmluZ2lmeShpbml0aWFsTGlzdCk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9zdGF0ZV9pbml0ZWQnKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHRleHQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0TGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IHNlbGVjdExpc3QuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgIT09IHNlbGVjdGVkVmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RMaXN0LmZvckVhY2goZnVuY3Rpb24oc2VsZWN0SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGluaXRpYWxJdGVtLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxJdGVtLnZhbHVlID09PSBzZWxlY3RJdGVtLnZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IGluaXRpYWxMaXN0O1xuXG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoY29udGFpbmVyLCBzZWxlY3RMaXN0LCByZXN1bHRMaXN0KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgY2xpY2sgZXZlbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmhhbmRsZUNsaWNrID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdmb3JtU2VsZWN0TXVsdGlwbGVfX2xpbmsnKSkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0YXJnZXQuY2xvc2VzdCgnLmZvcm1TZWxlY3RNdWx0aXBsZScpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdCA9IGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QgPyBKU09OLnBhcnNlKGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QpIDogW10sXG4gICAgICAgICAgICAgICAgICAgIGxpbmtzID0gW10uc2xpY2UuY2FsbChjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYScpKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IFtdLFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gW107XG5cbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gbGlua3MubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBpdGVtLmlubmVySFRNTDtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgIT09IHNlbGVjdGVkVmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0LmZvckVhY2goZnVuY3Rpb24ocmVzdWx0SXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGluaXRpYWxJdGVtLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxJdGVtLnZhbHVlID09PSByZXN1bHRJdGVtLnZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0TGlzdCA9IGluaXRpYWxMaXN0O1xuXG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoY29udGFpbmVyLCBzZWxlY3RMaXN0LCByZXN1bHRMaXN0KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXR1cm4gY29udGFpbmVyIHNlbGVjdGVkIHZhbHVlXG4gICAgICAgICAqIEBwYXJhbSBjb250YWluZXJcbiAgICAgICAgICogQHJldHVybnMge0FycmF5fVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5nZXRWYWx1ZSA9IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgdmFyIHJlc3VsdExpc3QgPSBbXTtcblxuICAgICAgICAgICAgaWYgKGNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgdmFyIGxpbmtzID0gW10uc2xpY2UuY2FsbChjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYScpKTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBsaW5rcy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0TGlzdDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIGRhdGEgZm9yIGNvbnRhaW5lclxuICAgICAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGNvbnRhaW5lclxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBzZWxlY3REYXRhXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHJlc3VsdERhdGFcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVuZGVyID0gZnVuY3Rpb24oY29udGFpbmVyLCBzZWxlY3REYXRhLCByZXN1bHREYXRhKSB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0Q29udGFpbmVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdCcpLFxuICAgICAgICAgICAgICAgIHJlc3VsdENvbnRhaW5lciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19saXN0JyksXG4gICAgICAgICAgICAgICAgc2VsZWN0SHRtbCA9ICc8b3B0aW9uIHZhbHVlPVwiXCI+PC9vcHRpb24+JyxcbiAgICAgICAgICAgICAgICByZXN1bHRIdG1sID0gJyc7XG5cbiAgICAgICAgICAgIGlmIChzZWxlY3REYXRhLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgIHNlbGVjdERhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdEh0bWwgKz0gJzxvcHRpb24gdmFsdWU9XCInKyBpdGVtLnZhbHVlICsnXCI+JysgaXRlbS50ZXh0ICsnPC9vcHRpb24+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzdWx0RGF0YS5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICByZXN1bHREYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRIdG1sICs9ICc8bGkgY2xhc3M9XCJmb3JtU2VsZWN0TXVsdGlwbGVfX2l0ZW1cIj48YSBocmVmPVwiJysgaXRlbS52YWx1ZSArJ1wiIGNsYXNzPVwiZm9ybVNlbGVjdE11bHRpcGxlX19saW5rXCI+JysgaXRlbS50ZXh0ICsnPC9hPjwvbGk+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2VsZWN0Q29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RDb250YWluZXIuaW5uZXJIVE1MID0gc2VsZWN0SHRtbDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzdWx0Q29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MID0gcmVzdWx0SHRtbDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb250YWluZXIuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ3JlbmRlcicpKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW1wb3J0IHByb3BlcnRpZXMgZnJvbSBNYWluIGNsYXNzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkgPSBhcHAubW9kdWxlcy5tYWluLmJvZHk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cygpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiBhcHApKSB7XG4gICAgICAgIGFwcC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgYXBwLm1vZHVsZXMuZm9ybVNlbGVjdE11bHRpcGxlID0gbmV3IEZvcm1TZWxlY3RNdWx0aXBsZSgpO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ21vZGFsJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNb2RhbCBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgTW9kYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmh0bWwgPSAnJztcbiAgICAgICAgc2VsZi5ib2R5ID0gJyc7XG4gICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsJyk7XG4gICAgICAgIHNlbGYub3BlbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF90cmlnZ2VyJyk7XG4gICAgICAgIHNlbGYuY2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfY2xvc2UnKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLnJvdXRlcik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJvdXRlIGNsaWNrIGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yb3V0ZXIgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX3RyaWdnZXInKSkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHNlbGYub3BlbihldmVudC50YXJnZXQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX2Nsb3NlJykpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmNsb3NlKGV2ZW50LnRhcmdldCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLm9wZW4gPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgICAgIHZhciBzcmMgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzcmMpLFxuICAgICAgICAgICAgICAgIHBob3RvID0gdGFyZ2V0LmRhdGFzZXQucGhvdG8sXG4gICAgICAgICAgICAgICAgdGl0bGUgPSB0YXJnZXQuZGF0YXNldC50aXRsZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHRhcmdldC5kYXRhc2V0LmRlc2NyaXB0aW9uO1xuXG4gICAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmF1dGhvckluZm9fX3ByZXZpZXcgaW1nJykuc3JjID0gcGhvdG87XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYXV0aG9ySW5mb19fdGl0bGUnKS5pbm5lckhUTUwgPSB0aXRsZTtcblxuICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5hdXRob3JJbmZvX190ZXh0IHAnKS5pbm5lckhUTUwgPSBkZXNjcmlwdGlvbjtcblxuICAgICAgICAgICAgc2VsZi5odG1sLmNsYXNzTGlzdC5hZGQoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5jbG9zZSA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRhcmdldC5jbG9zZXN0KCcubW9kYWwnKTtcblxuICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgICAgIHNlbGYuaHRtbC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEltcG9ydCBwcm9wZXJ0aWVzIGZyb20gTWFpbiBjbGFzc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5odG1sID0gYXBwLm1vZHVsZXMubWFpbi5odG1sO1xuICAgICAgICAgICAgc2VsZi5ib2R5ID0gYXBwLm1vZHVsZXMubWFpbi5ib2R5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5jb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLm1vZGFsID0gbmV3IE1vZGFsKCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gYXBwICYmICdzY2hlZHVsZScgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgU2NoZWR1bGUgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIFNjaGVkdWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5ib2R5ID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0U2NoZWR1bGUgPSAnJztcbiAgICAgICAgc2VsZi5nZXRQbGFjZSA9ICcnO1xuICAgICAgICBzZWxmLmdldFNjaG9vbCA9ICcnO1xuICAgICAgICBzZWxmLmdldEF1dGhvciA9ICcnO1xuICAgICAgICBzZWxmLmV4cGFuZCA9ICcnO1xuICAgICAgICBzZWxmLmdldFZhbHVlID0gJyc7XG4gICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlJyk7XG4gICAgICAgIHNlbGYucmVzdWx0TnVtYmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlX19hcnJvd19fdGV4dCBzcGFuJyk7XG4gICAgICAgIHNlbGYuY29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUxpc3RfX2NvbnRlbnQnKTtcbiAgICAgICAgc2VsZi50cmlnZ2VyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNjaGVkdWxlX190cmlnZ2VyJyk7XG4gICAgICAgIHNlbGYuc2Nob29sU2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0W25hbWU9XCJzY2hvb2xcIl0nKTtcbiAgICAgICAgc2VsZi5hdXRob3JTZWxlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3RbbmFtZT1cImF1dGhvclwiXScpO1xuICAgICAgICBzZWxmLmRhdGVGcm9tSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybUlucHV0X19pbnB1dFtuYW1lPVwiZnJvbVwiXScpO1xuICAgICAgICBzZWxmLmRhdGVUb0lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1JbnB1dF9faW5wdXRbbmFtZT1cInRvXCJdJyk7XG4gICAgICAgIHNlbGYuc2Nob29sU2VsZWN0TXVsdGlwbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlLmZvcm1TZWxlY3RNdWx0aXBsZV90eXBlX3NjaG9vbCcpO1xuICAgICAgICBzZWxmLmF1dGhvclNlbGVjdE11bHRpcGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZS5mb3JtU2VsZWN0TXVsdGlwbGVfdHlwZV9hdXRob3InKTtcbiAgICAgICAgc2VsZi5zZWxlY3RNdWx0aXBsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKTtcbiAgICAgICAgc2VsZi50ZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzY2hlZHVsZUl0ZW0tdGVtcGxhdGUnKS5pbm5lckhUTUw7XG4gICAgICAgIHNlbGYubW9udGhOYW1lcyA9IFtcbiAgICAgICAgICAgICfRj9C90LLQsNGA0YwnLFxuICAgICAgICAgICAgJ9GE0LXQstGA0LDQu9GMJyxcbiAgICAgICAgICAgICfQvNCw0YDRgicsXG4gICAgICAgICAgICAn0LDQv9GA0LXQu9GMJyxcbiAgICAgICAgICAgICfQvNCw0LknLFxuICAgICAgICAgICAgJ9C40Y7QvdGMJyxcbiAgICAgICAgICAgICfQuNGO0LvRjCcsXG4gICAgICAgICAgICAn0LDQstCz0YPRgdGCJyxcbiAgICAgICAgICAgICfRgdC10L3RgtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQvtC60YLRj9Cx0YDRjCcsXG4gICAgICAgICAgICAn0L3QvtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQtNC10LrQsNCx0YDRjCdcbiAgICAgICAgXTtcbiAgICAgICAgc2VsZi5kYXRhTGlzdCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuZGF0ZUZyb21JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICAgICAgc2VsZi5kYXRlVG9JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICAgICAgc2VsZi5zZWxlY3RNdWx0aXBsZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ3JlbmRlcicsIHNlbGYuZ2V0RGF0YSl9KTtcbiAgICAgICAgICAgIHNlbGYudHJpZ2dlci5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5zaG93RmlsdGVyKX0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93IGZpbHRlciBjb250YWluZXJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNob3dGaWx0ZXIgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgaWYgKHNlbGYuY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnc2NoZWR1bGVfc3RhdGVfZmlsdGVyJykpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ3NjaGVkdWxlX3N0YXRlX2ZpbHRlcicpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc2NoZWR1bGVfc3RhdGVfZmlsdGVyJyk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0dXAgc2Nob29sIGZpbHRlciB2YWx1ZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBTY2hvb2xGaWx0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuZ2V0U2Nob29sKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBodG1sID0gJzxvcHRpb24gdmFsdWU9XCJcIj48L29wdGlvbj4nO1xuXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxvcHRpb24gdmFsdWU9XCInKyBpdGVtLmlkICsnXCI+JysgaXRlbS50aXRsZSArJzwvb3B0aW9uPic7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnNjaG9vbFNlbGVjdC5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHVwIGF1dGhvciBmaWx0ZXIgdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwQXV0aG9yRmlsdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmdldEF1dGhvcigpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgaHRtbCA9ICc8b3B0aW9uIHZhbHVlPVwiXCI+PC9vcHRpb24+JztcblxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8b3B0aW9uIHZhbHVlPVwiJysgaXRlbS5pZCArJ1wiPicrIGl0ZW0udGl0bGUgKyc8L29wdGlvbj4nO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZi5hdXRob3JTZWxlY3QuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgZGF0YSBmcm9tIGxpYnJhcnkgYWNjb3JkaW5nIHRvIGZpbHRlciB2YWx1ZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ2V0RGF0YSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGRhdGVGcm9tID0gc2VsZi5kYXRlRnJvbUlucHV0LnZhbHVlLnJlcGxhY2UoLy0vZywgJy8nKSxcbiAgICAgICAgICAgICAgICBkYXRlVG8gPSBzZWxmLmRhdGVUb0lucHV0LnZhbHVlLnJlcGxhY2UoLy0vZywgJy8nKSxcbiAgICAgICAgICAgICAgICBzY2hvb2wgPSBzZWxmLmdldFZhbHVlKHNlbGYuc2Nob29sU2VsZWN0TXVsdGlwbGUpLFxuICAgICAgICAgICAgICAgIGF1dGhvciA9IHNlbGYuZ2V0VmFsdWUoc2VsZi5hdXRob3JTZWxlY3RNdWx0aXBsZSk7XG5cbiAgICAgICAgICAgIHNlbGYuZ2V0U2NoZWR1bGUoZGF0ZUZyb20sIGRhdGVUbywgJycpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2Nob29sLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5sZWN0dXJlcyA9IHJlc3BvbnNlLmxlY3R1cmVzLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjaG9vbC5mb3JFYWNoKGZ1bmN0aW9uKHNjaG9vbEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zY2hvb2wuaW5kZXhPZihwYXJzZUludChzY2hvb2xJdGVtLnZhbHVlKSkgIT09IC0xKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChhdXRob3IubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmxlY3R1cmVzID0gcmVzcG9uc2UubGVjdHVyZXMuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aG9yLmZvckVhY2goZnVuY3Rpb24oYXV0aG9ySXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmF1dGhvci5pbmRleE9mKHBhcnNlSW50KGF1dGhvckl0ZW0udmFsdWUpKSAhPT0gLTEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIocmVzcG9uc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbmRlciBzY2hlZHVsZSBsaXN0XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yZW5kZXIgPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGNvbnRlbnRMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTtcblxuICAgICAgICAgICAgY29udGVudExpc3QuY2xhc3NMaXN0LmFkZCgnc2NoZWR1bGVMaXN0X19saXN0Jyk7XG5cbiAgICAgICAgICAgIHJlc3BvbnNlLmxlY3R1cmVzLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2NoZWR1bGVMaXN0X19pdGVtJyk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBzZWxmLnRlbXBsYXRlO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShpdGVtLmRhdGUpLFxuICAgICAgICAgICAgICAgICAgICBkYXkgPSBkYXRlLmdldERhdGUoKSxcbiAgICAgICAgICAgICAgICAgICAgbW9udGggPSBzZWxmLm1vbnRoTmFtZXNbZGF0ZS5nZXRNb250aCgpXSxcbiAgICAgICAgICAgICAgICAgICAgc2Nob29sID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvciA9IFtdO1xuXG4gICAgICAgICAgICAgICAgaXRlbS5zY2hvb2wuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtVGl0bGUgPSBzZWxmLmV4cGFuZChbaXRlbV0sIHt0aXRsZTogJ3NjaG9vbHMnLCBkYXRhOiByZXNwb25zZS5zY2hvb2xzfSwgJ3RpdGxlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtSWQgPSBzZWxmLmV4cGFuZChbaXRlbV0sIHt0aXRsZTogJ3NjaG9vbHMnLCBkYXRhOiByZXNwb25zZS5zY2hvb2xzfSwgJ2lkJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2Nob29sLnB1c2goJzxzcGFuIGNsYXNzPVwic2NoZWR1bGVJdGVtX19zY2hvb2xfX2l0ZW0gc2NoZWR1bGVJdGVtX19zY2hvb2xfX2l0ZW1fJysgaXRlbUlkICsnXCI+JysgaXRlbVRpdGxlICsnPC9zcGFuPicpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaXRlbS5hdXRob3IuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtVGl0bGUgPSBzZWxmLmV4cGFuZChbaXRlbV0sIHt0aXRsZTogJ2F1dGhvcnMnLCBkYXRhOiByZXNwb25zZS5hdXRob3JzfSwgJ3RpdGxlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtUGhvdG8gPSBzZWxmLmV4cGFuZChbaXRlbV0sIHt0aXRsZTogJ2F1dGhvcnMnLCBkYXRhOiByZXNwb25zZS5hdXRob3JzfSwgJ3Bob3RvJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtRGVzY3JpcHRpb24gPSBzZWxmLmV4cGFuZChbaXRlbV0sIHt0aXRsZTogJ2F1dGhvcnMnLCBkYXRhOiByZXNwb25zZS5hdXRob3JzfSwgJ2Rlc2NyaXB0aW9uJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yLnB1c2goJzxhIGNsYXNzPVwic2NoZWR1bGVJdGVtX19hdXRob3JfX2xpbmsgbW9kYWxfdHJpZ2dlclwiIGhyZWY9XCIjYXV0aG9yLW1vZGFsXCIgdGl0bGU9XCLQn9C+0YHQvNC+0YLRgNC10YLRjCDQtNC+0L/QvtC70L3QuNGC0LXQu9GM0L3Rg9GOINC40L3RhNC+0YDQvNCw0YbQuNGOXCIgZGF0YS1waG90bz1cIicrIGl0ZW1QaG90byArJ1wiIGRhdGEtdGl0bGU9XCInKyBpdGVtVGl0bGUgKydcIiBkYXRhLWRlc2NyaXB0aW9uPVwiJysgaXRlbURlc2NyaXB0aW9uICsnXCI+JysgaXRlbVRpdGxlICsnPC9hPicpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaXNPdmVyKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtJykuY2xhc3NMaXN0LmFkZCgnc2NoZWR1bGVJdGVtX3N0YXRlX2luYWN0aXZlJyk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX2RheScpLmlubmVySFRNTCA9IGRheTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fbW9udGgnKS5pbm5lckhUTUwgPSBtb250aDtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fdGltZScpLmlubmVySFRNTCA9IGl0ZW0udGltZTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fdGl0bGUnKS5pbm5lckhUTUwgPSBpdGVtLnRpdGxlO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19zY2hvb2wnKS5pbm5lckhUTUwgPSBzY2hvb2wuam9pbignJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX2F1dGhvcicpLmlubmVySFRNTCArPSBhdXRob3Iuam9pbignLCAnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fYXVkaWVuY2UnKS5pbm5lckhUTUwgKz0gc2VsZi5leHBhbmQoW2l0ZW0ucGxhY2VdLCB7dGl0bGU6ICdwbGFjZXMnLCBkYXRhOiByZXNwb25zZS5wbGFjZXN9LCAndGl0bGUnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fcGxhY2VfX2xpbmsnKS5pbm5lckhUTUwgPSBzZWxmLmV4cGFuZChbaXRlbS5wbGFjZV0sIHt0aXRsZTogJ3BsYWNlcycsIGRhdGE6IHJlc3BvbnNlLnBsYWNlc30sICdhZGRyZXNzJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3BsYWNlX19saW5rJykuaHJlZiA9IHNlbGYuZXhwYW5kKFtpdGVtLnBsYWNlXSwge3RpdGxlOiAncGxhY2VzJywgZGF0YTogcmVzcG9uc2UucGxhY2VzfSwgJ2xpbmsnKTtcblxuICAgICAgICAgICAgICAgIGNvbnRlbnRMaXN0LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5sZWN0dXJlcy5sZW5ndGggPT09IDApIHtcblxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2NoZWR1bGVMaXN0X19pdGVtJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlTGlzdF9faXRlbV9zdGF0ZV9lbXB0eScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSAn0J/QviDQstCw0YjQtdC80YMg0LfQsNC/0YDQvtGB0YMg0L3QuNGH0LXQs9C+INC90LUg0L3QsNC50LTQtdC90L4uJztcblxuICAgICAgICAgICAgICAgIGNvbnRlbnRMaXN0LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgICAgIHNlbGYuY29udGVudC5hcHBlbmRDaGlsZChjb250ZW50TGlzdCk7XG5cbiAgICAgICAgICAgIHNlbGYucmVzdWx0TnVtYmVyLmlubmVySFRNTCA9IHJlc3BvbnNlLmxlY3R1cmVzLmxlbmd0aDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW1wb3J0IHByb3BlcnRpZXMgZnJvbSBNYWluIGNsYXNzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkgPSBhcHAubW9kdWxlcy5tYWluLmJvZHk7XG4gICAgICAgICAgICBzZWxmLmdldFNjaGVkdWxlID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmdldFNjaGVkdWxlO1xuICAgICAgICAgICAgc2VsZi5nZXRTY2hvb2wgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZ2V0U2Nob29sO1xuICAgICAgICAgICAgc2VsZi5nZXRBdXRob3IgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZ2V0QXV0aG9yO1xuICAgICAgICAgICAgc2VsZi5leHBhbmQgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZXhwYW5kO1xuICAgICAgICAgICAgc2VsZi5nZXRWYWx1ZSA9IGFwcC5tb2R1bGVzLmZvcm1TZWxlY3RNdWx0aXBsZS5nZXRWYWx1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cFNjaG9vbEZpbHRlcigpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBBdXRob3JGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICBzZWxmLmdldERhdGEoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLnNjaGVkdWxlID0gbmV3IFNjaGVkdWxlKCk7XG59KSgpO1xuIl19

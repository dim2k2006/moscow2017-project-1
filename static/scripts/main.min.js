!function(){if(!("modules"in app&&"formSelectMultiple"in app.modules)){var e=function(){var e=this;e.body="",e.container=document.querySelector(".formSelectMultiple"),e.content=document.querySelector(".formSelectMultiple__content"),e.footer=document.querySelector(".formSelectMultiple__footer"),e.setupListener=function(){e.content.addEventListener("change",e.handleChange),e.footer.addEventListener("click",e.handleClick)},e.handleChange=function(){var t=this.closest(".formSelectMultiple"),n=t.querySelector(".formSelectMultiple__select"),l=n.value,o=t.dataset.list?JSON.parse(t.dataset.list):[],a=[].slice.call(n.querySelectorAll("option")),i=[],r=[];t.classList.contains("formSelectMultiple_state_inited")||([].slice.call(n.querySelectorAll("option")).forEach(function(e){var t=e.value,n=e.innerHTML;t&&n&&o.push({value:t,text:n})}),t.dataset.list=JSON.stringify(o),t.classList.add("formSelectMultiple_state_inited")),a.forEach(function(e){var t=e.value,n=e.innerHTML;t&&n&&i.push({value:t,text:n})}),i=i.filter(function(e){return e.value!==l}),i.forEach(function(e){o.forEach(function(t,n){t.value===e.value&&o.splice(n,1)})}),r=o,e.render(t,i,r)},e.handleClick=function(t){t.preventDefault();var n=this.closest(".formSelectMultiple"),l=t.target,o=l.getAttribute("href"),a=n.dataset.list?JSON.parse(n.dataset.list):[],i=[].slice.call(n.querySelectorAll("a")),r=[],u=[];u=i.map(function(e){var t=e.getAttribute("href"),n=e.innerHTML;return{value:t,text:n}}).filter(function(e){return e.value!==o}),u.forEach(function(e){a.forEach(function(t,n){t.value===e.value&&a.splice(n,1)})}),r=a,e.render(n,r,u)},e.render=function(e,t,n){var l=e.querySelector(".formSelectMultiple__select"),o=e.querySelector(".formSelectMultiple__list"),a='<option value=""></option>',i="";t.length>0&&t.forEach(function(e){a+='<option value="'+e.value+'">'+e.text+"</option>"}),n.length>0&&n.forEach(function(e){i+='<li class="formSelectMultiple__item"><a href="'+e.value+'" class="formSelectMultiple__link">'+e.text+"</a></li>"}),l&&(l.innerHTML=a),o&&(o.innerHTML=i)},e.importDefaults=function(){e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.formSelectMultiple=new e}}();var initApp=function(){if(!("modules"in app&&"main"in app.modules)){var e=function(){var e=this;e.html=document.querySelector("html"),e.body=document.querySelector("body"),e.modules=app.modules,e.library=new Library,e.initLibrary=function(){e.library.init()},e.initModules=function(){for(var t in e.modules)e.modules.hasOwnProperty(t)&&"undefined"!=typeof e.modules[t].init&&"main"!==t&&"library"!==t&&e.modules[t].init()},e.init=function(){e.initLibrary(),e.initModules()}};"modules"in app||(app.modules={}),app.modules.main=new e,app.modules.main.init()}};window.addEventListener("load",initApp),function(){if(!("modules"in app&&"modal"in app.modules)){var e=function(){var e=this;e.html="",e.body="",e.container=document.querySelector(".modal"),e.openButton=document.querySelector(".modal_trigger"),e.closeButton=document.querySelector(".modal_close"),e.setupListener=function(){e.body.addEventListener("click",e.router)},e.router=function(t){var n=t.target;n.classList.contains("modal_trigger")?(t.preventDefault(),e.open(t.target)):n.classList.contains("modal_close")&&(t.preventDefault(),e.close(t.target))},e.open=function(t){var n=t.getAttribute("href"),l=document.querySelector(n),o=t.dataset.photo,a=t.dataset.title,i=t.dataset.description;l.querySelector(".authorInfo__preview img").src=o,l.querySelector(".authorInfo__title").innerHTML=a,l.querySelector(".authorInfo__text p").innerHTML=i,e.html.classList.add("modal_state_open"),l.classList.add("modal_state_open")},e.close=function(t){var n=t.closest(".modal");n.classList.remove("modal_state_open"),e.html.classList.remove("modal_state_open")},e.importDefaults=function(){e.html=app.modules.main.html,e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.modal=new e}}(),function(){if(!("modules"in app&&"schedule"in app.modules)){var e=function(){var e=this;e.body="",e.getSchedule="",e.getPlace="",e.getSchool="",e.getAuthor="",e.expand="",e.container=document.querySelector(".schedule"),e.content=document.querySelector(".scheduleList__content"),e.template=document.querySelector("#scheduleItem-template").innerHTML,e.monthNames=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],e.dataList="",e.setupListener=function(){},e.getData=function(){var t="",n="",l="";e.getSchedule(t,n,l).then(function(t){e.render(t)})},e.render=function(t){var n=document.createElement("ul");n.classList.add("scheduleList__list"),t.lectures.forEach(function(l){var o=document.createElement("li");o.classList.add("scheduleList__item"),o.innerHTML=e.template;var a=new Date(l.date),i=a.getDate(),r=e.monthNames[a.getMonth()],u=[],c=[];l.school.forEach(function(n){var l=e.expand([n],{title:"schools",data:t.schools},"title"),o=e.expand([n],{title:"schools",data:t.schools},"id");u.push('<span class="scheduleItem__school__item scheduleItem__school__item_'+o+'">'+l+"</span>")}),l.author.forEach(function(n){var l=e.expand([n],{title:"authors",data:t.authors},"title"),o=e.expand([n],{title:"authors",data:t.authors},"photo"),a=e.expand([n],{title:"authors",data:t.authors},"description");c.push('<a class="scheduleItem__author__link modal_trigger" href="#author" title="Посмотреть дополнительную информацию" data-photo="'+o+'" data-title="'+l+'" data-description="'+a+'">'+l+"</a>")}),l.isOver&&o.querySelector(".scheduleItem").classList.add("scheduleItem_state_inactive"),o.querySelector(".scheduleItem__day").innerHTML=i,o.querySelector(".scheduleItem__month").innerHTML=r,o.querySelector(".scheduleItem__time").innerHTML=l.time,o.querySelector(".scheduleItem__title").innerHTML=l.title,o.querySelector(".scheduleItem__school").innerHTML=u.join(""),o.querySelector(".scheduleItem__author").innerHTML+=c.join(", "),o.querySelector(".scheduleItem__audience").innerHTML+=e.expand([l.place],{title:"places",data:t.places},"title"),o.querySelector(".scheduleItem__place__link").innerHTML=e.expand([l.place],{title:"places",data:t.places},"address"),o.querySelector(".scheduleItem__place__link").href=e.expand([l.place],{title:"places",data:t.places},"link"),n.appendChild(o)}),e.content.innerHTML="",e.content.appendChild(n)},e.importDefaults=function(){e.body=app.modules.main.body,e.getSchedule=app.modules.main.library.getSchedule,e.expand=app.modules.main.library.expand},e.init=function(){e.container&&(e.importDefaults(),e.getData(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.schedule=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvcm1TZWxlY3RNdWx0aXBsZS9mb3JtU2VsZWN0TXVsdGlwbGUuanMiLCJtYWluL21haW4uanMiLCJtb2RhbC9tb2RhbC5qcyIsInNjaGVkdWxlL3NjaGVkdWxlLmpzIl0sIm5hbWVzIjpbImFwcCIsIm1vZHVsZXMiLCJGb3JtU2VsZWN0TXVsdGlwbGUiLCJzZWxmIiwidGhpcyIsImJvZHkiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiZm9vdGVyIiwic2V0dXBMaXN0ZW5lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJoYW5kbGVDaGFuZ2UiLCJoYW5kbGVDbGljayIsImNsb3Nlc3QiLCJzZWxlY3QiLCJzZWxlY3RlZFZhbHVlIiwidmFsdWUiLCJpbml0aWFsTGlzdCIsImRhdGFzZXQiLCJsaXN0IiwiSlNPTiIsInBhcnNlIiwib3B0aW9ucyIsInNsaWNlIiwiY2FsbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJzZWxlY3RMaXN0IiwicmVzdWx0TGlzdCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiZm9yRWFjaCIsIml0ZW0iLCJ0ZXh0IiwiaW5uZXJIVE1MIiwicHVzaCIsInN0cmluZ2lmeSIsImFkZCIsImZpbHRlciIsInNlbGVjdEl0ZW0iLCJpbml0aWFsSXRlbSIsImluZGV4Iiwic3BsaWNlIiwicmVuZGVyIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInRhcmdldCIsImdldEF0dHJpYnV0ZSIsImxpbmtzIiwibWFwIiwicmVzdWx0SXRlbSIsInNlbGVjdERhdGEiLCJyZXN1bHREYXRhIiwic2VsZWN0Q29udGFpbmVyIiwicmVzdWx0Q29udGFpbmVyIiwic2VsZWN0SHRtbCIsInJlc3VsdEh0bWwiLCJsZW5ndGgiLCJpbXBvcnREZWZhdWx0cyIsIm1haW4iLCJpbml0IiwiZm9ybVNlbGVjdE11bHRpcGxlIiwiaW5pdEFwcCIsIk1haW4iLCJodG1sIiwibGlicmFyeSIsIkxpYnJhcnkiLCJpbml0TGlicmFyeSIsImluaXRNb2R1bGVzIiwibW9kdWxlIiwiaGFzT3duUHJvcGVydHkiLCJ3aW5kb3ciLCJNb2RhbCIsIm9wZW5CdXR0b24iLCJjbG9zZUJ1dHRvbiIsInJvdXRlciIsIm9wZW4iLCJjbG9zZSIsInNyYyIsInBob3RvIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInJlbW92ZSIsIm1vZGFsIiwiU2NoZWR1bGUiLCJnZXRTY2hlZHVsZSIsImdldFBsYWNlIiwiZ2V0U2Nob29sIiwiZ2V0QXV0aG9yIiwiZXhwYW5kIiwidGVtcGxhdGUiLCJtb250aE5hbWVzIiwiZGF0YUxpc3QiLCJnZXREYXRhIiwiZGF0ZUZyb20iLCJkYXRlVG8iLCJwbGFjZSIsInRoZW4iLCJyZXNwb25zZSIsImNvbnRlbnRMaXN0IiwiY3JlYXRlRWxlbWVudCIsImxlY3R1cmVzIiwiZWxlbWVudCIsImRhdGUiLCJEYXRlIiwiZGF5IiwiZ2V0RGF0ZSIsIm1vbnRoIiwiZ2V0TW9udGgiLCJzY2hvb2wiLCJhdXRob3IiLCJpdGVtVGl0bGUiLCJkYXRhIiwic2Nob29scyIsIml0ZW1JZCIsImF1dGhvcnMiLCJpdGVtUGhvdG8iLCJpdGVtRGVzY3JpcHRpb24iLCJpc092ZXIiLCJ0aW1lIiwiam9pbiIsInBsYWNlcyIsImhyZWYiLCJhcHBlbmRDaGlsZCIsInNjaGVkdWxlIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBLEtBQUEsV0FBQUEsTUFBQSxzQkFBQUEsS0FBQUMsU0FBQSxDQVFBLEdBQUFDLEdBQUEsV0FDQSxHQUFBQyxHQUFBQyxJQUVBRCxHQUFBRSxLQUFBLEdBQ0FGLEVBQUFHLFVBQUFDLFNBQUFDLGNBQUEsdUJBQ0FMLEVBQUFNLFFBQUFGLFNBQUFDLGNBQUEsZ0NBQ0FMLEVBQUFPLE9BQUFILFNBQUFDLGNBQUEsK0JBS0FMLEVBQUFRLGNBQUEsV0FDQVIsRUFBQU0sUUFBQUcsaUJBQUEsU0FBQVQsRUFBQVUsY0FDQVYsRUFBQU8sT0FBQUUsaUJBQUEsUUFBQVQsRUFBQVcsY0FNQVgsRUFBQVUsYUFBQSxXQUNBLEdBQUFQLEdBQUFG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QUF2RCxLQUNBRixFQUFBbUYsWUFBQXRGLElBQUFDLFFBQUEyRCxLQUFBTSxRQUFBb0IsWUFJQW5GLEVBQUF1RixPQUFBMUYsSUFBQUMsUUFBQTJELEtBQUFNLFFBQUF3QixRQU1BdkYsRUFBQTBELEtBQUEsV0FDQTFELEVBQUFHLFlBRUFILEVBQUF3RCxpQkFFQXhELEVBQUEyRixVQUNBM0YsRUFBQVEsa0JBTUEsWUFBQVgsT0FDQUEsSUFBQUMsWUFHQUQsSUFBQUMsUUFBQTRILFNBQUEsR0FBQXhDIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnZm9ybVNlbGVjdE11bHRpcGxlJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBGb3JtU2VsZWN0TXVsdGlwbGUgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIEZvcm1TZWxlY3RNdWx0aXBsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuYm9keSA9ICcnO1xuICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKTtcbiAgICAgICAgc2VsZi5jb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fY29udGVudCcpO1xuICAgICAgICBzZWxmLmZvb3RlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX2Zvb3RlcicpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuY29udGVudC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmhhbmRsZUNoYW5nZSk7XG4gICAgICAgICAgICBzZWxmLmZvb3Rlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYuaGFuZGxlQ2xpY2spO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgY2hhbmdlIGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmhhbmRsZUNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuY2xvc2VzdCgnLmZvcm1TZWxlY3RNdWx0aXBsZScpLFxuICAgICAgICAgICAgICAgIHNlbGVjdCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3QnKSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlID0gc2VsZWN0LnZhbHVlLFxuICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0ID0gY29udGFpbmVyLmRhdGFzZXQubGlzdCA/IEpTT04ucGFyc2UoY29udGFpbmVyLmRhdGFzZXQubGlzdCkgOiBbXSxcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gW10uc2xpY2UuY2FsbChzZWxlY3QucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uJykpLFxuICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBbXSxcbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gW107XG5cbiAgICAgICAgICAgIGlmICghY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnZm9ybVNlbGVjdE11bHRpcGxlX3N0YXRlX2luaXRlZCcpKSB7XG5cbiAgICAgICAgICAgICAgICBbXS5zbGljZS5jYWxsKHNlbGVjdC5xdWVyeVNlbGVjdG9yQWxsKCdvcHRpb24nKSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHRleHQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QgPSBKU09OLnN0cmluZ2lmeShpbml0aWFsTGlzdCk7XG5cbiAgICAgICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnZm9ybVNlbGVjdE11bHRpcGxlX3N0YXRlX2luaXRlZCcpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHRleHQpIHtcblxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RMaXN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzZWxlY3RMaXN0ID0gc2VsZWN0TGlzdC5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnZhbHVlICE9PSBzZWxlY3RlZFZhbHVlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNlbGVjdExpc3QuZm9yRWFjaChmdW5jdGlvbihzZWxlY3RJdGVtKSB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbExpc3QuZm9yRWFjaChmdW5jdGlvbihpbml0aWFsSXRlbSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxJdGVtLnZhbHVlID09PSBzZWxlY3RJdGVtLnZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJlc3VsdExpc3QgPSBpbml0aWFsTGlzdDtcblxuICAgICAgICAgICAgc2VsZi5yZW5kZXIoY29udGFpbmVyLCBzZWxlY3RMaXN0LCByZXN1bHRMaXN0KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlIGNsaWNrIGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5oYW5kbGVDbGljayA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGhpcy5jbG9zZXN0KCcuZm9ybVNlbGVjdE11bHRpcGxlJyksXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0LFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkVmFsdWUgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgaW5pdGlhbExpc3QgPSBjb250YWluZXIuZGF0YXNldC5saXN0ID8gSlNPTi5wYXJzZShjb250YWluZXIuZGF0YXNldC5saXN0KSA6IFtdLFxuICAgICAgICAgICAgICAgIGxpbmtzID0gW10uc2xpY2UuY2FsbChjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYScpKSxcbiAgICAgICAgICAgICAgICBzZWxlY3RMaXN0ID0gW10sXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IFtdO1xuXG4gICAgICAgICAgICByZXN1bHRMaXN0ID0gbGlua3MubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnZhbHVlICE9PSBzZWxlY3RlZFZhbHVlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJlc3VsdExpc3QuZm9yRWFjaChmdW5jdGlvbihyZXN1bHRJdGVtKSB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbExpc3QuZm9yRWFjaChmdW5jdGlvbihpbml0aWFsSXRlbSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxJdGVtLnZhbHVlID09PSByZXN1bHRJdGVtLnZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNlbGVjdExpc3QgPSBpbml0aWFsTGlzdDtcblxuICAgICAgICAgICAgc2VsZi5yZW5kZXIoY29udGFpbmVyLCBzZWxlY3RMaXN0LCByZXN1bHRMaXN0KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIGRhdGEgZm9yIGNvbnRhaW5lclxuICAgICAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGNvbnRhaW5lclxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBzZWxlY3REYXRhXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHJlc3VsdERhdGFcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVuZGVyID0gZnVuY3Rpb24oY29udGFpbmVyLCBzZWxlY3REYXRhLCByZXN1bHREYXRhKSB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0Q29udGFpbmVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdCcpLFxuICAgICAgICAgICAgICAgIHJlc3VsdENvbnRhaW5lciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19saXN0JyksXG4gICAgICAgICAgICAgICAgc2VsZWN0SHRtbCA9ICc8b3B0aW9uIHZhbHVlPVwiXCI+PC9vcHRpb24+JyxcbiAgICAgICAgICAgICAgICByZXN1bHRIdG1sID0gJyc7XG5cbiAgICAgICAgICAgIGlmIChzZWxlY3REYXRhLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgIHNlbGVjdERhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdEh0bWwgKz0gJzxvcHRpb24gdmFsdWU9XCInKyBpdGVtLnZhbHVlICsnXCI+JysgaXRlbS50ZXh0ICsnPC9vcHRpb24+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzdWx0RGF0YS5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICByZXN1bHREYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRIdG1sICs9ICc8bGkgY2xhc3M9XCJmb3JtU2VsZWN0TXVsdGlwbGVfX2l0ZW1cIj48YSBocmVmPVwiJysgaXRlbS52YWx1ZSArJ1wiIGNsYXNzPVwiZm9ybVNlbGVjdE11bHRpcGxlX19saW5rXCI+JysgaXRlbS50ZXh0ICsnPC9hPjwvbGk+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2VsZWN0Q29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RDb250YWluZXIuaW5uZXJIVE1MID0gc2VsZWN0SHRtbDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzdWx0Q29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MID0gcmVzdWx0SHRtbDtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbXBvcnQgcHJvcGVydGllcyBmcm9tIE1haW4gY2xhc3NcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keSA9IGFwcC5tb2R1bGVzLm1haW4uYm9keTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5mb3JtU2VsZWN0TXVsdGlwbGUgPSBuZXcgRm9ybVNlbGVjdE11bHRpcGxlKCk7XG59KSgpO1xuIiwidmFyIGluaXRBcHAgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnbWFpbicgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgTWFpbiBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgTWFpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5odG1sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaHRtbCcpO1xuICAgICAgICBzZWxmLmJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG4gICAgICAgIHNlbGYubW9kdWxlcyA9IGFwcC5tb2R1bGVzO1xuICAgICAgICBzZWxmLmxpYnJhcnkgPSBuZXcgTGlicmFyeSgpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IGxpYnJhcnkgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRMaWJyYXJ5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmxpYnJhcnkuaW5pdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IGFsbCBtb2R1bGVzIGluICQubW9kdWxlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0TW9kdWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZm9yICh2YXIgbW9kdWxlIGluIHNlbGYubW9kdWxlcykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNlbGYubW9kdWxlcy5oYXNPd25Qcm9wZXJ0eShtb2R1bGUpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxmLm1vZHVsZXNbbW9kdWxlXS5pbml0ICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09ICdtYWluJyAmJiBtb2R1bGUgIT09ICdsaWJyYXJ5Jykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm1vZHVsZXNbbW9kdWxlXS5pbml0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuaW5pdExpYnJhcnkoKTtcbiAgICAgICAgICAgIHNlbGYuaW5pdE1vZHVsZXMoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5tYWluID0gbmV3IE1haW4oKTtcblxuICAgIGFwcC5tb2R1bGVzLm1haW4uaW5pdCgpO1xufTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBpbml0QXBwKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ21vZGFsJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNb2RhbCBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgTW9kYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmh0bWwgPSAnJztcbiAgICAgICAgc2VsZi5ib2R5ID0gJyc7XG4gICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsJyk7XG4gICAgICAgIHNlbGYub3BlbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF90cmlnZ2VyJyk7XG4gICAgICAgIHNlbGYuY2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfY2xvc2UnKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLnJvdXRlcik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJvdXRlIGNsaWNrIGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yb3V0ZXIgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX3RyaWdnZXInKSkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHNlbGYub3BlbihldmVudC50YXJnZXQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX2Nsb3NlJykpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmNsb3NlKGV2ZW50LnRhcmdldCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLm9wZW4gPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgICAgIHZhciBzcmMgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzcmMpLFxuICAgICAgICAgICAgICAgIHBob3RvID0gdGFyZ2V0LmRhdGFzZXQucGhvdG8sXG4gICAgICAgICAgICAgICAgdGl0bGUgPSB0YXJnZXQuZGF0YXNldC50aXRsZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHRhcmdldC5kYXRhc2V0LmRlc2NyaXB0aW9uO1xuXG4gICAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmF1dGhvckluZm9fX3ByZXZpZXcgaW1nJykuc3JjID0gcGhvdG87XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYXV0aG9ySW5mb19fdGl0bGUnKS5pbm5lckhUTUwgPSB0aXRsZTtcblxuICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5hdXRob3JJbmZvX190ZXh0IHAnKS5pbm5lckhUTUwgPSBkZXNjcmlwdGlvbjtcblxuICAgICAgICAgICAgc2VsZi5odG1sLmNsYXNzTGlzdC5hZGQoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5jbG9zZSA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRhcmdldC5jbG9zZXN0KCcubW9kYWwnKTtcblxuICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgICAgIHNlbGYuaHRtbC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEltcG9ydCBwcm9wZXJ0aWVzIGZyb20gTWFpbiBjbGFzc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5odG1sID0gYXBwLm1vZHVsZXMubWFpbi5odG1sO1xuICAgICAgICAgICAgc2VsZi5ib2R5ID0gYXBwLm1vZHVsZXMubWFpbi5ib2R5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5jb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLm1vZGFsID0gbmV3IE1vZGFsKCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gYXBwICYmICdzY2hlZHVsZScgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgU2NoZWR1bGUgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIFNjaGVkdWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5ib2R5ID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0U2NoZWR1bGUgPSAnJztcbiAgICAgICAgc2VsZi5nZXRQbGFjZSA9ICcnO1xuICAgICAgICBzZWxmLmdldFNjaG9vbCA9ICcnO1xuICAgICAgICBzZWxmLmdldEF1dGhvciA9ICcnO1xuICAgICAgICBzZWxmLmV4cGFuZCA9ICcnO1xuICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZScpO1xuICAgICAgICBzZWxmLmNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVMaXN0X19jb250ZW50Jyk7XG4gICAgICAgIHNlbGYudGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2NoZWR1bGVJdGVtLXRlbXBsYXRlJykuaW5uZXJIVE1MO1xuICAgICAgICBzZWxmLm1vbnRoTmFtZXMgPSBbXG4gICAgICAgICAgICAn0Y/QvdCy0LDRgNGMJyxcbiAgICAgICAgICAgICfRhNC10LLRgNCw0LvRjCcsXG4gICAgICAgICAgICAn0LzQsNGA0YInLFxuICAgICAgICAgICAgJ9Cw0L/RgNC10LvRjCcsXG4gICAgICAgICAgICAn0LzQsNC5JyxcbiAgICAgICAgICAgICfQuNGO0L3RjCcsXG4gICAgICAgICAgICAn0LjRjtC70YwnLFxuICAgICAgICAgICAgJ9Cw0LLQs9GD0YHRgicsXG4gICAgICAgICAgICAn0YHQtdC90YLRj9Cx0YDRjCcsXG4gICAgICAgICAgICAn0L7QutGC0Y/QsdGA0YwnLFxuICAgICAgICAgICAgJ9C90L7Rj9Cx0YDRjCcsXG4gICAgICAgICAgICAn0LTQtdC60LDQsdGA0YwnXG4gICAgICAgIF07XG4gICAgICAgIHNlbGYuZGF0YUxpc3QgPSAnJztcblxuXG4gICAgICAgIC8vIHNlbGYuZGF0ZUZyb21JbnB1dCA9IHNlbGYuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtSW5wdXRfX2lucHV0W25hbWU9XCJmcm9tXCJdJyk7XG4gICAgICAgIC8vIHNlbGYuZGF0ZVRvSW5wdXQgPSBzZWxmLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybUlucHV0X19pbnB1dFtuYW1lPVwidG9cIl0nKTtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIHNlbGYuZGF0ZUZyb21JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICAgICAgLy8gc2VsZi5kYXRlVG9JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICAgICAgLy8gc2VsZi5wbGFjZVNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXR1cCBwbGFjZSBmaWx0ZXIgdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICAvLyBzZWxmLnNldHVwUGxhY2VGaWx0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gICAgIHNlbGYuZ2V0UGxhY2UoKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIC8vICAgICAgICAgdmFyIGh0bWwgPSAnPG9wdGlvbiB2YWx1ZT1cIlwiPjwvb3B0aW9uPic7XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgICAgICAgcmVzcG9uc2UuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgIGh0bWwgKz0gJzxvcHRpb24gdmFsdWU9XCInKyBpdGVtLmlkICsnXCI+JysgaXRlbS50aXRsZSArJzwvb3B0aW9uPic7XG4gICAgICAgIC8vICAgICAgICAgfSk7XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgICAgICAgc2VsZi5wbGFjZVNlbGVjdC5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgICAvLyAgICAgfSk7XG4gICAgICAgIC8vIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBkYXRhIGZyb20gbGlicmFyeSBhY2NvcmRpbmcgdG8gZmlsdGVyIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5nZXREYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZGF0ZUZyb20gPSAnJywvL3NlbGYuZGF0ZUZyb21JbnB1dC52YWx1ZS5yZXBsYWNlKC8tL2csICcvJyksXG4gICAgICAgICAgICAgICAgZGF0ZVRvID0gJycsLy9zZWxmLmRhdGVUb0lucHV0LnZhbHVlLnJlcGxhY2UoLy0vZywgJy8nKSxcbiAgICAgICAgICAgICAgICBwbGFjZSA9ICcnOy8vc2VsZi5wbGFjZVNlbGVjdC52YWx1ZSA/IHBhcnNlSW50KHNlbGYucGxhY2VTZWxlY3QudmFsdWUpIDogJyc7XG5cbiAgICAgICAgICAgIHNlbGYuZ2V0U2NoZWR1bGUoZGF0ZUZyb20sIGRhdGVUbywgcGxhY2UpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcihyZXNwb25zZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIHNjaGVkdWxlIGxpc3RcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHJlc3BvbnNlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlbmRlciA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudExpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuXG4gICAgICAgICAgICBjb250ZW50TGlzdC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2xpc3QnKTtcblxuICAgICAgICAgICAgcmVzcG9uc2UubGVjdHVyZXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2l0ZW0nKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IHNlbGYudGVtcGxhdGU7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGl0ZW0uZGF0ZSksXG4gICAgICAgICAgICAgICAgICAgIGRheSA9IGRhdGUuZ2V0RGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgICBtb250aCA9IHNlbGYubW9udGhOYW1lc1tkYXRlLmdldE1vbnRoKCldLFxuICAgICAgICAgICAgICAgICAgICBzY2hvb2wgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yID0gW107XG5cbiAgICAgICAgICAgICAgICBpdGVtLnNjaG9vbC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1UaXRsZSA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnc2Nob29scycsIGRhdGE6IHJlc3BvbnNlLnNjaG9vbHN9LCAndGl0bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1JZCA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnc2Nob29scycsIGRhdGE6IHJlc3BvbnNlLnNjaG9vbHN9LCAnaWQnKTtcblxuICAgICAgICAgICAgICAgICAgICBzY2hvb2wucHVzaCgnPHNwYW4gY2xhc3M9XCJzY2hlZHVsZUl0ZW1fX3NjaG9vbF9faXRlbSBzY2hlZHVsZUl0ZW1fX3NjaG9vbF9faXRlbV8nKyBpdGVtSWQgKydcIj4nKyBpdGVtVGl0bGUgKyc8L3NwYW4+Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdGVtLmF1dGhvci5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1UaXRsZSA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAndGl0bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1QaG90byA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAncGhvdG8nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1EZXNjcmlwdGlvbiA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAnZGVzY3JpcHRpb24nKTtcblxuICAgICAgICAgICAgICAgICAgICBhdXRob3IucHVzaCgnPGEgY2xhc3M9XCJzY2hlZHVsZUl0ZW1fX2F1dGhvcl9fbGluayBtb2RhbF90cmlnZ2VyXCIgaHJlZj1cIiNhdXRob3JcIiB0aXRsZT1cItCf0L7RgdC80L7RgtGA0LXRgtGMINC00L7Qv9C+0LvQvdC40YLQtdC70YzQvdGD0Y4g0LjQvdGE0L7RgNC80LDRhtC40Y5cIiBkYXRhLXBob3RvPVwiJysgaXRlbVBob3RvICsnXCIgZGF0YS10aXRsZT1cIicrIGl0ZW1UaXRsZSArJ1wiIGRhdGEtZGVzY3JpcHRpb249XCInKyBpdGVtRGVzY3JpcHRpb24gKydcIj4nKyBpdGVtVGl0bGUgKyc8L2E+Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pc092ZXIpIHtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW0nKS5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUl0ZW1fc3RhdGVfaW5hY3RpdmUnKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fZGF5JykuaW5uZXJIVE1MID0gZGF5O1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19tb250aCcpLmlubmVySFRNTCA9IG1vbnRoO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX190aW1lJykuaW5uZXJIVE1MID0gaXRlbS50aW1lO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX190aXRsZScpLmlubmVySFRNTCA9IGl0ZW0udGl0bGU7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3NjaG9vbCcpLmlubmVySFRNTCA9IHNjaG9vbC5qb2luKCcnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fYXV0aG9yJykuaW5uZXJIVE1MICs9IGF1dGhvci5qb2luKCcsICcpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19hdWRpZW5jZScpLmlubmVySFRNTCArPSBzZWxmLmV4cGFuZChbaXRlbS5wbGFjZV0sIHt0aXRsZTogJ3BsYWNlcycsIGRhdGE6IHJlc3BvbnNlLnBsYWNlc30sICd0aXRsZScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19wbGFjZV9fbGluaycpLmlubmVySFRNTCA9IHNlbGYuZXhwYW5kKFtpdGVtLnBsYWNlXSwge3RpdGxlOiAncGxhY2VzJywgZGF0YTogcmVzcG9uc2UucGxhY2VzfSwgJ2FkZHJlc3MnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fcGxhY2VfX2xpbmsnKS5ocmVmID0gc2VsZi5leHBhbmQoW2l0ZW0ucGxhY2VdLCB7dGl0bGU6ICdwbGFjZXMnLCBkYXRhOiByZXNwb25zZS5wbGFjZXN9LCAnbGluaycpO1xuXG4gICAgICAgICAgICAgICAgY29udGVudExpc3QuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQuYXBwZW5kQ2hpbGQoY29udGVudExpc3QpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbXBvcnQgcHJvcGVydGllcyBmcm9tIE1haW4gY2xhc3NcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keSA9IGFwcC5tb2R1bGVzLm1haW4uYm9keTtcbiAgICAgICAgICAgIHNlbGYuZ2V0U2NoZWR1bGUgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZ2V0U2NoZWR1bGU7XG4gICAgICAgICAgICAvLyBzZWxmLmdldFBsYWNlID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmdldFBsYWNlO1xuICAgICAgICAgICAgLy8gc2VsZi5nZXRTY2hvb2wgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZ2V0U2Nob29sO1xuICAgICAgICAgICAgLy8gc2VsZi5nZXRBdXRob3IgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZ2V0QXV0aG9yO1xuICAgICAgICAgICAgc2VsZi5leHBhbmQgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZXhwYW5kO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5jb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMoKTtcbiAgICAgICAgICAgICAgICAvLyBzZWxmLnNldHVwUGxhY2VGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICBzZWxmLmdldERhdGEoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLnNjaGVkdWxlID0gbmV3IFNjaGVkdWxlKCk7XG59KSgpO1xuIl19

!function(){if(!("modules"in app&&"formSelectMultiple"in app.modules)){var e=function(){var e=this;e.body="",e.container=document.querySelector(".formSelectMultiple"),e.setupListener=function(){e.body.addEventListener("change",e.handleChange),e.body.addEventListener("click",e.handleClick)},e.handleChange=function(){var t=event.target;if(t.classList.contains("formSelectMultiple__select")){var l=t.closest(".formSelectMultiple"),n=l.querySelector(".formSelectMultiple__select"),o=n.value,a=l.dataset.list?JSON.parse(l.dataset.list):[],i=[].slice.call(n.querySelectorAll("option")),r=[],u=[];l.classList.contains("formSelectMultiple_state_inited")||([].slice.call(n.querySelectorAll("option")).forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&a.push({value:t,text:l})}),l.dataset.list=JSON.stringify(a),l.classList.add("formSelectMultiple_state_inited")),i.forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&r.push({value:t,text:l})}),r=r.filter(function(e){return e.value!==o}),r.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),u=a,e.render(l,r,u)}},e.handleClick=function(t){var l=t.target;if(l.classList.contains("formSelectMultiple__link")){t.preventDefault();var n=l.closest(".formSelectMultiple"),o=l.getAttribute("href"),a=n.dataset.list?JSON.parse(n.dataset.list):[],i=[].slice.call(n.querySelectorAll("a")),r=[],u=[];u=i.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}}).filter(function(e){return e.value!==o}),u.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),r=a,e.render(n,r,u)}},e.getValue=function(e){var t=[];if(e){var l=[].slice.call(e.querySelectorAll("a"));t=l.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}})}return t},e.render=function(e,t,l){var n=e.querySelector(".formSelectMultiple__select"),o=e.querySelector(".formSelectMultiple__list"),a='<option value=""></option>',i="";t.length>0&&t.forEach(function(e){a+='<option value="'+e.value+'">'+e.text+"</option>"}),l.length>0&&l.forEach(function(e){i+='<li class="formSelectMultiple__item"><a href="'+e.value+'" class="formSelectMultiple__link">'+e.text+"</a></li>"}),n&&(n.innerHTML=a),o&&(o.innerHTML=i),e.dispatchEvent(new Event("render"))},e.importDefaults=function(){e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.formSelectMultiple=new e}}();var initApp=function(){if(!("modules"in app&&"main"in app.modules)){var e=function(){var e=this;e.html=document.querySelector("html"),e.body=document.querySelector("body"),e.modules=app.modules,e.library=new Library,e.initLibrary=function(){e.library.init()},e.initPolyfills=function(){Element.prototype.closest||(Element.prototype.closest=function(e){for(var t=this;t;){if(t.matches(e))return t;t=t.parentElement}return null})},e.initModules=function(){for(var t in e.modules)e.modules.hasOwnProperty(t)&&"undefined"!=typeof e.modules[t].init&&"main"!==t&&"library"!==t&&e.modules[t].init()},e.init=function(){e.initLibrary(),e.initPolyfills(),e.initModules()}};"modules"in app||(app.modules={}),app.modules.main=new e,app.modules.main.init()}};window.addEventListener("load",initApp),function(){if(!("modules"in app&&"modal"in app.modules)){var e=function(){var e=this;e.html="",e.body="",e.container=document.querySelector(".modal"),e.openButton=document.querySelector(".modal_trigger"),e.closeButton=document.querySelector(".modal_close"),e.setupListener=function(){e.body.addEventListener("click",e.router)},e.router=function(t){var l=t.target;l.classList.contains("modal_trigger")?(t.preventDefault(),e.open(t.target)):l.classList.contains("modal_close")&&(t.preventDefault(),e.close(t.target))},e.open=function(t){var l=t.getAttribute("href"),n=document.querySelector(l),o=t.dataset.photo,a=t.dataset.title,i=t.dataset.description;n.querySelector(".authorInfo__preview img").src=o,n.querySelector(".authorInfo__title").innerHTML=a,n.querySelector(".authorInfo__text p").innerHTML=i,e.html.classList.add("modal_state_open"),n.classList.add("modal_state_open")},e.close=function(t){var l=t.closest(".modal");l.classList.remove("modal_state_open"),e.html.classList.remove("modal_state_open")},e.importDefaults=function(){e.html=app.modules.main.html,e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.modal=new e}}(),function(){if(!("modules"in app&&"schedule"in app.modules)){var e=function(){var e=this;e.body="",e.getSchedule="",e.getPlace="",e.getSchool="",e.getAuthor="",e.expand="",e.getValue="",e.container=document.querySelector(".schedule"),e.resultNumber=document.querySelector(".schedule__arrow__text span"),e.content=document.querySelector(".scheduleList__content"),e.trigger=[].slice.call(document.querySelectorAll(".schedule__trigger")),e.schoolSelect=document.querySelector('.formSelectMultiple__select[name="school"]'),e.authorSelect=document.querySelector('.formSelectMultiple__select[name="author"]'),e.dateFromInput=document.querySelector('.formInput__input[name="from"]'),e.dateToInput=document.querySelector('.formInput__input[name="to"]'),e.schoolSelectMultiple=document.querySelector(".formSelectMultiple.formSelectMultiple_type_school"),e.authorSelectMultiple=document.querySelector(".formSelectMultiple.formSelectMultiple_type_author"),e.selectMultiple=[].slice.call(document.querySelectorAll(".formSelectMultiple")),e.template=document.querySelector("#scheduleItem-template").innerHTML,e.monthNames=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],e.dataList="",e.setupListener=function(){e.dateFromInput.addEventListener("change",e.getData),e.dateToInput.addEventListener("change",e.getData),e.selectMultiple.forEach(function(t){t.addEventListener("render",e.getData)}),e.trigger.forEach(function(t){t.addEventListener("click",e.showFilter)})},e.showFilter=function(t){t.preventDefault(),e.container.classList.contains("schedule_state_filter")?e.container.classList.remove("schedule_state_filter"):e.container.classList.add("schedule_state_filter")},e.setupSchoolFilter=function(){e.getSchool().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.schoolSelect.innerHTML=l})},e.setupAuthorFilter=function(){e.getAuthor().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.authorSelect.innerHTML=l})},e.getData=function(){var t=e.dateFromInput.value.replace(/-/g,"/"),l=e.dateToInput.value.replace(/-/g,"/"),n=e.getValue(e.schoolSelectMultiple),o=e.getValue(e.authorSelectMultiple);e.getSchedule(t,l,"").then(function(t){n.length>0&&(t.lectures=t.lectures.filter(function(e){var t=!1;return n.forEach(function(l){e.school.indexOf(parseInt(l.value))!==-1&&(t=!0)}),t})),o.length>0&&(t.lectures=t.lectures.filter(function(e){var t=!1;return o.forEach(function(l){e.author.indexOf(parseInt(l.value))!==-1&&(t=!0)}),t})),e.render(t)})},e.render=function(t){var l=document.createElement("ul");if(l.classList.add("scheduleList__list"),t.lectures.forEach(function(n){var o=document.createElement("li");o.classList.add("scheduleList__item"),o.innerHTML=e.template;var a=new Date(n.date),i=a.getDate(),r=e.monthNames[a.getMonth()],u=[],c=[];n.school.forEach(function(l){var n=e.expand([l],{title:"schools",data:t.schools},"title"),o=e.expand([l],{title:"schools",data:t.schools},"id");u.push('<span class="scheduleItem__school__item scheduleItem__school__item_'+o+'">'+n+"</span>")}),n.author.forEach(function(l){var n=e.expand([l],{title:"authors",data:t.authors},"title"),o=e.expand([l],{title:"authors",data:t.authors},"photo"),a=e.expand([l],{title:"authors",data:t.authors},"description");c.push('<a class="scheduleItem__author__link modal_trigger" href="#author-modal" title="Посмотреть дополнительную информацию" data-photo="'+o+'" data-title="'+n+'" data-description="'+a+'">'+n+"</a>")}),n.isOver&&o.querySelector(".scheduleItem").classList.add("scheduleItem_state_inactive"),o.querySelector(".scheduleItem__day").innerHTML=i,o.querySelector(".scheduleItem__month").innerHTML=r,o.querySelector(".scheduleItem__time").innerHTML=n.time,o.querySelector(".scheduleItem__title").innerHTML=n.title,o.querySelector(".scheduleItem__school").innerHTML=u.join(""),o.querySelector(".scheduleItem__author").innerHTML+=c.join(", "),o.querySelector(".scheduleItem__audience").innerHTML+=e.expand([n.place],{title:"places",data:t.places},"title"),o.querySelector(".scheduleItem__place__link").innerHTML=e.expand([n.place],{title:"places",data:t.places},"address"),o.querySelector(".scheduleItem__place__link").href=e.expand([n.place],{title:"places",data:t.places},"link"),l.appendChild(o)}),0===t.lectures.length){var n=document.createElement("li");n.classList.add("scheduleList__item"),n.classList.add("scheduleList__item_state_empty"),n.innerHTML="По вашему запросу ничего не найдено.",l.appendChild(n)}e.content.innerHTML="",e.content.appendChild(l),e.resultNumber.innerHTML=t.lectures.length},e.importDefaults=function(){e.body=app.modules.main.body,e.getSchedule=app.modules.main.library.getSchedule,e.getSchool=app.modules.main.library.getSchool,e.getAuthor=app.modules.main.library.getAuthor,e.expand=app.modules.main.library.expand,e.getValue=app.modules.formSelectMultiple.getValue},e.init=function(){e.container&&(e.importDefaults(),e.setupSchoolFilter(),e.setupAuthorFilter(),e.getData(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.schedule=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvcm1TZWxlY3RNdWx0aXBsZS9mb3JtU2VsZWN0TXVsdGlwbGUuanMiLCJtYWluL21haW4uanMiLCJtb2RhbC9tb2RhbC5qcyIsInNjaGVkdWxlL3NjaGVkdWxlLmpzIl0sIm5hbWVzIjpbImFwcCIsIm1vZHVsZXMiLCJGb3JtU2VsZWN0TXVsdGlwbGUiLCJzZWxmIiwidGhpcyIsImJvZHkiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzZXR1cExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZUNoYW5nZSIsImhhbmRsZUNsaWNrIiwidGFyZ2V0IiwiZXZlbnQiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImNsb3Nlc3QiLCJzZWxlY3QiLCJzZWxlY3RlZFZhbHVlIiwidmFsdWUiLCJpbml0aWFsTGlzdCIsImRhdGFzZXQiLCJsaXN0IiwiSlNPTiIsInBhcnNlIiwib3B0aW9ucyIsInNsaWNlIiwiY2FsbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJzZWxlY3RMaXN0IiwicmVzdWx0TGlzdCIsImZvckVhY2giLCJpdGVtIiwidGV4dCIsImlubmVySFRNTCIsInB1c2giLCJzdHJpbmdpZnkiLCJhZGQiLCJmaWx0ZXIiLCJzZWxlY3RJdGVtIiwiaW5pdGlhbEl0ZW0iLCJpbmRleCIsInNwbGljZSIsInJlbmRlciIsInByZXZlbnREZWZhdWx0IiwiZ2V0QXR0cmlidXRlIiwibGlua3MiLCJtYXAiLCJyZXN1bHRJdGVtIiwiZ2V0VmFsdWUiLCJzZWxlY3REYXRhIiwicmVzdWx0RGF0YSIsInNlbGVjdENvbnRhaW5lciIsInJlc3VsdENvbnRhaW5lciIsInNlbGVjdEh0bWwiLCJyZXN1bHRIdG1sIiwibGVuZ3RoIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwiaW1wb3J0RGVmYXVsdHMiLCJtYWluIiwiaW5pdCIsImZvcm1TZWxlY3RNdWx0aXBsZSIsImluaXRBcHAiLCJNYWluIiwiaHRtbCIsImxpYnJhcnkiLCJMaWJyYXJ5IiwiaW5pdExpYnJhcnkiLCJpbml0UG9seWZpbGxzIiwiRWxlbWVudCIsInByb3RvdHlwZSIsImNzcyIsIm5vZGUiLCJtYXRjaGVzIiwicGFyZW50RWxlbWVudCIsImluaXRNb2R1bGVzIiwibW9kdWxlIiwiaGFzT3duUHJvcGVydHkiLCJ3aW5kb3ciLCJNb2RhbCIsIm9wZW5CdXR0b24iLCJjbG9zZUJ1dHRvbiIsInJvdXRlciIsIm9wZW4iLCJjbG9zZSIsInNyYyIsInBob3RvIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInJlbW92ZSIsIm1vZGFsIiwiU2NoZWR1bGUiLCJnZXRTY2hlZHVsZSIsImdldFBsYWNlIiwiZ2V0U2Nob29sIiwiZ2V0QXV0aG9yIiwiZXhwYW5kIiwicmVzdWx0TnVtYmVyIiwiY29udGVudCIsInRyaWdnZXIiLCJzY2hvb2xTZWxlY3QiLCJhdXRob3JTZWxlY3QiLCJkYXRlRnJvbUlucHV0IiwiZGF0ZVRvSW5wdXQiLCJzY2hvb2xTZWxlY3RNdWx0aXBsZSIsImF1dGhvclNlbGVjdE11bHRpcGxlIiwic2VsZWN0TXVsdGlwbGUiLCJ0ZW1wbGF0ZSIsIm1vbnRoTmFtZXMiLCJkYXRhTGlzdCIsImdldERhdGEiLCJzaG93RmlsdGVyIiwic2V0dXBTY2hvb2xGaWx0ZXIiLCJ0aGVuIiwicmVzcG9uc2UiLCJpZCIsInNldHVwQXV0aG9yRmlsdGVyIiwiZGF0ZUZyb20iLCJyZXBsYWNlIiwiZGF0ZVRvIiwic2Nob29sIiwiYXV0aG9yIiwibGVjdHVyZXMiLCJyZXN1bHQiLCJzY2hvb2xJdGVtIiwiaW5kZXhPZiIsInBhcnNlSW50IiwiYXV0aG9ySXRlbSIsImNvbnRlbnRMaXN0IiwiY3JlYXRlRWxlbWVudCIsImVsZW1lbnQiLCJkYXRlIiwiRGF0ZSIsImRheSIsImdldERhdGUiLCJtb250aCIsImdldE1vbnRoIiwiaXRlbVRpdGxlIiwiZGF0YSIsInNjaG9vbHMiLCJpdGVtSWQiLCJhdXRob3JzIiwiaXRlbVBob3RvIiwiaXRlbURlc2NyaXB0aW9uIiwiaXNPdmVyIiwidGltZSIs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QWxHLElBQUFDLFFBQUE0RCxLQUFBTSxRQUFBK0IsT0FDQS9GLEVBQUErQyxTQUFBbEQsSUFBQUMsUUFBQThELG1CQUFBYixVQU1BL0MsRUFBQTJELEtBQUEsV0FDQTNELEVBQUFHLFlBRUFILEVBQUF5RCxpQkFDQXpELEVBQUErRyxvQkFDQS9HLEVBQUFtSCxvQkFDQW5ILEVBQUE2RyxVQUNBN0csRUFBQU0sa0JBTUEsWUFBQVQsT0FDQUEsSUFBQUMsWUFHQUQsSUFBQUMsUUFBQXdKLFNBQUEsR0FBQTVEIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnZm9ybVNlbGVjdE11bHRpcGxlJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBGb3JtU2VsZWN0TXVsdGlwbGUgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIEZvcm1TZWxlY3RNdWx0aXBsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuYm9keSA9ICcnO1xuICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgc2VsZi5oYW5kbGVDaGFuZ2UpO1xuICAgICAgICAgICAgc2VsZi5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5oYW5kbGVDbGljayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaGFuZGxlQ2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3QnKSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRhcmdldC5jbG9zZXN0KCcuZm9ybVNlbGVjdE11bHRpcGxlJyksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3QnKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRWYWx1ZSA9IHNlbGVjdC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QgPSBjb250YWluZXIuZGF0YXNldC5saXN0ID8gSlNPTi5wYXJzZShjb250YWluZXIuZGF0YXNldC5saXN0KSA6IFtdLFxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gW10uc2xpY2UuY2FsbChzZWxlY3QucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uJykpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RMaXN0ID0gW10sXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBbXTtcblxuICAgICAgICAgICAgICAgIGlmICghY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnZm9ybVNlbGVjdE11bHRpcGxlX3N0YXRlX2luaXRlZCcpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgW10uc2xpY2UuY2FsbChzZWxlY3QucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uJykpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB0ZXh0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmRhdGFzZXQubGlzdCA9IEpTT04uc3RyaW5naWZ5KGluaXRpYWxMaXN0KTtcblxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnZm9ybVNlbGVjdE11bHRpcGxlX3N0YXRlX2luaXRlZCcpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBpdGVtLmlubmVySFRNTDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdGV4dCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RMaXN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RMaXN0ID0gc2VsZWN0TGlzdC5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS52YWx1ZSAhPT0gc2VsZWN0ZWRWYWx1ZTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGVjdExpc3QuZm9yRWFjaChmdW5jdGlvbihzZWxlY3RJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LmZvckVhY2goZnVuY3Rpb24oaW5pdGlhbEl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdGlhbEl0ZW0udmFsdWUgPT09IHNlbGVjdEl0ZW0udmFsdWUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gaW5pdGlhbExpc3Q7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcihjb250YWluZXIsIHNlbGVjdExpc3QsIHJlc3VsdExpc3QpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZSBjbGljayBldmVudFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaGFuZGxlQ2xpY2sgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2Zvcm1TZWxlY3RNdWx0aXBsZV9fbGluaycpKSB7XG5cbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRhcmdldC5jbG9zZXN0KCcuZm9ybVNlbGVjdE11bHRpcGxlJyksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkVmFsdWUgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0ID0gY29udGFpbmVyLmRhdGFzZXQubGlzdCA/IEpTT04ucGFyc2UoY29udGFpbmVyLmRhdGFzZXQubGlzdCkgOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgbGlua3MgPSBbXS5zbGljZS5jYWxsKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdhJykpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RMaXN0ID0gW10sXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBbXTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBsaW5rcy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KS5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS52YWx1ZSAhPT0gc2VsZWN0ZWRWYWx1ZTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QuZm9yRWFjaChmdW5jdGlvbihyZXN1bHRJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LmZvckVhY2goZnVuY3Rpb24oaW5pdGlhbEl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdGlhbEl0ZW0udmFsdWUgPT09IHJlc3VsdEl0ZW0udmFsdWUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RMaXN0ID0gaW5pdGlhbExpc3Q7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcihjb250YWluZXIsIHNlbGVjdExpc3QsIHJlc3VsdExpc3QpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHVybiBjb250YWluZXIgc2VsZWN0ZWQgdmFsdWVcbiAgICAgICAgICogQHBhcmFtIGNvbnRhaW5lclxuICAgICAgICAgKiBAcmV0dXJucyB7QXJyYXl9XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdldFZhbHVlID0gZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0TGlzdCA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgbGlua3MgPSBbXS5zbGljZS5jYWxsKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdhJykpO1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IGxpbmtzLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHRMaXN0O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW5kZXIgZGF0YSBmb3IgY29udGFpbmVyXG4gICAgICAgICAqIEBwYXJhbSB7RWxlbWVudH0gY29udGFpbmVyXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHNlbGVjdERhdGFcbiAgICAgICAgICogQHBhcmFtIHtBcnJheX0gcmVzdWx0RGF0YVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yZW5kZXIgPSBmdW5jdGlvbihjb250YWluZXIsIHNlbGVjdERhdGEsIHJlc3VsdERhdGEpIHtcbiAgICAgICAgICAgIHZhciBzZWxlY3RDb250YWluZXIgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0JyksXG4gICAgICAgICAgICAgICAgcmVzdWx0Q29udGFpbmVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX2xpc3QnKSxcbiAgICAgICAgICAgICAgICBzZWxlY3RIdG1sID0gJzxvcHRpb24gdmFsdWU9XCJcIj48L29wdGlvbj4nLFxuICAgICAgICAgICAgICAgIHJlc3VsdEh0bWwgPSAnJztcblxuICAgICAgICAgICAgaWYgKHNlbGVjdERhdGEubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0RGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0SHRtbCArPSAnPG9wdGlvbiB2YWx1ZT1cIicrIGl0ZW0udmFsdWUgKydcIj4nKyBpdGVtLnRleHQgKyc8L29wdGlvbj4nO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZXN1bHREYXRhLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgIHJlc3VsdERhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdEh0bWwgKz0gJzxsaSBjbGFzcz1cImZvcm1TZWxlY3RNdWx0aXBsZV9faXRlbVwiPjxhIGhyZWY9XCInKyBpdGVtLnZhbHVlICsnXCIgY2xhc3M9XCJmb3JtU2VsZWN0TXVsdGlwbGVfX2xpbmtcIj4nKyBpdGVtLnRleHQgKyc8L2E+PC9saT4nO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzZWxlY3RDb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHNlbGVjdENvbnRhaW5lci5pbm5lckhUTUwgPSBzZWxlY3RIdG1sO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZXN1bHRDb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgPSByZXN1bHRIdG1sO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgncmVuZGVyJykpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbXBvcnQgcHJvcGVydGllcyBmcm9tIE1haW4gY2xhc3NcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keSA9IGFwcC5tb2R1bGVzLm1haW4uYm9keTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5mb3JtU2VsZWN0TXVsdGlwbGUgPSBuZXcgRm9ybVNlbGVjdE11bHRpcGxlKCk7XG59KSgpO1xuIiwidmFyIGluaXRBcHAgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnbWFpbicgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgTWFpbiBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgTWFpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5odG1sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaHRtbCcpO1xuICAgICAgICBzZWxmLmJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG4gICAgICAgIHNlbGYubW9kdWxlcyA9IGFwcC5tb2R1bGVzO1xuICAgICAgICBzZWxmLmxpYnJhcnkgPSBuZXcgTGlicmFyeSgpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IGxpYnJhcnkgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRMaWJyYXJ5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmxpYnJhcnkuaW5pdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IHBvbHlGaWxsc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0UG9seWZpbGxzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIUVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QpIHtcblxuICAgICAgICAgICAgICAgIEVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QgPSBmdW5jdGlvbihjc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGUgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5tYXRjaGVzKGNzcykpIHJldHVybiBub2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBub2RlID0gbm9kZS5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBhbGwgbW9kdWxlcyBpbiAkLm1vZHVsZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdE1vZHVsZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGZvciAodmFyIG1vZHVsZSBpbiBzZWxmLm1vZHVsZXMpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzZWxmLm1vZHVsZXMuaGFzT3duUHJvcGVydHkobW9kdWxlKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VsZi5tb2R1bGVzW21vZHVsZV0uaW5pdCAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlICE9PSAnbWFpbicgJiYgbW9kdWxlICE9PSAnbGlicmFyeScpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2R1bGVzW21vZHVsZV0uaW5pdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmluaXRMaWJyYXJ5KCk7XG4gICAgICAgICAgICBzZWxmLmluaXRQb2x5ZmlsbHMoKTtcbiAgICAgICAgICAgIHNlbGYuaW5pdE1vZHVsZXMoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5tYWluID0gbmV3IE1haW4oKTtcblxuICAgIGFwcC5tb2R1bGVzLm1haW4uaW5pdCgpO1xufTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBpbml0QXBwKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ21vZGFsJyBpbiBhcHAubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNb2RhbCBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgTW9kYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLmh0bWwgPSAnJztcbiAgICAgICAgc2VsZi5ib2R5ID0gJyc7XG4gICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsJyk7XG4gICAgICAgIHNlbGYub3BlbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF90cmlnZ2VyJyk7XG4gICAgICAgIHNlbGYuY2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfY2xvc2UnKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLnJvdXRlcik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJvdXRlIGNsaWNrIGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yb3V0ZXIgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX3RyaWdnZXInKSkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHNlbGYub3BlbihldmVudC50YXJnZXQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX2Nsb3NlJykpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmNsb3NlKGV2ZW50LnRhcmdldCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLm9wZW4gPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgICAgIHZhciBzcmMgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzcmMpLFxuICAgICAgICAgICAgICAgIHBob3RvID0gdGFyZ2V0LmRhdGFzZXQucGhvdG8sXG4gICAgICAgICAgICAgICAgdGl0bGUgPSB0YXJnZXQuZGF0YXNldC50aXRsZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHRhcmdldC5kYXRhc2V0LmRlc2NyaXB0aW9uO1xuXG4gICAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmF1dGhvckluZm9fX3ByZXZpZXcgaW1nJykuc3JjID0gcGhvdG87XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYXV0aG9ySW5mb19fdGl0bGUnKS5pbm5lckhUTUwgPSB0aXRsZTtcblxuICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5hdXRob3JJbmZvX190ZXh0IHAnKS5pbm5lckhUTUwgPSBkZXNjcmlwdGlvbjtcblxuICAgICAgICAgICAgc2VsZi5odG1sLmNsYXNzTGlzdC5hZGQoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5jbG9zZSA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRhcmdldC5jbG9zZXN0KCcubW9kYWwnKTtcblxuICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX3N0YXRlX29wZW4nKTtcbiAgICAgICAgICAgIHNlbGYuaHRtbC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEltcG9ydCBwcm9wZXJ0aWVzIGZyb20gTWFpbiBjbGFzc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5odG1sID0gYXBwLm1vZHVsZXMubWFpbi5odG1sO1xuICAgICAgICAgICAgc2VsZi5ib2R5ID0gYXBwLm1vZHVsZXMubWFpbi5ib2R5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5jb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLm1vZGFsID0gbmV3IE1vZGFsKCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gYXBwICYmICdzY2hlZHVsZScgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgU2NoZWR1bGUgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIFNjaGVkdWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5ib2R5ID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0U2NoZWR1bGUgPSAnJztcbiAgICAgICAgc2VsZi5nZXRQbGFjZSA9ICcnO1xuICAgICAgICBzZWxmLmdldFNjaG9vbCA9ICcnO1xuICAgICAgICBzZWxmLmdldEF1dGhvciA9ICcnO1xuICAgICAgICBzZWxmLmV4cGFuZCA9ICcnO1xuICAgICAgICBzZWxmLmdldFZhbHVlID0gJyc7XG4gICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlJyk7XG4gICAgICAgIHNlbGYucmVzdWx0TnVtYmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlX19hcnJvd19fdGV4dCBzcGFuJyk7XG4gICAgICAgIHNlbGYuY29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUxpc3RfX2NvbnRlbnQnKTtcbiAgICAgICAgc2VsZi50cmlnZ2VyID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2NoZWR1bGVfX3RyaWdnZXInKSk7XG4gICAgICAgIHNlbGYuc2Nob29sU2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0W25hbWU9XCJzY2hvb2xcIl0nKTtcbiAgICAgICAgc2VsZi5hdXRob3JTZWxlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3RbbmFtZT1cImF1dGhvclwiXScpO1xuICAgICAgICBzZWxmLmRhdGVGcm9tSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybUlucHV0X19pbnB1dFtuYW1lPVwiZnJvbVwiXScpO1xuICAgICAgICBzZWxmLmRhdGVUb0lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1JbnB1dF9faW5wdXRbbmFtZT1cInRvXCJdJyk7XG4gICAgICAgIHNlbGYuc2Nob29sU2VsZWN0TXVsdGlwbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlLmZvcm1TZWxlY3RNdWx0aXBsZV90eXBlX3NjaG9vbCcpO1xuICAgICAgICBzZWxmLmF1dGhvclNlbGVjdE11bHRpcGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZS5mb3JtU2VsZWN0TXVsdGlwbGVfdHlwZV9hdXRob3InKTtcbiAgICAgICAgc2VsZi5zZWxlY3RNdWx0aXBsZSA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZvcm1TZWxlY3RNdWx0aXBsZScpKTtcbiAgICAgICAgc2VsZi50ZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzY2hlZHVsZUl0ZW0tdGVtcGxhdGUnKS5pbm5lckhUTUw7XG4gICAgICAgIHNlbGYubW9udGhOYW1lcyA9IFtcbiAgICAgICAgICAgICfRj9C90LLQsNGA0YwnLFxuICAgICAgICAgICAgJ9GE0LXQstGA0LDQu9GMJyxcbiAgICAgICAgICAgICfQvNCw0YDRgicsXG4gICAgICAgICAgICAn0LDQv9GA0LXQu9GMJyxcbiAgICAgICAgICAgICfQvNCw0LknLFxuICAgICAgICAgICAgJ9C40Y7QvdGMJyxcbiAgICAgICAgICAgICfQuNGO0LvRjCcsXG4gICAgICAgICAgICAn0LDQstCz0YPRgdGCJyxcbiAgICAgICAgICAgICfRgdC10L3RgtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQvtC60YLRj9Cx0YDRjCcsXG4gICAgICAgICAgICAn0L3QvtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQtNC10LrQsNCx0YDRjCdcbiAgICAgICAgXTtcbiAgICAgICAgc2VsZi5kYXRhTGlzdCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuZGF0ZUZyb21JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICAgICAgc2VsZi5kYXRlVG9JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICAgICAgc2VsZi5zZWxlY3RNdWx0aXBsZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ3JlbmRlcicsIHNlbGYuZ2V0RGF0YSk7fSk7XG4gICAgICAgICAgICBzZWxmLnRyaWdnZXIuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7aXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYuc2hvd0ZpbHRlcil9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBmaWx0ZXIgY29udGFpbmVyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zaG93RmlsdGVyID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ3NjaGVkdWxlX3N0YXRlX2ZpbHRlcicpKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdzY2hlZHVsZV9zdGF0ZV9maWx0ZXInKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlX3N0YXRlX2ZpbHRlcicpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHVwIHNjaG9vbCBmaWx0ZXIgdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwU2Nob29sRmlsdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmdldFNjaG9vbCgpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgaHRtbCA9ICc8b3B0aW9uIHZhbHVlPVwiXCI+PC9vcHRpb24+JztcblxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8b3B0aW9uIHZhbHVlPVwiJysgaXRlbS5pZCArJ1wiPicrIGl0ZW0udGl0bGUgKyc8L29wdGlvbj4nO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZi5zY2hvb2xTZWxlY3QuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXR1cCBhdXRob3IgZmlsdGVyIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cEF1dGhvckZpbHRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5nZXRBdXRob3IoKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPG9wdGlvbiB2YWx1ZT1cIlwiPjwvb3B0aW9uPic7XG5cbiAgICAgICAgICAgICAgICByZXNwb25zZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPG9wdGlvbiB2YWx1ZT1cIicrIGl0ZW0uaWQgKydcIj4nKyBpdGVtLnRpdGxlICsnPC9vcHRpb24+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGYuYXV0aG9yU2VsZWN0LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IGRhdGEgZnJvbSBsaWJyYXJ5IGFjY29yZGluZyB0byBmaWx0ZXIgdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdldERhdGEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBkYXRlRnJvbSA9IHNlbGYuZGF0ZUZyb21JbnB1dC52YWx1ZS5yZXBsYWNlKC8tL2csICcvJyksXG4gICAgICAgICAgICAgICAgZGF0ZVRvID0gc2VsZi5kYXRlVG9JbnB1dC52YWx1ZS5yZXBsYWNlKC8tL2csICcvJyksXG4gICAgICAgICAgICAgICAgc2Nob29sID0gc2VsZi5nZXRWYWx1ZShzZWxmLnNjaG9vbFNlbGVjdE11bHRpcGxlKSxcbiAgICAgICAgICAgICAgICBhdXRob3IgPSBzZWxmLmdldFZhbHVlKHNlbGYuYXV0aG9yU2VsZWN0TXVsdGlwbGUpO1xuXG4gICAgICAgICAgICBzZWxmLmdldFNjaGVkdWxlKGRhdGVGcm9tLCBkYXRlVG8sICcnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjaG9vbC5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UubGVjdHVyZXMgPSByZXNwb25zZS5sZWN0dXJlcy5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2hvb2wuZm9yRWFjaChmdW5jdGlvbihzY2hvb2xJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc2Nob29sLmluZGV4T2YocGFyc2VJbnQoc2Nob29sSXRlbS52YWx1ZSkpICE9PSAtMSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoYXV0aG9yLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5sZWN0dXJlcyA9IHJlc3BvbnNlLmxlY3R1cmVzLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvci5mb3JFYWNoKGZ1bmN0aW9uKGF1dGhvckl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5hdXRob3IuaW5kZXhPZihwYXJzZUludChhdXRob3JJdGVtLnZhbHVlKSkgIT09IC0xKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW5kZXIgc2NoZWR1bGUgbGlzdFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2VcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVuZGVyID0gZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBjb250ZW50TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICAgICAgICAgIGNvbnRlbnRMaXN0LmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlTGlzdF9fbGlzdCcpO1xuXG4gICAgICAgICAgICByZXNwb25zZS5sZWN0dXJlcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlTGlzdF9faXRlbScpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gc2VsZi50ZW1wbGF0ZTtcblxuICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoaXRlbS5kYXRlKSxcbiAgICAgICAgICAgICAgICAgICAgZGF5ID0gZGF0ZS5nZXREYXRlKCksXG4gICAgICAgICAgICAgICAgICAgIG1vbnRoID0gc2VsZi5tb250aE5hbWVzW2RhdGUuZ2V0TW9udGgoKV0sXG4gICAgICAgICAgICAgICAgICAgIHNjaG9vbCA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBhdXRob3IgPSBbXTtcblxuICAgICAgICAgICAgICAgIGl0ZW0uc2Nob29sLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbVRpdGxlID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdzY2hvb2xzJywgZGF0YTogcmVzcG9uc2Uuc2Nob29sc30sICd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUlkID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdzY2hvb2xzJywgZGF0YTogcmVzcG9uc2Uuc2Nob29sc30sICdpZCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNjaG9vbC5wdXNoKCc8c3BhbiBjbGFzcz1cInNjaGVkdWxlSXRlbV9fc2Nob29sX19pdGVtIHNjaGVkdWxlSXRlbV9fc2Nob29sX19pdGVtXycrIGl0ZW1JZCArJ1wiPicrIGl0ZW1UaXRsZSArJzwvc3Bhbj4nKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0ZW0uYXV0aG9yLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbVRpdGxlID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdhdXRob3JzJywgZGF0YTogcmVzcG9uc2UuYXV0aG9yc30sICd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVBob3RvID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdhdXRob3JzJywgZGF0YTogcmVzcG9uc2UuYXV0aG9yc30sICdwaG90bycpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbURlc2NyaXB0aW9uID0gc2VsZi5leHBhbmQoW2l0ZW1dLCB7dGl0bGU6ICdhdXRob3JzJywgZGF0YTogcmVzcG9uc2UuYXV0aG9yc30sICdkZXNjcmlwdGlvbicpO1xuXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvci5wdXNoKCc8YSBjbGFzcz1cInNjaGVkdWxlSXRlbV9fYXV0aG9yX19saW5rIG1vZGFsX3RyaWdnZXJcIiBocmVmPVwiI2F1dGhvci1tb2RhbFwiIHRpdGxlPVwi0J/QvtGB0LzQvtGC0YDQtdGC0Ywg0LTQvtC/0L7Qu9C90LjRgtC10LvRjNC90YPRjiDQuNC90YTQvtGA0LzQsNGG0LjRjlwiIGRhdGEtcGhvdG89XCInKyBpdGVtUGhvdG8gKydcIiBkYXRhLXRpdGxlPVwiJysgaXRlbVRpdGxlICsnXCIgZGF0YS1kZXNjcmlwdGlvbj1cIicrIGl0ZW1EZXNjcmlwdGlvbiArJ1wiPicrIGl0ZW1UaXRsZSArJzwvYT4nKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzT3Zlcikge1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbScpLmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlSXRlbV9zdGF0ZV9pbmFjdGl2ZScpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19kYXknKS5pbm5lckhUTUwgPSBkYXk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX21vbnRoJykuaW5uZXJIVE1MID0gbW9udGg7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3RpbWUnKS5pbm5lckhUTUwgPSBpdGVtLnRpbWU7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3RpdGxlJykuaW5uZXJIVE1MID0gaXRlbS50aXRsZTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fc2Nob29sJykuaW5uZXJIVE1MID0gc2Nob29sLmpvaW4oJycpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19hdXRob3InKS5pbm5lckhUTUwgKz0gYXV0aG9yLmpvaW4oJywgJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX2F1ZGllbmNlJykuaW5uZXJIVE1MICs9IHNlbGYuZXhwYW5kKFtpdGVtLnBsYWNlXSwge3RpdGxlOiAncGxhY2VzJywgZGF0YTogcmVzcG9uc2UucGxhY2VzfSwgJ3RpdGxlJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3BsYWNlX19saW5rJykuaW5uZXJIVE1MID0gc2VsZi5leHBhbmQoW2l0ZW0ucGxhY2VdLCB7dGl0bGU6ICdwbGFjZXMnLCBkYXRhOiByZXNwb25zZS5wbGFjZXN9LCAnYWRkcmVzcycpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19wbGFjZV9fbGluaycpLmhyZWYgPSBzZWxmLmV4cGFuZChbaXRlbS5wbGFjZV0sIHt0aXRsZTogJ3BsYWNlcycsIGRhdGE6IHJlc3BvbnNlLnBsYWNlc30sICdsaW5rJyk7XG5cbiAgICAgICAgICAgICAgICBjb250ZW50TGlzdC5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UubGVjdHVyZXMubGVuZ3RoID09PSAwKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NjaGVkdWxlTGlzdF9faXRlbScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2l0ZW1fc3RhdGVfZW1wdHknKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gJ9Cf0L4g0LLQsNGI0LXQvNGDINC30LDQv9GA0L7RgdGDINC90LjRh9C10LPQviDQvdC1INC90LDQudC00LXQvdC+Lic7XG5cbiAgICAgICAgICAgICAgICBjb250ZW50TGlzdC5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQuYXBwZW5kQ2hpbGQoY29udGVudExpc3QpO1xuXG4gICAgICAgICAgICBzZWxmLnJlc3VsdE51bWJlci5pbm5lckhUTUwgPSByZXNwb25zZS5sZWN0dXJlcy5sZW5ndGg7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEltcG9ydCBwcm9wZXJ0aWVzIGZyb20gTWFpbiBjbGFzc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5ib2R5ID0gYXBwLm1vZHVsZXMubWFpbi5ib2R5O1xuICAgICAgICAgICAgc2VsZi5nZXRTY2hlZHVsZSA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5nZXRTY2hlZHVsZTtcbiAgICAgICAgICAgIHNlbGYuZ2V0U2Nob29sID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmdldFNjaG9vbDtcbiAgICAgICAgICAgIHNlbGYuZ2V0QXV0aG9yID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmdldEF1dGhvcjtcbiAgICAgICAgICAgIHNlbGYuZXhwYW5kID0gYXBwLm1vZHVsZXMubWFpbi5saWJyYXJ5LmV4cGFuZDtcbiAgICAgICAgICAgIHNlbGYuZ2V0VmFsdWUgPSBhcHAubW9kdWxlcy5mb3JtU2VsZWN0TXVsdGlwbGUuZ2V0VmFsdWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cygpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBTY2hvb2xGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwQXV0aG9yRmlsdGVyKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5nZXREYXRhKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5zY2hlZHVsZSA9IG5ldyBTY2hlZHVsZSgpO1xufSkoKTtcbiJdfQ==

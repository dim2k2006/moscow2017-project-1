var initApp=function(){if(!("modules"in app&&"main"in app.modules)){var e=function(){var e=this;e.html=document.querySelector("html"),e.body=document.querySelector("body"),e.modules=app.modules,e.library=new Library,e.initLibrary=function(){e.library.init()},e.initModules=function(){for(var t in e.modules)e.modules.hasOwnProperty(t)&&"undefined"!=typeof e.modules[t].init&&"main"!==t&&"library"!==t&&e.modules[t].init()},e.init=function(){e.initLibrary(),e.initModules()}};"modules"in app||(app.modules={}),app.modules.main=new e,app.modules.main.init()}};window.addEventListener("load",initApp),function(){if(!("modules"in app&&"formSelectMultiple"in app.modules)){var e=function(){var e=this;e.body="",e.container=document.querySelector(".formSelectMultiple"),e.setupListener=function(){e.body.addEventListener("change",e.handleChange),e.body.addEventListener("click",e.handleClick)},e.handleChange=function(){var t=event.target;if(t.classList.contains("formSelectMultiple__select")){var l=t.closest(".formSelectMultiple"),n=l.querySelector(".formSelectMultiple__select"),o=n.value,a=l.dataset.list?JSON.parse(l.dataset.list):[],i=[].slice.call(n.querySelectorAll("option")),r=[],u=[];l.classList.contains("formSelectMultiple_state_inited")||([].slice.call(n.querySelectorAll("option")).forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&a.push({value:t,text:l})}),l.dataset.list=JSON.stringify(a),l.classList.add("formSelectMultiple_state_inited")),i.forEach(function(e){var t=e.value,l=e.innerHTML;t&&l&&r.push({value:t,text:l})}),r=r.filter(function(e){return e.value!==o}),r.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),u=a,e.render(l,r,u)}},e.handleClick=function(t){var l=t.target;if(l.classList.contains("formSelectMultiple__link")){t.preventDefault();var n=l.closest(".formSelectMultiple"),o=l.getAttribute("href"),a=n.dataset.list?JSON.parse(n.dataset.list):[],i=[].slice.call(n.querySelectorAll("a")),r=[],u=[];u=i.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}}).filter(function(e){return e.value!==o}),u.forEach(function(e){a.forEach(function(t,l){t.value===e.value&&a.splice(l,1)})}),r=a,e.render(n,r,u)}},e.getValue=function(e){var t=[];if(e){var l=[].slice.call(e.querySelectorAll("a"));t=l.map(function(e){var t=e.getAttribute("href"),l=e.innerHTML;return{value:t,text:l}})}return t},e.render=function(e,t,l){var n=e.querySelector(".formSelectMultiple__select"),o=e.querySelector(".formSelectMultiple__list"),a='<option value=""></option>',i="";t.length>0&&t.forEach(function(e){a+='<option value="'+e.value+'">'+e.text+"</option>"}),l.length>0&&l.forEach(function(e){i+='<li class="formSelectMultiple__item"><a href="'+e.value+'" class="formSelectMultiple__link">'+e.text+"</a></li>"}),n&&(n.innerHTML=a),o&&(o.innerHTML=i),e.dispatchEvent(new Event("change"))},e.importDefaults=function(){e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.formSelectMultiple=new e}}(),function(){if(!("modules"in app&&"modal"in app.modules)){var e=function(){var e=this;e.html="",e.body="",e.container=document.querySelector(".modal"),e.openButton=document.querySelector(".modal_trigger"),e.closeButton=document.querySelector(".modal_close"),e.setupListener=function(){e.body.addEventListener("click",e.router)},e.router=function(t){var l=t.target;l.classList.contains("modal_trigger")?(t.preventDefault(),e.open(t.target)):l.classList.contains("modal_close")&&(t.preventDefault(),e.close(t.target))},e.open=function(t){var l=t.getAttribute("href"),n=document.querySelector(l),o=t.dataset.photo,a=t.dataset.title,i=t.dataset.description;n.querySelector(".authorInfo__preview img").src=o,n.querySelector(".authorInfo__title").innerHTML=a,n.querySelector(".authorInfo__text p").innerHTML=i,e.html.classList.add("modal_state_open"),n.classList.add("modal_state_open")},e.close=function(t){var l=t.closest(".modal");l.classList.remove("modal_state_open"),e.html.classList.remove("modal_state_open")},e.importDefaults=function(){e.html=app.modules.main.html,e.body=app.modules.main.body},e.init=function(){e.container&&(e.importDefaults(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.modal=new e}}(),function(){if(!("modules"in app&&"schedule"in app.modules)){var e=function(){var e=this;e.body="",e.getSchedule="",e.getPlace="",e.getSchool="",e.getAuthor="",e.expand="",e.container=document.querySelector(".schedule"),e.content=document.querySelector(".scheduleList__content"),e.schoolSelect=document.querySelector('.formSelectMultiple__select[name="school"]'),e.authorSelect=document.querySelector('.formSelectMultiple__select[name="author"]'),e.template=document.querySelector("#scheduleItem-template").innerHTML,e.monthNames=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],e.dataList="",e.setupListener=function(){},e.setupSchoolFilter=function(){e.getSchool().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.schoolSelect.innerHTML=l})},e.setupAuthorFilter=function(){e.getAuthor().then(function(t){var l='<option value=""></option>';t.forEach(function(e){l+='<option value="'+e.id+'">'+e.title+"</option>"}),e.authorSelect.innerHTML=l})},e.getData=function(){var t="",l="",n="";e.getSchedule(t,l,n).then(function(t){e.render(t)})},e.render=function(t){var l=document.createElement("ul");l.classList.add("scheduleList__list"),t.lectures.forEach(function(n){var o=document.createElement("li");o.classList.add("scheduleList__item"),o.innerHTML=e.template;var a=new Date(n.date),i=a.getDate(),r=e.monthNames[a.getMonth()],u=[],c=[];n.school.forEach(function(l){var n=e.expand([l],{title:"schools",data:t.schools},"title"),o=e.expand([l],{title:"schools",data:t.schools},"id");u.push('<span class="scheduleItem__school__item scheduleItem__school__item_'+o+'">'+n+"</span>")}),n.author.forEach(function(l){var n=e.expand([l],{title:"authors",data:t.authors},"title"),o=e.expand([l],{title:"authors",data:t.authors},"photo"),a=e.expand([l],{title:"authors",data:t.authors},"description");c.push('<a class="scheduleItem__author__link modal_trigger" href="#author" title="Посмотреть дополнительную информацию" data-photo="'+o+'" data-title="'+n+'" data-description="'+a+'">'+n+"</a>")}),n.isOver&&o.querySelector(".scheduleItem").classList.add("scheduleItem_state_inactive"),o.querySelector(".scheduleItem__day").innerHTML=i,o.querySelector(".scheduleItem__month").innerHTML=r,o.querySelector(".scheduleItem__time").innerHTML=n.time,o.querySelector(".scheduleItem__title").innerHTML=n.title,o.querySelector(".scheduleItem__school").innerHTML=u.join(""),o.querySelector(".scheduleItem__author").innerHTML+=c.join(", "),o.querySelector(".scheduleItem__audience").innerHTML+=e.expand([n.place],{title:"places",data:t.places},"title"),o.querySelector(".scheduleItem__place__link").innerHTML=e.expand([n.place],{title:"places",data:t.places},"address"),o.querySelector(".scheduleItem__place__link").href=e.expand([n.place],{title:"places",data:t.places},"link"),l.appendChild(o)}),e.content.innerHTML="",e.content.appendChild(l)},e.importDefaults=function(){e.body=app.modules.main.body,e.getSchedule=app.modules.main.library.getSchedule,e.getSchool=app.modules.main.library.getSchool,e.getAuthor=app.modules.main.library.getAuthor,e.expand=app.modules.main.library.expand},e.init=function(){e.container&&(e.importDefaults(),e.setupSchoolFilter(),e.setupAuthorFilter(),e.getData(),e.setupListener())}};"modules"in app||(app.modules={}),app.modules.schedule=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vbWFpbi5qcyIsImZvcm1TZWxlY3RNdWx0aXBsZS9mb3JtU2VsZWN0TXVsdGlwbGUuanMiLCJtb2RhbC9tb2RhbC5qcyIsInNjaGVkdWxlL3NjaGVkdWxlLmpzIl0sIm5hbWVzIjpbImluaXRBcHAiLCJhcHAiLCJtb2R1bGVzIiwiTWFpbiIsInNlbGYiLCJ0aGlzIiwiaHRtbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJvZHkiLCJsaWJyYXJ5IiwiTGlicmFyeSIsImluaXRMaWJyYXJ5IiwiaW5pdCIsImluaXRNb2R1bGVzIiwibW9kdWxlIiwiaGFzT3duUHJvcGVydHkiLCJtYWluIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsIkZvcm1TZWxlY3RNdWx0aXBsZSIsImNvbnRhaW5lciIsInNldHVwTGlzdGVuZXIiLCJoYW5kbGVDaGFuZ2UiLCJoYW5kbGVDbGljayIsInRhcmdldCIsImV2ZW50IiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJjbG9zZXN0Iiwic2VsZWN0Iiwic2VsZWN0ZWRWYWx1ZSIsInZhbHVlIiwiaW5pdGlhbExpc3QiLCJkYXRhc2V0IiwibGlzdCIsIkpTT04iLCJwYXJzZSIsIm9wdGlvbnMiLCJzbGljZSIsImNhbGwiLCJxdWVyeVNlbGVjdG9yQWxsIiwic2VsZWN0TGlzdCIsInJlc3VsdExpc3QiLCJmb3JFYWNoIiwiaXRlbSIsInRleHQiLCJpbm5lckhUTUwiLCJwdXNoIiwic3RyaW5naWZ5IiwiYWRkIiwiZmlsdGVyIiwic2VsZWN0SXRlbSIsImluaXRpYWxJdGVtIiwiaW5kZXgiLCJzcGxpY2UiLCJyZW5kZXIiLCJwcmV2ZW50RGVmYXVsdCIsImdldEF0dHJpYnV0ZSIsImxpbmtzIiwibWFwIiwicmVzdWx0SXRlbSIsImdldFZhbHVlIiwic2VsZWN0RGF0YSIsInJlc3VsdERhdGEiLCJzZWxlY3RDb250YWluZXIiLCJyZXN1bHRDb250YWluZXIiLCJzZWxlY3RIdG1sIiwicmVzdWx0SHRtbCIsImxlbmd0aCIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCIsImltcG9ydERlZmF1bHRzIiwiZm9ybVNlbGVjdE11bHRpcGxlIiwiTW9kYWwiLCJvcGVuQnV0dG9uIiwiY2xvc2VCdXR0b24iLCJyb3V0ZXIiLCJvcGVuIiwiY2xvc2UiLCJzcmMiLCJwaG90byIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJyZW1vdmUiLCJtb2RhbCIsIlNjaGVkdWxlIiwiZ2V0U2NoZWR1bGUiLCJnZXRQbGFjZSIsImdldFNjaG9vbCIsImdldEF1dGhvciIsImV4cGFuZCIsImNvbnRlbnQiLCJzY2hvb2xTZWxlY3QiLCJhdXRob3JTZWxlY3QiLCJ0ZW1wbGF0ZSIsIm1vbnRoTmFtZXMiLCJkYXRhTGlzdCIsInNldHVwU2Nob29sRmlsdGVyIiwidGhlbiIsInJlc3BvbnNlIiwiaWQiLCJzZXR1cEF1dGhvckZpbHRlciIsImdldERhdGEiLCJkYXRlRnJvbSIsImRhdGVUbyIsInBsYWNlIiwiY29udGVudExpc3QiLCJjcmVhdGVFbGVtZW50IiwibGVjdHVyZXMiLCJlbGVtZW50IiwiZGF0ZSIsIkRhdGUiLCJkYXkiLCJnZXREYXRlIiwibW9udGgiLCJnZXRNb250aCIsInNjaG9vbCIsImF1dGhvciIsIml0ZW1UaXRsZSIsImRhdGEiLCJzY2hvb2xzIiwiaXRlbUlkIiwiYXV0aG9ycyIsIml0ZW1QaG90byIsIml0ZW1EZXNjcmlwdGlvbiIsImlzT3ZlciIsInRpbWUiLCJqb2luIiwicGxhY2VzIiwiaHJlZiIsImFwcGVuZENoaWxkIiwic2NoZWR1bGUiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLFNBQUEsV0FDQSxLQUFBLFdBQUFDLE1BQUEsUUFBQUEsS0FBQUMsU0FBQSxDQVFBLEdBQUFDLEdBQUEsV0FDQSxHQUFBQyxHQUFBQyxJQUVBRCxHQUFBRSxLQUFBQyxTQUFBQyxjQUFBLFFBQ0FKLEVBQUFLLEtBQUFGLFNBQUFDLGNBQUEsUUFDQUosRUFBQUYsUUFBQUQsSUFBQUMsUUFDQUUsRUFBQU0sUUFBQSxHQUFBQyxTQUtBUCxFQUFBUSxZ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UCxRQUFBZ0YsVUFDQXRGLEVBQUF1RixPQUFBMUYsSUFBQUMsUUFBQWUsS0FBQVAsUUFBQWlGLFFBTUF2RixFQUFBUyxLQUFBLFdBQ0FULEVBQUFpQixZQUVBakIsRUFBQW9FLGlCQUNBcEUsRUFBQThGLG9CQUNBOUYsRUFBQWtHLG9CQUNBbEcsRUFBQW1HLFVBQ0FuRyxFQUFBa0Isa0JBTUEsWUFBQXJCLE9BQ0FBLElBQUFDLFlBR0FELElBQUFDLFFBQUFrSSxTQUFBLEdBQUE5QyIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBpbml0QXBwID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiBhcHAgJiYgJ21haW4nIGluIGFwcC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE1haW4gY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIE1haW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuaHRtbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKTtcbiAgICAgICAgc2VsZi5ib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuICAgICAgICBzZWxmLm1vZHVsZXMgPSBhcHAubW9kdWxlcztcbiAgICAgICAgc2VsZi5saWJyYXJ5ID0gbmV3IExpYnJhcnkoKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBsaWJyYXJ5IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0TGlicmFyeSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5saWJyYXJ5LmluaXQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBhbGwgbW9kdWxlcyBpbiAkLm1vZHVsZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdE1vZHVsZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGZvciAodmFyIG1vZHVsZSBpbiBzZWxmLm1vZHVsZXMpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzZWxmLm1vZHVsZXMuaGFzT3duUHJvcGVydHkobW9kdWxlKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VsZi5tb2R1bGVzW21vZHVsZV0uaW5pdCAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlICE9PSAnbWFpbicgJiYgbW9kdWxlICE9PSAnbGlicmFyeScpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2R1bGVzW21vZHVsZV0uaW5pdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLmluaXRMaWJyYXJ5KCk7XG4gICAgICAgICAgICBzZWxmLmluaXRNb2R1bGVzKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiBhcHApKSB7XG4gICAgICAgIGFwcC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgYXBwLm1vZHVsZXMubWFpbiA9IG5ldyBNYWluKCk7XG5cbiAgICBhcHAubW9kdWxlcy5tYWluLmluaXQoKTtcbn07XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgaW5pdEFwcCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gYXBwICYmICdmb3JtU2VsZWN0TXVsdGlwbGUnIGluIGFwcC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IEZvcm1TZWxlY3RNdWx0aXBsZSBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgRm9ybVNlbGVjdE11bHRpcGxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5ib2R5ID0gJyc7XG4gICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZScpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmhhbmRsZUNoYW5nZSk7XG4gICAgICAgICAgICBzZWxmLmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLmhhbmRsZUNsaWNrKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlIGNoYW5nZSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5oYW5kbGVDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdmb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdCcpKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGFyZ2V0LmNsb3Nlc3QoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdCcpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlID0gc2VsZWN0LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBpbml0aWFsTGlzdCA9IGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QgPyBKU09OLnBhcnNlKGNvbnRhaW5lci5kYXRhc2V0Lmxpc3QpIDogW10sXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBbXS5zbGljZS5jYWxsKHNlbGVjdC5xdWVyeVNlbGVjdG9yQWxsKCdvcHRpb24nKSksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IFtdO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFjb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdmb3JtU2VsZWN0TXVsdGlwbGVfc3RhdGVfaW5pdGVkJykpIHtcblxuICAgICAgICAgICAgICAgICAgICBbXS5zbGljZS5jYWxsKHNlbGVjdC5xdWVyeVNlbGVjdG9yQWxsKCdvcHRpb24nKSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBpdGVtLmlubmVySFRNTDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHRleHQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxMaXN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuZGF0YXNldC5saXN0ID0gSlNPTi5zdHJpbmdpZnkoaW5pdGlhbExpc3QpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdmb3JtU2VsZWN0TXVsdGlwbGVfc3RhdGVfaW5pdGVkJyk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBvcHRpb25zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGl0ZW0uaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB0ZXh0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBzZWxlY3RMaXN0LmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnZhbHVlICE9PSBzZWxlY3RlZFZhbHVlO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uKHNlbGVjdEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QuZm9yRWFjaChmdW5jdGlvbihpbml0aWFsSXRlbSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbml0aWFsSXRlbS52YWx1ZSA9PT0gc2VsZWN0SXRlbS52YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3Quc3BsaWNlKGluZGV4LCAxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdExpc3QgPSBpbml0aWFsTGlzdDtcblxuICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKGNvbnRhaW5lciwgc2VsZWN0TGlzdCwgcmVzdWx0TGlzdCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlIGNsaWNrIGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5oYW5kbGVDbGljayA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZm9ybVNlbGVjdE11bHRpcGxlX19saW5rJykpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGFyZ2V0LmNsb3Nlc3QoJy5mb3JtU2VsZWN0TXVsdGlwbGUnKSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRWYWx1ZSA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QgPSBjb250YWluZXIuZGF0YXNldC5saXN0ID8gSlNPTi5wYXJzZShjb250YWluZXIuZGF0YXNldC5saXN0KSA6IFtdLFxuICAgICAgICAgICAgICAgICAgICBsaW5rcyA9IFtdLnNsaWNlLmNhbGwoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKSksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IFtdO1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IGxpbmtzLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gaXRlbS5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnZhbHVlICE9PSBzZWxlY3RlZFZhbHVlO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uKHJlc3VsdEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3QuZm9yRWFjaChmdW5jdGlvbihpbml0aWFsSXRlbSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbml0aWFsSXRlbS52YWx1ZSA9PT0gcmVzdWx0SXRlbS52YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbExpc3Quc3BsaWNlKGluZGV4LCAxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGVjdExpc3QgPSBpbml0aWFsTGlzdDtcblxuICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKGNvbnRhaW5lciwgc2VsZWN0TGlzdCwgcmVzdWx0TGlzdCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0dXJuIGNvbnRhaW5lciBzZWxlY3RlZCB2YWx1ZVxuICAgICAgICAgKiBAcGFyYW0gY29udGFpbmVyXG4gICAgICAgICAqIEByZXR1cm5zIHtBcnJheX1cbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ2V0VmFsdWUgPSBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHRMaXN0ID0gW107XG5cbiAgICAgICAgICAgIGlmIChjb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHZhciBsaW5rcyA9IFtdLnNsaWNlLmNhbGwoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKSk7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gbGlua3MubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBpdGVtLmlubmVySFRNTDtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdExpc3Q7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbmRlciBkYXRhIGZvciBjb250YWluZXJcbiAgICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBjb250YWluZXJcbiAgICAgICAgICogQHBhcmFtIHtBcnJheX0gc2VsZWN0RGF0YVxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSByZXN1bHREYXRhXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlbmRlciA9IGZ1bmN0aW9uKGNvbnRhaW5lciwgc2VsZWN0RGF0YSwgcmVzdWx0RGF0YSkge1xuICAgICAgICAgICAgdmFyIHNlbGVjdENvbnRhaW5lciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybVNlbGVjdE11bHRpcGxlX19zZWxlY3QnKSxcbiAgICAgICAgICAgICAgICByZXN1bHRDb250YWluZXIgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fbGlzdCcpLFxuICAgICAgICAgICAgICAgIHNlbGVjdEh0bWwgPSAnPG9wdGlvbiB2YWx1ZT1cIlwiPjwvb3B0aW9uPicsXG4gICAgICAgICAgICAgICAgcmVzdWx0SHRtbCA9ICcnO1xuXG4gICAgICAgICAgICBpZiAoc2VsZWN0RGF0YS5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3REYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RIdG1sICs9ICc8b3B0aW9uIHZhbHVlPVwiJysgaXRlbS52YWx1ZSArJ1wiPicrIGl0ZW0udGV4dCArJzwvb3B0aW9uPic7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJlc3VsdERhdGEubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0RGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SHRtbCArPSAnPGxpIGNsYXNzPVwiZm9ybVNlbGVjdE11bHRpcGxlX19pdGVtXCI+PGEgaHJlZj1cIicrIGl0ZW0udmFsdWUgKydcIiBjbGFzcz1cImZvcm1TZWxlY3RNdWx0aXBsZV9fbGlua1wiPicrIGl0ZW0udGV4dCArJzwvYT48L2xpPic7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNlbGVjdENvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZWN0Q29udGFpbmVyLmlubmVySFRNTCA9IHNlbGVjdEh0bWw7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJlc3VsdENvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCA9IHJlc3VsdEh0bWw7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29udGFpbmVyLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdjaGFuZ2UnKSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEltcG9ydCBwcm9wZXJ0aWVzIGZyb20gTWFpbiBjbGFzc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5ib2R5ID0gYXBwLm1vZHVsZXMubWFpbi5ib2R5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5jb250YWluZXIpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gYXBwKSkge1xuICAgICAgICBhcHAubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgIGFwcC5tb2R1bGVzLmZvcm1TZWxlY3RNdWx0aXBsZSA9IG5ldyBGb3JtU2VsZWN0TXVsdGlwbGUoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gYXBwICYmICdtb2RhbCcgaW4gYXBwLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgTW9kYWwgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIE1vZGFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5odG1sID0gJyc7XG4gICAgICAgIHNlbGYuYm9keSA9ICcnO1xuICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpO1xuICAgICAgICBzZWxmLm9wZW5CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHJpZ2dlcicpO1xuICAgICAgICBzZWxmLmNsb3NlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX2Nsb3NlJyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5yb3V0ZXIpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSb3V0ZSBjbGljayBldmVudFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucm91dGVyID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF90cmlnZ2VyJykpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLm9wZW4oZXZlbnQudGFyZ2V0KTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9jbG9zZScpKSB7XG5cbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgc2VsZi5jbG9zZShldmVudC50YXJnZXQpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5vcGVuID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgICAgICB2YXIgc3JjID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpLFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc3JjKSxcbiAgICAgICAgICAgICAgICBwaG90byA9IHRhcmdldC5kYXRhc2V0LnBob3RvLFxuICAgICAgICAgICAgICAgIHRpdGxlID0gdGFyZ2V0LmRhdGFzZXQudGl0bGUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSB0YXJnZXQuZGF0YXNldC5kZXNjcmlwdGlvbjtcblxuICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5hdXRob3JJbmZvX19wcmV2aWV3IGltZycpLnNyYyA9IHBob3RvO1xuXG4gICAgICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmF1dGhvckluZm9fX3RpdGxlJykuaW5uZXJIVE1MID0gdGl0bGU7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYXV0aG9ySW5mb19fdGV4dCBwJykuaW5uZXJIVE1MID0gZGVzY3JpcHRpb247XG5cbiAgICAgICAgICAgIHNlbGYuaHRtbC5jbGFzc0xpc3QuYWRkKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnbW9kYWxfc3RhdGVfb3BlbicpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuY2xvc2UgPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0YXJnZXQuY2xvc2VzdCgnLm1vZGFsJyk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9zdGF0ZV9vcGVuJyk7XG4gICAgICAgICAgICBzZWxmLmh0bWwuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWxfc3RhdGVfb3BlbicpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbXBvcnQgcHJvcGVydGllcyBmcm9tIE1haW4gY2xhc3NcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuaHRtbCA9IGFwcC5tb2R1bGVzLm1haW4uaHRtbDtcbiAgICAgICAgICAgIHNlbGYuYm9keSA9IGFwcC5tb2R1bGVzLm1haW4uYm9keTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmltcG9ydERlZmF1bHRzKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5tb2RhbCA9IG5ldyBNb2RhbCgpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluIGFwcCAmJiAnc2NoZWR1bGUnIGluIGFwcC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IFNjaGVkdWxlIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBTY2hlZHVsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHNlbGYuYm9keSA9ICcnO1xuICAgICAgICBzZWxmLmdldFNjaGVkdWxlID0gJyc7XG4gICAgICAgIHNlbGYuZ2V0UGxhY2UgPSAnJztcbiAgICAgICAgc2VsZi5nZXRTY2hvb2wgPSAnJztcbiAgICAgICAgc2VsZi5nZXRBdXRob3IgPSAnJztcbiAgICAgICAgc2VsZi5leHBhbmQgPSAnJztcbiAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGUnKTtcbiAgICAgICAgc2VsZi5jb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlTGlzdF9fY29udGVudCcpO1xuICAgICAgICBzZWxmLnNjaG9vbFNlbGVjdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtU2VsZWN0TXVsdGlwbGVfX3NlbGVjdFtuYW1lPVwic2Nob29sXCJdJyk7XG4gICAgICAgIHNlbGYuYXV0aG9yU2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvcm1TZWxlY3RNdWx0aXBsZV9fc2VsZWN0W25hbWU9XCJhdXRob3JcIl0nKTtcbiAgICAgICAgc2VsZi50ZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzY2hlZHVsZUl0ZW0tdGVtcGxhdGUnKS5pbm5lckhUTUw7XG4gICAgICAgIHNlbGYubW9udGhOYW1lcyA9IFtcbiAgICAgICAgICAgICfRj9C90LLQsNGA0YwnLFxuICAgICAgICAgICAgJ9GE0LXQstGA0LDQu9GMJyxcbiAgICAgICAgICAgICfQvNCw0YDRgicsXG4gICAgICAgICAgICAn0LDQv9GA0LXQu9GMJyxcbiAgICAgICAgICAgICfQvNCw0LknLFxuICAgICAgICAgICAgJ9C40Y7QvdGMJyxcbiAgICAgICAgICAgICfQuNGO0LvRjCcsXG4gICAgICAgICAgICAn0LDQstCz0YPRgdGCJyxcbiAgICAgICAgICAgICfRgdC10L3RgtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQvtC60YLRj9Cx0YDRjCcsXG4gICAgICAgICAgICAn0L3QvtGP0LHRgNGMJyxcbiAgICAgICAgICAgICfQtNC10LrQsNCx0YDRjCdcbiAgICAgICAgXTtcbiAgICAgICAgc2VsZi5kYXRhTGlzdCA9ICcnO1xuXG4gICAgICAgIC8vIHNlbGYuZGF0ZUZyb21JbnB1dCA9IHNlbGYuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtSW5wdXRfX2lucHV0W25hbWU9XCJmcm9tXCJdJyk7XG4gICAgICAgIC8vIHNlbGYuZGF0ZVRvSW5wdXQgPSBzZWxmLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZm9ybUlucHV0X19pbnB1dFtuYW1lPVwidG9cIl0nKTtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIHNlbGYuZGF0ZUZyb21JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICAgICAgLy8gc2VsZi5kYXRlVG9JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICAgICAgLy8gc2VsZi5wbGFjZVNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZWxmLmdldERhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXR1cCBzY2hvb2wgZmlsdGVyIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cFNjaG9vbEZpbHRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VsZi5nZXRTY2hvb2woKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPG9wdGlvbiB2YWx1ZT1cIlwiPjwvb3B0aW9uPic7XG5cbiAgICAgICAgICAgICAgICByZXNwb25zZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPG9wdGlvbiB2YWx1ZT1cIicrIGl0ZW0uaWQgKydcIj4nKyBpdGVtLnRpdGxlICsnPC9vcHRpb24+JztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGYuc2Nob29sU2VsZWN0LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0dXAgYXV0aG9yIGZpbHRlciB2YWx1ZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBBdXRob3JGaWx0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuZ2V0QXV0aG9yKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBodG1sID0gJzxvcHRpb24gdmFsdWU9XCJcIj48L29wdGlvbj4nO1xuXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxvcHRpb24gdmFsdWU9XCInKyBpdGVtLmlkICsnXCI+JysgaXRlbS50aXRsZSArJzwvb3B0aW9uPic7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmF1dGhvclNlbGVjdC5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBkYXRhIGZyb20gbGlicmFyeSBhY2NvcmRpbmcgdG8gZmlsdGVyIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5nZXREYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZGF0ZUZyb20gPSAnJywvL3NlbGYuZGF0ZUZyb21JbnB1dC52YWx1ZS5yZXBsYWNlKC8tL2csICcvJyksXG4gICAgICAgICAgICAgICAgZGF0ZVRvID0gJycsLy9zZWxmLmRhdGVUb0lucHV0LnZhbHVlLnJlcGxhY2UoLy0vZywgJy8nKSxcbiAgICAgICAgICAgICAgICBwbGFjZSA9ICcnOy8vc2VsZi5wbGFjZVNlbGVjdC52YWx1ZSA/IHBhcnNlSW50KHNlbGYucGxhY2VTZWxlY3QudmFsdWUpIDogJyc7XG5cbiAgICAgICAgICAgIHNlbGYuZ2V0U2NoZWR1bGUoZGF0ZUZyb20sIGRhdGVUbywgcGxhY2UpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcihyZXNwb25zZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIHNjaGVkdWxlIGxpc3RcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHJlc3BvbnNlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlbmRlciA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudExpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuXG4gICAgICAgICAgICBjb250ZW50TGlzdC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2xpc3QnKTtcblxuICAgICAgICAgICAgcmVzcG9uc2UubGVjdHVyZXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUxpc3RfX2l0ZW0nKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IHNlbGYudGVtcGxhdGU7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGl0ZW0uZGF0ZSksXG4gICAgICAgICAgICAgICAgICAgIGRheSA9IGRhdGUuZ2V0RGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgICBtb250aCA9IHNlbGYubW9udGhOYW1lc1tkYXRlLmdldE1vbnRoKCldLFxuICAgICAgICAgICAgICAgICAgICBzY2hvb2wgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yID0gW107XG5cbiAgICAgICAgICAgICAgICBpdGVtLnNjaG9vbC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1UaXRsZSA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnc2Nob29scycsIGRhdGE6IHJlc3BvbnNlLnNjaG9vbHN9LCAndGl0bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1JZCA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnc2Nob29scycsIGRhdGE6IHJlc3BvbnNlLnNjaG9vbHN9LCAnaWQnKTtcblxuICAgICAgICAgICAgICAgICAgICBzY2hvb2wucHVzaCgnPHNwYW4gY2xhc3M9XCJzY2hlZHVsZUl0ZW1fX3NjaG9vbF9faXRlbSBzY2hlZHVsZUl0ZW1fX3NjaG9vbF9faXRlbV8nKyBpdGVtSWQgKydcIj4nKyBpdGVtVGl0bGUgKyc8L3NwYW4+Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdGVtLmF1dGhvci5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1UaXRsZSA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAndGl0bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1QaG90byA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAncGhvdG8nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1EZXNjcmlwdGlvbiA9IHNlbGYuZXhwYW5kKFtpdGVtXSwge3RpdGxlOiAnYXV0aG9ycycsIGRhdGE6IHJlc3BvbnNlLmF1dGhvcnN9LCAnZGVzY3JpcHRpb24nKTtcblxuICAgICAgICAgICAgICAgICAgICBhdXRob3IucHVzaCgnPGEgY2xhc3M9XCJzY2hlZHVsZUl0ZW1fX2F1dGhvcl9fbGluayBtb2RhbF90cmlnZ2VyXCIgaHJlZj1cIiNhdXRob3JcIiB0aXRsZT1cItCf0L7RgdC80L7RgtGA0LXRgtGMINC00L7Qv9C+0LvQvdC40YLQtdC70YzQvdGD0Y4g0LjQvdGE0L7RgNC80LDRhtC40Y5cIiBkYXRhLXBob3RvPVwiJysgaXRlbVBob3RvICsnXCIgZGF0YS10aXRsZT1cIicrIGl0ZW1UaXRsZSArJ1wiIGRhdGEtZGVzY3JpcHRpb249XCInKyBpdGVtRGVzY3JpcHRpb24gKydcIj4nKyBpdGVtVGl0bGUgKyc8L2E+Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pc092ZXIpIHtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW0nKS5jbGFzc0xpc3QuYWRkKCdzY2hlZHVsZUl0ZW1fc3RhdGVfaW5hY3RpdmUnKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fZGF5JykuaW5uZXJIVE1MID0gZGF5O1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19tb250aCcpLmlubmVySFRNTCA9IG1vbnRoO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX190aW1lJykuaW5uZXJIVE1MID0gaXRlbS50aW1lO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX190aXRsZScpLmlubmVySFRNTCA9IGl0ZW0udGl0bGU7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZUl0ZW1fX3NjaG9vbCcpLmlubmVySFRNTCA9IHNjaG9vbC5qb2luKCcnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fYXV0aG9yJykuaW5uZXJIVE1MICs9IGF1dGhvci5qb2luKCcsICcpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19hdWRpZW5jZScpLmlubmVySFRNTCArPSBzZWxmLmV4cGFuZChbaXRlbS5wbGFjZV0sIHt0aXRsZTogJ3BsYWNlcycsIGRhdGE6IHJlc3BvbnNlLnBsYWNlc30sICd0aXRsZScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVJdGVtX19wbGFjZV9fbGluaycpLmlubmVySFRNTCA9IHNlbGYuZXhwYW5kKFtpdGVtLnBsYWNlXSwge3RpdGxlOiAncGxhY2VzJywgZGF0YTogcmVzcG9uc2UucGxhY2VzfSwgJ2FkZHJlc3MnKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlSXRlbV9fcGxhY2VfX2xpbmsnKS5ocmVmID0gc2VsZi5leHBhbmQoW2l0ZW0ucGxhY2VdLCB7dGl0bGU6ICdwbGFjZXMnLCBkYXRhOiByZXNwb25zZS5wbGFjZXN9LCAnbGluaycpO1xuXG4gICAgICAgICAgICAgICAgY29udGVudExpc3QuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQuYXBwZW5kQ2hpbGQoY29udGVudExpc3QpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbXBvcnQgcHJvcGVydGllcyBmcm9tIE1haW4gY2xhc3NcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW1wb3J0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYuYm9keSA9IGFwcC5tb2R1bGVzLm1haW4uYm9keTtcbiAgICAgICAgICAgIHNlbGYuZ2V0U2NoZWR1bGUgPSBhcHAubW9kdWxlcy5tYWluLmxpYnJhcnkuZ2V0U2NoZWR1bGU7XG4gICAgICAgICAgICBzZWxmLmdldFNjaG9vbCA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5nZXRTY2hvb2w7XG4gICAgICAgICAgICBzZWxmLmdldEF1dGhvciA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5nZXRBdXRob3I7XG4gICAgICAgICAgICBzZWxmLmV4cGFuZCA9IGFwcC5tb2R1bGVzLm1haW4ubGlicmFyeS5leHBhbmQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRhaW5lcikge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbXBvcnREZWZhdWx0cygpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBTY2hvb2xGaWx0ZXIoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNldHVwQXV0aG9yRmlsdGVyKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5nZXREYXRhKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluIGFwcCkpIHtcbiAgICAgICAgYXBwLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICBhcHAubW9kdWxlcy5zY2hlZHVsZSA9IG5ldyBTY2hlZHVsZSgpO1xufSkoKTtcbiJdfQ==
